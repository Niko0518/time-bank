# Time Bank - AI ç¼–ç¨‹æŒ‡å—

> âš ï¸ **å¼ºåˆ¶è§„åˆ™**ï¼šæ¯æ¬¡æ›´æ–°è¯·é˜…è¯»æœ¬æŒ‡ä»¤ï¼Œåœ¨æ›´æ–°åï¼Œå‡¡æ˜¯æ¶‰åŠå…³é”®æŠ€æœ¯ç»†èŠ‚æˆ–é‡è¦æ”¹åŠ¨æ—¶ï¼Œå¿…é¡»å°†å…¶æ·»åŠ åˆ°æœ¬æ–‡ä»¶çš„ã€Œç¬¬äºŒéƒ¨åˆ†ï¼šç‰ˆæœ¬æ›´æ–°æ—¥å¿—ã€ä¸­ã€‚æˆ‘ä»¬çš„äº¤æµè¯­è¨€æ˜¯ä¸­æ–‡ã€‚å½“ç”¨æˆ·æå‡ºçµ¦æˆ‘ä¸€ä¸ªâ€œæ–¹æ¡ˆâ€æ—¶ï¼Œè‹¥æ— ç‰¹æ®Šè¦æ±‚ï¼Œæ„æ€æ˜¯å…ˆä¸å®æ–½ï¼Œç­‰å’Œç”¨æˆ·ä¸€èµ·å•†è®¨ï¼Œå¾—åˆ°ç”¨æˆ·ç¡®è®¤åå®æ–½ã€‚
> âš ï¸ **æ—¥å¿—æ›´æ–°è§„åˆ™ï¼ˆæ–°å¢ï¼‰**ï¼š
> - **ç”¨æˆ·æ—¥å¿—ï¼ˆHTML ä¸­çš„ç‰ˆæœ¬æ›´æ–°æ—¥å¿—ï¼‰**ï¼šä»…åœ¨ç”¨æˆ·æ˜ç¡®ä¸‹è¾¾â€œæ›´æ–°ç”¨æˆ·æ—¥å¿—/æ’°å†™ç”¨æˆ·æ—¥å¿—â€æŒ‡ä»¤æ—¶æ‰ä¿®æ”¹ã€‚
> - **æœ¯è¯­çº¦å®šï¼ˆæ–°å¢ï¼‰**ï¼šç”¨æˆ·åç»­æåˆ°â€œæ’°å†™æ—¥å¿—â€ï¼Œé»˜è®¤æŒ‡ **ç”¨æˆ·æ—¥å¿—ï¼ˆHTML ä¸­çš„ç‰ˆæœ¬æ›´æ–°æ—¥å¿—ï¼‰**ã€‚
> - **æŠ€æœ¯æ—¥å¿—ï¼ˆæœ¬æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†ï¼‰**ï¼šç”± AI æŒ‰éœ€æ›´æ–°ï¼Œä»…åœ¨å­˜åœ¨å…³é”®æŠ€æœ¯ç»†èŠ‚æˆ–é‡è¦æ”¹åŠ¨æ—¶è®°å½•ã€‚

---

## ğŸ“‹ æ¯æ¬¡æ›´æ–°å‰å¤è¿°ç”¨æˆ·éœ€æ±‚

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®æ¦‚å†µä¸æŠ€æœ¯åŸºç¡€

> æœ¬éƒ¨åˆ†åŒ…å«é¡¹ç›®çš„æ•´ä½“æ¶æ„ã€æ ¸å¿ƒæ–‡ä»¶ã€å…³é”®é…ç½®ç­‰åŸºç¡€ä¿¡æ¯ã€‚**æ¯æ¬¡å¼€å§‹å·¥ä½œå‰å¿…é¡»é˜…è¯»ç†è§£**ã€‚

---

## 1.1 é¡¹ç›®æ¦‚è¿°

Time Bank æ˜¯ä¸€ä¸ª **æ··åˆå¼€å‘ (Hybrid) çš„å®‰å“åº”ç”¨**ï¼Œç»“åˆåŸç”Ÿ Java å¤–å£³å’Œ WebView å‰ç«¯ç•Œé¢ã€‚

**æŠ€æœ¯æ ˆ**ï¼š
- **å‰ç«¯**: åŸç”Ÿ JavaScript (Vanilla JS)ï¼Œæ— æ¡†æ¶ï¼Œå•æ–‡ä»¶ ~37,300 è¡Œ
- **æ ·å¼**: CSS å˜é‡ï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼ (`prefers-color-scheme`)
- **äº‘ç«¯**: è…¾è®¯ CloudBase JS SDK v2
- **Android**: Javaï¼ŒminSdk 24ï¼ŒtargetSdk 36ï¼ŒcompileSdk 36
- **æ„å»º**: Gradle 8.x

---

## 1.2 æ ¸å¿ƒæ–‡ä»¶ç»“æ„

| æ–‡ä»¶ | ç”¨é€” | è¡Œæ•° |
|------|------|------|
| `android_project/app/src/main/assets/www/index.html` | **å‰ç«¯å…¨éƒ¨ä»£ç ** (HTML+CSS+JS) | ~37,300 è¡Œ |
| `android_project/app/src/main/java/com/jianglicheng/timebank/MainActivity.java` | Android å…¥å£ï¼ŒWebView åˆå§‹åŒ– | ~200 è¡Œ |
| `android_project/app/src/main/java/com/jianglicheng/timebank/WebAppInterface.java` | JS æ¡¥æ¥ (`window.Android`) | ~900 è¡Œ |
| `android_project/app/src/main/java/com/jianglicheng/timebank/AlarmReceiver.java` | é—¹é’Ÿå¹¿æ’­æ¥æ”¶å™¨ | ~100 è¡Œ |
| `android_project/app/src/main/java/com/jianglicheng/timebank/FloatingTimerService.java` | æ‚¬æµ®çª—è®¡æ—¶å™¨æœåŠ¡ | ~850 è¡Œ |
| `android_project/app/src/main/java/com/jianglicheng/timebank/BootReceiver.java` | å¼€æœºå¹¿æ’­æ¥æ”¶å™¨ | ~50 è¡Œ |
| `android_project/app/src/main/java/com/jianglicheng/timebank/BalanceWidget*.java` | æ—¶é—´ä½™é¢å°ç»„ä»¶ (4 ç§æ ·å¼) | ~200 è¡Œ/ä¸ª |
| `android_project/app/src/main/java/com/jianglicheng/timebank/ScreenTimeWidget*.java` | å±å¹•æ—¶é—´å°ç»„ä»¶ (4 ç§æ ·å¼) | ~200 è¡Œ/ä¸ª |
| `sw.js` | Service Worker (PWA ç¼“å­˜) | ~100 è¡Œ |

### æ–‡ä»¶åŒæ­¥è§„åˆ™
- **ä¸»æ–‡ä»¶**: `android_project/app/src/main/assets/www/index.html`
- **æ ¹ç›®å½•å‰¯æœ¬**: `index.html` (ç”¨äº GitHub Pages é¢„è§ˆ)
- âš ï¸ **æ¯æ¬¡ä¿®æ”¹åå¿…é¡»åŒæ­¥**: 
  ```powershell
  Copy-Item "android_project/app/src/main/assets/www/index.html" "index.html" -Force
  ```

### index.html ç»“æ„æ¦‚è§ˆ
```
è¡Œ 1-1000        : HTML ç»“æ„ + CSS æ ·å¼ï¼ˆä¸»é¢˜ã€å˜é‡ï¼‰
è¡Œ 1000-4000     : æ›´å¤š HTML (å„é¡µé¢æ¨¡æ¿)
è¡Œ 4000-9000     : é¦–é¡µå¡ç‰‡ (ä½™é¢ã€å±å¹•æ—¶é—´ã€ç¡çœ ) + å¼¹çª—æ¨¡æ¿
è¡Œ 9000-11000    : DAL (æ•°æ®è®¿é—®å±‚) + CloudBase åˆå§‹åŒ–
è¡Œ 11000-16000   : ä»»åŠ¡ç®¡ç† + äº¤æ˜“è®°å½• + åˆ†ç±»ç³»ç»Ÿ
è¡Œ 16000-21000   : æŠ¥å‘Šé¡µé¢ + æ—¶é—´æµå›¾ + ä¹ æƒ¯ç³»ç»Ÿ
è¡Œ 21000-29000   : ç¡çœ /å±å¹•æ—¶é—´ç®¡ç†ç³»ç»Ÿ
è¡Œ 29000-32000   : æ—¶é—´é‡‘èç³»ç»Ÿ (åˆ©æ¯è®¡ç®—)
è¡Œ 32000-37300   : è®¤è¯ç™»å½• + æ•°æ®å¯¼å…¥å¯¼å‡º + åˆå§‹åŒ–é€»è¾‘
```

---

## 1.3 è…¾è®¯äº‘ CloudBase é…ç½®

### ç¯å¢ƒä¿¡æ¯
- **ç¯å¢ƒ ID**: `cloud1-8gvjsmyd7860b4a3`
- **åœ°åŸŸ**: `ap-shanghai`
- **ç™»å½•æ–¹å¼**: é‚®ç®±ç™»å½•
- **SDK ç‰ˆæœ¬**: v2.24.10

### æ•°æ®åº“é›†åˆ

| é›†åˆåç§° | å®‰å…¨è§„åˆ™ç±»å‹ | ç”¨é€” |
|---------|-------------|------|
| `tb_profile` | âœ… é¢„ç½®è§„åˆ™ï¼ˆè¯»å†™æœ¬äººæ•°æ®ï¼‰ | ç”¨æˆ·èµ„æ–™ï¼ˆå«è®¾å¤‡é…ç½®ï¼‰ |
| `tb_task` | âœ… é¢„ç½®è§„åˆ™ï¼ˆè¯»å†™æœ¬äººæ•°æ®ï¼‰ | ä»»åŠ¡åˆ—è¡¨ |
| `tb_transaction` | ğŸ”§ è‡ªå®šä¹‰è§„åˆ™ | äº¤æ˜“è®°å½•ï¼ˆå«ç¡çœ ç»“ç®—ï¼‰ |
| `tb_running` | âœ… é¢„ç½®è§„åˆ™ï¼ˆè¯»å†™æœ¬äººæ•°æ®ï¼‰ | è¿è¡Œä¸­ä»»åŠ¡ |
| `tb_daily` | ğŸ”§ è‡ªå®šä¹‰è§„åˆ™ | æ¯æ—¥ç»Ÿè®¡ |

### è‡ªå®šä¹‰è§„åˆ™ä»£ç ï¼ˆtb_transaction / tb_dailyï¼‰
```json
{
  "read": "doc._openid == auth.uid || doc._openid == auth.openid",
  "write": "doc._openid == auth.uid || doc._openid == auth.openid",
  "delete": true
}
```

### å®‰å…¨è§„åˆ™å¯¹æŸ¥è¯¢çš„å½±å“
```javascript
// é¢„ç½®è§„åˆ™ "è¯»å–å’Œä¿®æ”¹æœ¬äººæ•°æ®" - ä¸éœ€è¦ where æ¡ä»¶
db.collection('tb_profile').get()  // CloudBase è‡ªåŠ¨è¿‡æ»¤

// è‡ªå®šä¹‰è§„åˆ™ - éœ€è¦æ‰‹åŠ¨æ·»åŠ  where æ¡ä»¶
db.collection('tb_transaction').where({ _openid: currentUid }).get()
```

### å…³é”®ä»£ç ä½ç½®
| åŠŸèƒ½ | æœç´¢å…³é”®è¯ |
|------|-----------|
| DAL å¯¹è±¡ | `const DAL =` |
| SDK åˆå§‹åŒ– | `initCloudBase` |
| Watch å®æ—¶ç›‘å¬ | `subscribeAll` |
| æ•°æ®åŠ è½½ | `DAL.loadAll` |
| ä»»åŠ¡ä¿å­˜ | `DAL.saveTask` |

âš ï¸ **é‡è¦**: `saveData()` åœ¨å¤šè¡¨æ¨¡å¼ä¸‹**ä¸ä¿å­˜ä»»åŠ¡åˆ°äº‘ç«¯**ï¼Œåªä¿å­˜ Profileã€‚ä¿®æ”¹ä»»åŠ¡æ•°æ®åéœ€å•ç‹¬è°ƒç”¨ `DAL.saveTask(task)` åŒæ­¥åˆ°äº‘ç«¯ã€‚

---

## 1.4 æ ¸å¿ƒæ•°æ®ç»“æ„

### ç¡çœ è®¾ç½® (localStorage: sleepSettings)
```javascript
sleepSettings = {
    enabled: false,
    plannedBedtime: '22:30',
    plannedWakeTime: '06:45',
    targetDurationMinutes: 495,
    durationTolerance: 45,
    toleranceReward: 60,
    countdownSeconds: 60,
    showCard: true,
    autoDetectWake: true,
    earlyBedtimeRate: 0.2,
    lateBedtimeRate: 0.5,
    earlyWakeRate: 0.2,
    lateWakeRate: 0.5,
    durationDeviationRate: 0.5,
    earnCategory: null,   // [v7.9.3] ç¡çœ å¥–åŠ±åˆ†ç±»
    spendCategory: null,  // [v7.9.3] ç¡çœ æƒ©ç½šåˆ†ç±»
};
```

### å±å¹•æ—¶é—´è®¾ç½® (localStorage: screenTimeSettings)
```javascript
screenTimeSettings = {
    enabled: false,
    dailyLimitMinutes: 120,
    showCard: true,
    whitelistApps: [],
    settledDates: { deviceId: [dates] },
    earnCategory: null,
    spendCategory: null,
    cardStyle: 'classic',
};
```

### ç¡çœ çŠ¶æ€ (localStorage: sleepState)
```javascript
sleepState = {
    isSleeping: false,
    sleepStartTime: null,
    unlockCount: 0,
    cancelledDates: [],
    lastSleepRecord: null,
    lastUnlockTime: null,
};
```

---

## 1.5 ç‰ˆæœ¬å‘å¸ƒè§„åˆ™

### âš ï¸ ç‰ˆæœ¬å·ä¸æ¨é€åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰
1. **ç‰ˆæœ¬å·ç”±ç”¨æˆ·æŒ‡å®š**ï¼šç”¨æˆ·åœ¨å¯¹è¯å¼€å§‹æ—¶å£°æ˜ç‰ˆæœ¬å·ï¼ˆå¦‚"æœ¬æ¬¡æ›´æ–°ç‰ˆæœ¬ä¸º v7.11.2"ï¼‰ï¼ŒAI åœ¨æ•´ä¸ªå¯¹è¯ä¸­å¿…é¡»ä½¿ç”¨è¯¥ç‰ˆæœ¬å·
2. **ç¦æ­¢æ“…è‡ªæ¨é€**ï¼šAI ä¸å¾—åœ¨æ²¡æœ‰ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤çš„æƒ…å†µä¸‹æ‰§è¡Œ `git push`
3. **ç¦æ­¢æ“…è‡ªå‡çº§ç‰ˆæœ¬å·**ï¼šå³ä½¿å¯¹è¯è·¨è¶Šå¤šæ¬¡ä¿®æ”¹ï¼Œç‰ˆæœ¬å·ä¿æŒç”¨æˆ·æŒ‡å®šçš„å€¼ä¸å˜
4. **ä»£ç æ³¨é‡Šç‰ˆæœ¬å·**ï¼šæ–°å¢/ä¿®æ”¹çš„ä»£ç æ³¨é‡Šåº”ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„ç‰ˆæœ¬å·ï¼ˆå¦‚ `// [v7.11.2] ä¿®å¤...`ï¼‰
5. **æ¨é€åå‡çº§**ï¼šåªæœ‰åœ¨ç”¨æˆ·è¦æ±‚æ¨é€åï¼Œä¸‹æ¬¡å¯¹è¯æ‰èƒ½ä½¿ç”¨æ–°ç‰ˆæœ¬å·

### æ›´æ–°ç‰ˆæœ¬å·ï¼ˆ6 ä¸ªä½ç½®ï¼‰
1. `<title>` æ ‡ç­¾ï¼ˆçº¦ç¬¬ 12 è¡Œï¼‰
2. å…³äºé¡µ `<p>ç‰ˆæœ¬ vX.X.X</p>`ï¼ˆæœç´¢ `ç‰ˆæœ¬ v` å®šä½ï¼‰
3. `APP_VERSION` å¸¸é‡ï¼ˆçº¦ç¬¬ 8940 è¡Œï¼‰
4. å¯åŠ¨æ—¥å¿— `console.log("App vX.X.X...")`ï¼ˆæœç´¢ `App v` å®šä½ï¼‰
5. `sw.js` æ–‡ä»¶å¤´éƒ¨ï¼ˆ2 å¤„ï¼‰
6. é¦–é¡µæ ‡é¢˜ä¸‹æ–¹ç‰ˆæœ¬å‰¯æ ‡é¢˜ `.version-subtitle`ï¼ˆæœç´¢ `version-subtitle` å®šä½ï¼Œæ ¼å¼ä¸º `TimeBank vX.X.X æœ¬ç‰ˆä¸»é¢˜`ï¼‰

### æ›´æ–° sw.js
```javascript
// Time Bank Service Worker - vX.X.X
const CACHE_NAME = 'timebank-cache-vX.X.X';
```

### ç‰ˆæœ¬æ—¥å¿—è§„åˆ™
- âš ï¸ **ä»…åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶**æ‰æ’°å†™ç‰ˆæœ¬æ—¥å¿—
- æ—¥å¿—æŒ‰ç‰ˆæœ¬å·**é™åºæ’åˆ—**ï¼ˆæœ€æ–°ç‰ˆæœ¬åœ¨æœ€ä¸Šé¢ï¼‰
- æ‰€æœ‰ç‰ˆæœ¬æ—¥å¿—ä½äº `<details>` åŒºåŸŸï¼ˆæ ‡é¢˜ä¸ºã€Œç‰ˆæœ¬æ›´æ–°æ—¥å¿—ã€ï¼‰
- æ›´æ–°æ—¥å¿—ä½äºçº¦ç¬¬ 5718 è¡Œ

### æ–‡ä»¶åŒæ­¥
```powershell
Copy-Item "android_project/app/src/main/assets/www/index.html" "index.html" -Force
```

---

## 1.6 å¼€å‘æ³¨æ„äº‹é¡¹

### ä¿®æ”¹å‰ç«¯ä»£ç  (index.html)
- æ–‡ä»¶å·¨å¤§ï¼ˆ~37,300 è¡Œï¼‰ï¼Œ**å¿…é¡»å…ˆç”¨ grep_search å®šä½**ï¼Œå†ç”¨ read_file è¯»å–ä¸Šä¸‹æ–‡
- ä½¿ç”¨ `replace_string_in_file` æ—¶æä¾› **3-5 è¡Œä¸Šä¸‹æ–‡**ï¼Œç¡®ä¿å”¯ä¸€åŒ¹é…
- ä¿®æ”¹åç”¨ `get_errors` æ£€æŸ¥è¯­æ³•é”™è¯¯

### å¸¸ç”¨æœç´¢å…³é”®è¯
| åŠŸèƒ½æ¨¡å— | æœç´¢å…³é”®è¯ |
|---------|-----------|
| äº‘ç«¯åŒæ­¥ | `DAL.` / `cloudApp` / `subscribeAll` |
| ä»»åŠ¡ç®¡ç† | `taskList` / `addTask` / `completeTask` |
| äº¤æ˜“è®°å½• | `transaction` / `addTransaction` |
| ç¡çœ ç®¡ç† | `sleepSettings` / `sleepState` / `ç¡çœ æ—¶é—´ç®¡ç†` |
| å±å¹•æ—¶é—´ | `screenTimeSettings` / `autoSettle` |
| å‡è¡¡æ¨¡å¼ | `balanceMode` / `getBalanceMultiplier` |
| ç™»å½•è®¤è¯ | `handleEmailLogin` / `signInWithPassword` |
| ç‰ˆæœ¬ä¿¡æ¯ | `APP_VERSION` / `æ›´æ–°æ—¥å¿—` |

### æ·»åŠ æ–°çš„ JS æ¡¥æ¥æ–¹æ³•
1. åœ¨ `WebAppInterface.java` æ·»åŠ :
   ```java
   @JavascriptInterface
   public void newMethod(String param) { ... }
   ```
2. åœ¨ `index.html` è°ƒç”¨:
   ```javascript
   if (window.Android?.newMethod) {
       window.Android.newMethod("value");
   }
   ```

### å¸¸ç”¨åŸç”Ÿæ–¹æ³• (Android)
| æ–¹æ³• | ç”¨é€” |
|------|------|
| `Android.saveFileDirectly(filename, content)` | ä¿å­˜æ–‡ä»¶åˆ°ä¸‹è½½ç›®å½• |
| `Android.vibrate(ms)` | éœ‡åŠ¨ |
| `Android.getDeviceId()` | è·å–è®¾å¤‡ ID |
| `Android.saveLoginCredentials(email, password)` | ä¿å­˜ç™»å½•å‡­æ® |
| `Android.getSavedLoginPassword()` | è¯»å–ä¿å­˜çš„å¯†ç  |
| `Android.isAutoLoginEnabled()` | æ£€æŸ¥è‡ªåŠ¨ç™»å½•çŠ¶æ€ |
| `Android.startFloatingTimer(taskName, elapsedTime, isPaused, appPackage)` | å¯åŠ¨æ‚¬æµ®çª—è®¡æ—¶å™¨ |
| `Android.stopFloatingTimer()` | åœæ­¢æ‚¬æµ®çª—è®¡æ—¶å™¨ |
| `Android.setWakeAlarm(timestamp, alarmId)` | è®¾ç½®èµ·åºŠé—¹é’Ÿ |
| `Android.setNapAlarm(timestamp, alarmId)` | è®¾ç½®å°ç¡é—¹é’Ÿ |
| `Android.cancelWakeAlarm()` | å–æ¶ˆèµ·åºŠé—¹é’Ÿ |

### æ¡Œé¢å°ç»„ä»¶

åº”ç”¨æ”¯æŒ 8 ç§æ¡Œé¢å°ç»„ä»¶ï¼Œåˆ†ä¸ºæ—¶é—´ä½™é¢å’Œå±å¹•æ—¶é—´ä¸¤ç±»ï¼Œæ¯ç±» 4 ç§æ ·å¼ï¼š

| ç±»å‹ | æ ·å¼ | Provider ç±»å | å¸ƒå±€æ–‡ä»¶ |
|------|------|--------------|----------|
| æ—¶é—´ä½™é¢ | æ¸å˜ | `BalanceWidgetProvider` | `widget_balance.xml` |
| æ—¶é—´ä½™é¢ | æ¯›ç»ç’ƒ | `BalanceWidgetGlassProvider` | `widget_balance_glass.xml` |
| æ—¶é—´ä½™é¢ | ç³»ç»Ÿé€æ˜ | `BalanceWidgetSystemProvider` | `widget_balance_system.xml` |
| æ—¶é—´ä½™é¢ | é«˜é€æ˜æ¸å˜ | `BalanceWidgetTransparentProvider` | `widget_balance_transparent.xml` |
| å±å¹•æ—¶é—´ | ç»å…¸æ¸å˜ | `ScreenTimeWidgetProvider` | `widget_screen_time_classic.xml` |
| å±å¹•æ—¶é—´ | æ¯›ç»ç’ƒ | `ScreenTimeWidgetGlassProvider` | `widget_screen_time_glass.xml` |
| å±å¹•æ—¶é—´ | ç³»ç»Ÿé€æ˜ | `ScreenTimeWidgetSystemProvider` | `widget_screen_time_system.xml` |
| å±å¹•æ—¶é—´ | é«˜é€æ˜æ¸å˜ | `ScreenTimeWidgetTransparentProvider` | `widget_screen_time_transparent.xml` |

**é…ç½®ä¿¡æ¯**: `res/xml/widget_*_info.xml`

---

## 1.7 å¸¸è§é—®é¢˜æ’æŸ¥

### Q: ä¿®æ”¹åé¡µé¢æ²¡å˜åŒ–ï¼Ÿ
1. æ¸…é™¤ WebView ç¼“å­˜ (Android è®¾ç½® â†’ åº”ç”¨ â†’ æ¸…é™¤æ•°æ®)
2. æ£€æŸ¥æ˜¯å¦åŒæ­¥äº†æ ¹ç›®å½•çš„ `index.html`
3. Service Worker å¯èƒ½ç¼“å­˜äº†æ—§æ–‡ä»¶

### Q: äº‘ç«¯æ•°æ®ä¸åŒæ­¥ï¼Ÿ
1. æ£€æŸ¥ç™»å½•çŠ¶æ€: æœç´¢ `cloudAuthState`
2. æŸ¥çœ‹ Watch ç›‘å¬: æœç´¢ `subscribeAll`
3. ç¡®è®¤ `_openid` å­—æ®µæ­£ç¡®

### Q: ä»»åŠ¡æ’åºä¸æŒä¹…åŒ–ï¼Ÿ
- `saveData()` ä¸ä¿å­˜ä»»åŠ¡åˆ°äº‘ç«¯
- éœ€è¦è°ƒç”¨ `DAL.saveTask(task)` åŒæ­¥æ¯ä¸ªä¿®æ”¹çš„ä»»åŠ¡

### Q: replace_string_in_file å¤±è´¥ï¼Ÿ
1. ä½¿ç”¨ `read_file` è¯»å–ç²¾ç¡®å†…å®¹
2. æ£€æŸ¥ç¼©è¿›å’Œç©ºæ ¼æ˜¯å¦å®Œå…¨åŒ¹é…
3. å°è¯•æ›´çŸ­çš„å”¯ä¸€å­—ç¬¦ä¸²

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šç‰ˆæœ¬æ›´æ–°æ—¥å¿—ï¼ˆæŠ€æœ¯æ—¥å¿—ï¼‰

> **ç›®æ ‡è¯»è€…**ï¼šæŠ€æœ¯ä¸“å®¶/å¼€å‘è€…  
> **ç›®çš„**ï¼šè®°å½•å…³é”®æŠ€æœ¯ç»†èŠ‚ï¼Œä¾¿äºæŠ€æœ¯å®¡è®¡ã€é—®é¢˜å›æº¯ã€æ¶æ„æ¼”è¿›ç†è§£  
> **é£æ ¼**ï¼šç²¾ç®€ã€æŠ€æœ¯å¯¼å‘ã€ä»£ç ç¤ºä¾‹ä¸ºä¸»  
> 
> âš ï¸ **å¼ºåˆ¶è§„åˆ™**ï¼šæ¯æ¬¡æ›´æ–°æ¶‰åŠå…³é”®æŠ€æœ¯ç»†èŠ‚æˆ–é‡è¦æ”¹åŠ¨æ—¶ï¼Œå¿…é¡»å°†å…¶æ·»åŠ åˆ°æ­¤éƒ¨åˆ†ã€‚

---

## ğŸ“‹ ä¸¤ç±»ç‰ˆæœ¬æ—¥å¿—çš„åŒºåˆ«

| ç»´åº¦ | AGENTS.md æŠ€æœ¯æ—¥å¿— | HTML ç”¨æˆ·æ—¥å¿— |
|------|-------------------|---------------|
| **ç›®æ ‡è¯»è€…** | æŠ€æœ¯ä¸“å®¶ã€å¼€å‘è€… | ç»ˆç«¯ç”¨æˆ· |
| **å†…å®¹é‡ç‚¹** | æ¶æ„å˜æ›´ã€æ•°æ®å±‚ä¿®æ”¹ã€æ¥å£åè®®ã€é—®é¢˜æ ¹å›  | åŠŸèƒ½ç‰¹æ€§ã€ç”¨æˆ·ä½“éªŒæ”¹è¿›ã€Bugä¿®å¤ |
| **å†™ä½œé£æ ¼** | ç²¾ç®€ã€ä»£ç ç¤ºä¾‹ã€è¡Œå·æ ‡æ³¨ | æ˜“è¯»ã€è¡¨æƒ…ç¬¦å·ã€ç”¨æˆ·ä»·å€¼å¯¼å‘ |
| **è¯¦ç»†ç¨‹åº¦** | å…³é”®æŠ€æœ¯ç‚¹å³å¯ | å¯é€‚åº¦è¯¦ç»†ï¼Œå±•ç¤ºå·¥ä½œæˆæœ |
| **å†…éƒ¨è¿­ä»£** | âŒ ä¸åŒ…å«ï¼ˆå¦‚é—´è·è°ƒæ•´ã€è¯­æ³•ä¿®å¤ï¼‰ | âœ… å¯åŒ…å«ï¼ˆå±•ç¤ºç»†è‡´å·¥ä½œï¼‰ |

---

## ğŸ“ æŠ€æœ¯æ—¥å¿—è®°å½•è§„èŒƒ

### æ ¼å¼è¦æ±‚
- **ç²¾ç®€æ–‡å­—**ï¼šé¿å…å†—é•¿æè¿°ï¼Œç”¨ä»£ç ç¤ºä¾‹æ›¿ä»£æ–‡å­—è¯´æ˜
- **æ ‡æ³¨ä¿®æ”¹**ï¼šä»£ç å—æ³¨æ˜ã€Œä¿®æ”¹å‰ â†’ ä¿®æ”¹åã€ä¾¿äºå›æº¯
- **å…³é”®ä½ç½®**ï¼šæ ‡æ³¨æ–‡ä»¶åå’Œå¤§è‡´è¡Œå·
- **é—®é¢˜é“¾**ï¼šå¤æ‚é—®é¢˜è®°å½•æ ¹å› é“¾ï¼ˆé—®é¢˜A â†’ å¯¼è‡´B â†’ è¡¨ç°ä¸ºCï¼‰
- **å¢é‡è®°å½•**ï¼šé€šè¿‡è®°å¿†å’Œä»£ç ä¸­æœç´¢å¸¦æœ‰å½“å‰ç‰ˆæœ¬å·çš„æ³¨é‡Šç»¼åˆæ’°å†™
- **æ’é™¤å†…éƒ¨ä¿®å¤**ï¼šæœ¬æ›´æ–°å‘¨æœŸå†…å¼•å…¥åˆè¢«ä¿®å¤çš„é”™è¯¯ä¸å†™å…¥

### âœ… è®°å½•å†…å®¹ï¼ˆæŠ€æœ¯å¯¼å‘ï¼‰
- **æ¶æ„/æ•°æ®å±‚**ï¼šåŒæ­¥æœºåˆ¶ã€å­˜å‚¨ç»“æ„ã€è·¨è®¾å¤‡ä¸€è‡´æ€§ã€æƒé™/å®‰å…¨è§„åˆ™
- **æ¥å£/åè®®å˜æ›´**ï¼šå½±å“å¤šç«¯æˆ–äº‘ç«¯æ•°æ®å…¼å®¹æ€§çš„å­—æ®µ/æ ¼å¼å˜æ›´
- **æ ¸å¿ƒæµç¨‹é‡æ„**ï¼šç»“ç®—é€»è¾‘ã€åˆå§‹åŒ–æµç¨‹ã€æ•°æ®ä¿®å¤å·¥å…·
- **é«˜é£é™© Bug ä¿®å¤**ï¼šä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€æ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨çš„é—®é¢˜

### âŒ ä¸è®°å½•å†…å®¹
- çº¯ UI/æ ·å¼/é—´è·/æ–‡å­—è°ƒæ•´
- ç®€å•æ•°å€¼è°ƒæ•´ï¼ˆå¦‚æ•°é‡ã€é—´éš”ã€é˜ˆå€¼ï¼‰
- æœ¬å‘¨æœŸå†…å¼•å…¥åˆä¿®å¤çš„å†…éƒ¨é”™è¯¯
- ç¼“å­˜ç‰ˆæœ¬å·/Service Worker åç§°æ›´æ–°

---

## ğŸ“ ç”¨æˆ·æ—¥å¿—æŒ‡å¯¼ï¼ˆHTML æ–‡ä»¶ä¸­ï¼‰

**ä½ç½®**ï¼š`index.html` çº¦ç¬¬ 6424 è¡Œï¼Œ`<details><summary>ç‰ˆæœ¬æ›´æ–°æ—¥å¿—</summary>` åŒºåŸŸå†…

**æ’°å†™åŸåˆ™**ï¼š
- é¢å‘ç”¨æˆ·ï¼Œä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€
- ä½¿ç”¨è¡¨æƒ…ç¬¦å·å¢åŠ å¯è¯»æ€§ï¼ˆğŸ¦ ğŸ’° ğŸ“Š ç­‰ï¼‰
- çªå‡ºç”¨æˆ·ä»·å€¼ï¼š"ä½ èƒ½è·å¾—ä»€ä¹ˆ"
- å¯åŒ…å«å†…éƒ¨ä¼˜åŒ–ï¼ˆå±•ç¤ºå›¢é˜Ÿçš„ç»†è‡´å·¥ä½œï¼‰
- æŒ‰ç‰ˆæœ¬é™åºæ’åˆ—ï¼Œæœ€æ–°ç‰ˆæœ¬åœ¨æœ€ä¸Š

**æ¨¡æ¿**ï¼š
```html
<div class="version-history-item">
    <p><strong>ç‰ˆæœ¬ vX.X.X (YYYY-MM-DD)</strong> ğŸ¦ <b>å¤§åŠŸèƒ½åç§°</b></p>
    <ul>
        <li><strong>[Feat]</strong> ğŸ¦ <b>åŠŸèƒ½å</b>ï¼šç”¨æˆ·èƒ½æ„ŸçŸ¥åˆ°çš„åŠŸèƒ½æè¿°</li>
        <li><strong>[Fix]</strong> ğŸ›¡ï¸ <b>ä¿®å¤é¡¹</b>ï¼šä¿®å¤äº†ä»€ä¹ˆé—®é¢˜ï¼Œå¸¦æ¥ä»€ä¹ˆæ”¹å–„</li>
    </ul>
</div>
```

---
## v7.19.0 (2026-02-21) - ç¡çœ é—¹é’Ÿå¯é æ€§å¢å¼ºä¸ç³»ç»Ÿæ—¶é’ŸåŒæ­¥

### å…³é”®æ”¹åŠ¨

#### 1) ç³»ç»Ÿæ—¶é’Ÿé—¹é’ŸåŒæ­¥æ¡¥æ¥ [v7.19.0]
**æ–‡ä»¶**: `WebAppInterface.java` (~L420-485), `index.html` (~L29060-29250)

**é—®é¢˜é“¾**:
```text
ç¡çœ é—¹é’Ÿä»…ä¿å­˜åœ¨ App å†… AlarmManager
â†’ è®¾å¤‡é‡å¯/å…³æœºåè¯¥è®¡åˆ’å¯èƒ½å¤±æ•ˆ
â†’ ç”¨æˆ·æœªä¸»åŠ¨è¿›å…¥ App æ—¶æ— æ³•åŠæ—¶é‡å»º
â†’ èµ·åºŠæé†’æ¼è§¦å‘é£é™©é«˜
```

**ä¿®å¤**:
```text
- æ–°å¢ JS Bridge: canSetSystemAlarm() / syncSystemAlarm(triggerAtMillis, label)
- å…¥ç¡å€’è®¡æ—¶å®Œæˆåï¼Œåœ¨å¤œé—´é—¹é’Ÿ schedule æˆåŠŸæ—¶é»˜è®¤åŒæ­¥ç³»ç»Ÿæ—¶é’Ÿé—¹é’Ÿ
- åŒæ­¥èƒ½åŠ›é€šè¿‡ resolveActivity æ£€æµ‹ï¼Œä¸æ”¯æŒæ—¶é™çº§ä¸º App å†…é—¹é’Ÿ
```

#### 2) é—¹é’Ÿå¼ºæé†’é»˜è®¤æœ€å¤§åŒ– [v7.19.0]
**æ–‡ä»¶**: `AlarmReceiver.java` (~L18-145)

**ä¿®å¤**:
```text
ä¿®æ”¹å‰: ä»… nap(alarmId=2) èµ°é«˜ä¼˜å…ˆçº§ï¼Œå…¶å®ƒé—¹é’Ÿèµ°æ™®é€šé€šé“
ä¿®æ”¹å: æ‰€æœ‰ ALARM_TRIGGER* ç»Ÿä¸€èµ°å¼ºæé†’é€šé“
  - PRIORITY_MAX + CATEGORY_ALARM + VISIBILITY_PUBLIC
  - DEFAULT_ALL + é—¹é’Ÿé“ƒå£° + æ³¢å½¢æŒ¯åŠ¨
  - é€šé“æ”¯æŒ bypass DNDï¼Œç¡®ä¿é”å±æé†’å¼ºåº¦
```

#### 3) å…¥ç¡å€’è®¡æ—¶å¡ç‰‡å¢åŠ é—¹é’Ÿæ§åˆ¶ [v7.19.0]
**æ–‡ä»¶**: `index.html` (~L29060-29150, ~L27736)

**ä¿®å¤**:
```text
- æ–°å¢ sleepSettings.autoSyncSystemAlarmï¼ˆé»˜è®¤ trueï¼‰
- å€’è®¡æ—¶å¡ç‰‡å¢åŠ â€œåŒæ­¥åˆ°ç³»ç»Ÿæ—¶é’Ÿé—¹é’Ÿï¼ˆé»˜è®¤å¼€å¯ï¼‰â€å¼€å…³
- ä¿ç•™â€œæœ¬æ¬¡ä¸å“é—¹é’Ÿâ€å¼€å…³
- å¡ç‰‡ä¸­å¢åŠ ç³»ç»ŸåŒæ­¥å¯ç”¨æ€§/åŒæ­¥ç»“æœçŠ¶æ€æç¤º
```

#### 4) å‰å°ç«‹å³åŒæ­¥ + ä¼šè¯çº§é—¹é’Ÿé…ç½® [v7.19.0-fix]
**æ–‡ä»¶**: `index.html` (~L29070-29310), `WebAppInterface.java` (~L470-560)

**é—®é¢˜é“¾**:
```text
åŸæ–¹æ¡ˆåœ¨â€œå€’è®¡æ—¶ç»“æŸåâ€æ‰å°è¯• ACTION_SET_ALARM
â†’ è®¾å¤‡å¯èƒ½å·²é”å±/åå°
â†’ ç³»ç»Ÿé™åˆ¶åå°æ‹‰èµ· Activity
â†’ ç³»ç»Ÿæ—¶é’Ÿé—¹é’Ÿæœªåˆ›å»ºä½†ç”¨æˆ·æ— æ„ŸçŸ¥
```

**ä¿®å¤**:
```text
- åŒæ­¥å‰ç§»ï¼šshowSleepCountdownModal æ‰“å¼€åç«‹å³å°è¯•ç³»ç»Ÿé—¹é’ŸåŒæ­¥
- æ–°å¢ syncSystemAlarmWithResult(triggerAt, label, allowUiFallback)
  * skip_ui å¤±è´¥æ—¶å¯é™çº§ with_ui
  * è¿”å› success/reason/error ç»™å‰ç«¯å±•ç¤º
- å€’è®¡æ—¶å¼¹çª—æ–°å¢ä¼šè¯çº§é…ç½® sleepCountdownSession
  * æ¨¡å¼åˆ‡æ¢ï¼šauto/night/nap
  * å°ç¡é—¹é’Ÿï¼šæŒ‰æ—¶é•¿ or è‡ªå®šä¹‰æ—¶åˆ»
  * å¤œé—´é—¹é’Ÿï¼šduration/wakeTime/customTime/none
```

#### 5) è‡ªåŠ¨åˆ¤å®šæ¨¡å¼ + å››é€‰é¡¹é—¹é’Ÿé‡æ„ [v7.19.0-fix4]
**æ–‡ä»¶**: `index.html` (~L29100-29520)

**ä¿®å¤**:
```text
- æœ¬æ¬¡ç¡çœ æ¨¡å¼ç§»é™¤â€œè‡ªåŠ¨â€æŒ‰é’®ï¼šé»˜è®¤æŒ‰ detectSleepTypeAtStart è‡ªåŠ¨åˆ¤å®šå¤œé—´/å°ç¡
- å¤œé—´/å°ç¡æ»‘å—æ”¹ä¸ºå¯ç‚¹å‡»æ‰‹åŠ¨åˆ‡æ¢ï¼ˆä»…ä¸¤ä¸ªæ»‘å—ï¼‰
- å¤œé—´é—¹é’Ÿå››é€‰é¡¹æ”¹ä¸ºï¼šæŒ‰è®¡åˆ’æ—¶é—´ / è‡ªå®šä¹‰æ—¶é—´ / æŒ‰è®¡åˆ’æ—¶é•¿ / è‡ªå®šä¹‰æ—¶é•¿
- å°ç¡é—¹é’ŸåŒæ­¥æ”¹é€ ä¸ºå¯¹åº”å››é€‰é¡¹ï¼šæŒ‰è®¡åˆ’æ—¶é—´ / è‡ªå®šä¹‰æ—¶é—´ / æŒ‰è®¡åˆ’æ—¶é•¿ / è‡ªå®šä¹‰æ—¶é•¿
- ä¿ç•™â€œæœ¬æ¬¡ä¸æƒ³é—¹é’Ÿâ€ï¼Œå¹¶ä¸Šç§»åˆ°å¤œé—´/å°ç¡é—¹é’Ÿæ¨¡å—åº•éƒ¨
- å¼¹çª—æ–‡æ¡ˆç²¾ç®€ï¼šåˆ é™¤â€œå€’è®¡æ—¶ç»“æŸåå¼€å§‹...â€è¯´æ˜ï¼Œå°†å€’è®¡æ—¶ä¸Šç§»è‡³æ ‡é¢˜ä¸‹æ–¹
```

#### 6) é—¹é’Ÿæ¨¡å¼äºŒé€‰ä¸€ä¸ç´§å‡‘è¾“å…¥å¸ƒå±€ [v7.19.0-fix5]
**æ–‡ä»¶**: `index.html` (~L29290-29420)

**ä¿®å¤**:
```text
- å¤œé—´/å°ç¡é—¹é’Ÿä»å››é€‰é¡¹æ”¶æ•›ä¸ºä¸¤é€‰é¡¹ï¼šæŒ‰æ—¶é—´ / æŒ‰æ—¶é•¿
- åº•éƒ¨è¾“å…¥åŒºæ”¹ä¸ºæ¨ªå‘ç´§å‡‘å¸ƒå±€ï¼šå·¦ä¾§åŠå®½è¾“å…¥ï¼ˆtime/numberï¼‰ï¼Œå³ä¾§å®æ—¶æ˜¾ç¤ºé¢„è®¡å“é“ƒæ—¶é—´
- è¾“å…¥å€¼é»˜è®¤å¸¦å…¥å½“å‰è®¡åˆ’é…ç½®ï¼ˆè®¡åˆ’æ—¶é—´/è®¡åˆ’æ—¶é•¿ï¼‰ï¼Œç”¨æˆ·å¯ç›´æ¥ä¿®æ”¹
- ä¿ç•™â€œæœ¬æ¬¡ä¸æƒ³é—¹é’Ÿâ€å¼€å…³ï¼Œç»§ç»­æ”¾åœ¨å„é—¹é’Ÿæ¨¡å—åº•éƒ¨
```

#### 7) å°ç¡æ—¶é•¿åŒè¾“å…¥ç»Ÿä¸€ + ç³»ç»Ÿé—¹é’Ÿå¤±è´¥è¯Šæ–­å¢å¼º [v7.19.0-fix6]
**æ–‡ä»¶**: `index.html` (~L29100-29380), `WebAppInterface.java` (~L435-560), `AndroidManifest.xml` (~L6-12)

**é—®é¢˜é“¾**:
```text
å°ç¡â€œæŒ‰æ—¶é•¿â€ä»æ˜¯å•è¾“å…¥åˆ†é’Ÿï¼Œè€Œå¤œé—´å·²æ˜¯å°æ—¶+åˆ†
â†’ ä¸¤å¥—äº¤äº’ä¸ä¸€è‡´ï¼Œä¸”æ—¶é•¿è¾“å…¥ä¸ç›´è§‚

ç³»ç»Ÿé—¹é’ŸåŒæ­¥å¤±è´¥ä»…è¿”å› reason=exception
â†’ å‰ç«¯æ— æ³•åŒºåˆ†æƒé™ç¼ºå¤±/æ— æ—¶é’Ÿåº”ç”¨/é™é»˜åˆ›å»ºå¤±è´¥
â†’ ç”¨æˆ·å³ä½¿å·²æˆæƒä¹Ÿåªèƒ½çœ‹åˆ°â€œåŒæ­¥å¤±è´¥ï¼šexceptionâ€
```

**ä¿®å¤**:
```text
- å°ç¡æŒ‰æ—¶é•¿æ”¹ä¸ºâ€œå°æ—¶+åˆ†â€åŒè¾“å…¥ï¼ˆä¸å¤œé—´å®Œå…¨ä¸€è‡´ï¼‰
  * æ–°å¢ napDurationHoursPart/napDurationMinutesPart ä¼šè¯å­—æ®µ
  * getSleepNapDurationMinutesFromSession() ç»Ÿä¸€æ¢ç®—å¹¶çº¦æŸ [5,240] åˆ†é’Ÿ
  * é¢„è®¡å“é“ƒæ—¶é—´ä¸é—¹é’Ÿè®¡åˆ’ç»Ÿä¸€ä½¿ç”¨è¯¥æ¢ç®—å€¼

- ç³»ç»Ÿé—¹é’ŸåŒæ­¥å¤±è´¥åŸå› ç»†åŒ–
  * Manifest æ–°å¢ com.android.alarm.permission.SET_ALARM
  * syncSystemAlarmWithResult è¿”å› reason/error/errorMessage æ˜ç»†
    - missing_set_alarm_permission / no_alarm_app
    - skip_ui_exception / with_ui_exception / exception
  * å‰ç«¯æ–°å¢ formatSystemAlarmSyncFailureReason() æ˜ å°„å‹å¥½æ–‡æ¡ˆ
  * åœ¨ exception/skip_ui_exception åœºæ™¯è‡ªåŠ¨å°è¯• legacy syncSystemAlarm() å…œåº•
```

  #### 8) åŒæ­¥å¤±è´¥è¯¦æƒ…å¼¹çª— + ç³»ç»Ÿé—¹é’Ÿæ’¤é”€è”åŠ¨ [v7.19.0-fix7]
  **æ–‡ä»¶**: `index.html` (~L29180-29520), `WebAppInterface.java` (~L590-710)

  **é—®é¢˜é“¾**:
  ```text
  å‰ç«¯ä»…æ˜¾ç¤ºâ€œåŒæ­¥å¤±è´¥â€çŸ­æ–‡æ¡ˆ
  â†’ æ™®é€šç”¨æˆ·æ— æ³•åˆ¤æ–­æ˜¯æƒé™é—®é¢˜è¿˜æ˜¯ç³»ç»Ÿé™åˆ¶
  â†’ æ— æ³•å¿«é€Ÿè·³åˆ°æ­£ç¡®è®¾ç½®é¡µå¤„ç†

  ç”¨æˆ·å–æ¶ˆâ€œæœ¬æ¬¡ç¡çœ å€’è®¡æ—¶â€å
  â†’ ä¹‹å‰å·²åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é’Ÿçš„é—¹é’Ÿä»å¯èƒ½ä¿ç•™
  â†’ å‡ºç°â€œå·²å–æ¶ˆç¡çœ ä½†ç³»ç»Ÿä»å“é“ƒâ€ä½“éªŒä¸ä¸€è‡´
  ```

  **ä¿®å¤**:
  ```text
  - å‰ç«¯æ–°å¢å¤±è´¥è¯¦æƒ…å¼¹çª— showSleepSystemSyncDetailModal()
    * å±•ç¤ºï¼šå¤±è´¥åŸå› ã€ç›®æ ‡æ—¶é—´ã€ç”¨æˆ·å¯è¯»å»ºè®®ã€ç³»ç»ŸåŸå§‹é”™è¯¯
    * æŒ‰ reason æ˜¾ç¤ºå¯æ‰§è¡Œå¼•å¯¼ï¼ˆå¦‚æƒé™é—®é¢˜æ˜¾ç¤ºâ€œå»ç³»ç»Ÿé—¹é’Ÿè®¾ç½®â€ï¼‰

  - æ–°å¢ç³»ç»Ÿé—¹é’Ÿæ’¤é”€æ¡¥æ¥ dismissSystemAlarmWithResult(triggerAtMillis, label)
    * å–æ¶ˆç­–ç•¥ï¼šæŒ‰æ ‡ç­¾ä¼˜å…ˆï¼ˆACTION_DISMISS_ALARM + ALARM_SEARCH_MODE_LABELï¼‰
    * å¤±è´¥å…œåº•ï¼šæŒ‰æ—¶é—´å†å°è¯•ï¼ˆALARM_SEARCH_MODE_TIMEï¼‰
    * è¿”å› success/reason/error/errorMessage ç»™å‰ç«¯

  - cancelSleepCountdown() å¢åŠ è”åŠ¨
    * è‹¥æœ¬æ¬¡å·²åŒæ­¥ç³»ç»Ÿé—¹é’Ÿï¼Œå–æ¶ˆå€’è®¡æ—¶æ—¶è‡ªåŠ¨å°è¯•æ’¤é”€ç³»ç»Ÿé—¹é’Ÿ
    * å–æ¶ˆå¤±è´¥æ—¶å¯ç›´æ¥é€šè¿‡â€œæŸ¥çœ‹å¤±è´¥è¯¦æƒ…â€è¿›å…¥å¯è¯»è¯Šæ–­ä¸è®¾ç½®è·³è½¬
  ```

  #### 9) é»˜è®¤åŒæ­¥ä¸æœ¬æ¬¡åˆ›å»ºæ‹†åˆ† [v7.19.0-fix8]
  **æ–‡ä»¶**: `index.html` (~L29220-29520)

  **ä¿®å¤**:
  ```text
  - å‹¾é€‰æ¡†è¯­ä¹‰æ”¹ä¸ºâ€œé»˜è®¤åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é’Ÿé—¹é’Ÿâ€ï¼ˆå†™å…¥ sleepSettings.autoSyncSystemAlarmï¼‰
  - å°†åŸâ€œç«‹å³åŒæ­¥â€æŒ‰é’®æ”¹ä¸ºä¼šè¯çº§å¼€å…³ï¼š
    * å·²å¼€å¯æ—¶æ˜¾ç¤ºâ€œæœ¬æ¬¡ä¸åˆ›å»ºç³»ç»Ÿé—¹é’Ÿâ€
    * å·²å…³é—­æ—¶æ˜¾ç¤ºâ€œæœ¬æ¬¡åˆ›å»ºç³»ç»Ÿé—¹é’Ÿâ€
  - å½“ä»â€œæœ¬æ¬¡åˆ›å»ºâ€åˆ‡æ¢åˆ°â€œä¸åˆ›å»ºâ€ä¸”å½“å‰å·²å­˜åœ¨å·²åŒæ­¥é—¹é’Ÿæ—¶ï¼š
    * å…ˆå°è¯• dismissSystemAlarmWithResult æ’¤é”€
    * å†è·³è½¬ openAlarmSettingsï¼Œå¼•å¯¼ç”¨æˆ·åœ¨ç³»ç»Ÿæ—¶é’Ÿé¡µç¡®è®¤å–æ¶ˆ
  ```

  #### 10) ä¸‰å¼€å…³é—¹é’Ÿæ¨¡å‹é‡æ„ï¼ˆä¸»å¼€å…³ä¼˜å…ˆï¼‰[v7.19.0-fix9]
  **æ–‡ä»¶**: `index.html` (~L27745, ~L29100-29620)

  **ä¿®å¤**:
  ```text
  - å…¥ç¡å€’è®¡æ—¶é—¹é’Ÿé€»è¾‘æ”¶æ•›ä¸ºä¸‰å¼€å…³ï¼š
    1) å¼€å¯é—¹é’Ÿï¼ˆsleepSettings.sleepAlarmEnabledï¼Œé»˜è®¤å¼€å¯ï¼ŒæŒä¹…åŒ–ï¼‰
    2) æœ¬æ¬¡ä¸æƒ³é—¹é’Ÿï¼ˆsleepCountdownSkipAlarmï¼Œä¼šè¯çº§ï¼‰
    3) é»˜è®¤åŒæ­¥ç³»ç»Ÿé—¹é’Ÿï¼ˆsleepSettings.autoSyncSystemAlarmï¼ŒæŒä¹…åŒ–ï¼‰

  - åˆ é™¤â€œæœ¬æ¬¡åˆ›å»ºç³»ç»Ÿé—¹é’Ÿ/æœ¬æ¬¡ä¸åˆ›å»ºç³»ç»Ÿé—¹é’Ÿâ€æŒ‰é’®é€»è¾‘ï¼Œé¿å…é‡å¤æ§åˆ¶æº

  - åŒæ­¥è”åŠ¨è§„åˆ™ç»Ÿä¸€ï¼šä»…å½“ã€å¼€å¯é—¹é’Ÿ=å¼€ ä¸” æœ¬æ¬¡ä¸å“=å…³ ä¸” åŒæ­¥å¼€å…³=å¼€ã€‘æ‰æ‰§è¡Œç³»ç»ŸåŒæ­¥
    * ä»»ä¸€æ¡ä»¶å˜ä¸ºä¸æ»¡è¶³æ—¶ï¼Œè‹¥å·²åŒæ­¥è¿‡ç³»ç»Ÿé—¹é’Ÿåˆ™å°è¯• dismissSystemAlarmWithResult æ’¤é”€
    * åŒ…æ‹¬ï¼šå…³é—­é—¹é’Ÿæ€»å¼€å…³ã€å¼€å¯â€œæœ¬æ¬¡ä¸æƒ³é—¹é’Ÿâ€ã€å…³é—­â€œé»˜è®¤åŒæ­¥ç³»ç»Ÿé—¹é’Ÿâ€
  ```

  #### 11) å€’è®¡æ—¶ç¡®è®¤ååˆ›å»ºé—¹é’Ÿ + è‡ªåŠ¨åˆ›å»ºæ—¶æœºåç§» [v7.19.0-fix10]
  **æ–‡ä»¶**: `index.html` (~L29020-29780)

  **ä¿®å¤**:
  ```text
  - ç§»é™¤â€œæ‰“å¼€å€’è®¡æ—¶å¼¹çª—å³è‡ªåŠ¨åŒæ­¥ç³»ç»Ÿé—¹é’Ÿâ€çš„è¡Œä¸ºï¼ˆåˆ é™¤ modal-open è‡ªåŠ¨åŒæ­¥ï¼‰
  - é—¹é’Ÿåˆ›å»ºæ—¶æœºæ”¹ä¸ºï¼š
    1) å€’è®¡æ—¶ç»“æŸåï¼ˆåŸæœ‰è‡ªåŠ¨æµç¨‹ï¼‰
    2) ç”¨æˆ·ç‚¹å‡»å€’è®¡æ—¶å¼¹çª—â€œç¡®è®¤â€æŒ‰é’®åç«‹å³åˆ›å»ºï¼ˆæ–°å¢ï¼‰

  - å€’è®¡æ—¶å¼¹çª—åº•éƒ¨æ”¹ä¸ºåŒæŒ‰é’®ï¼šå–æ¶ˆ + ç¡®è®¤
    * ç¡®è®¤ï¼šå…³é—­å¼¹çª—å¹¶æŒ‰å½“å‰è®¾ç½®ç«‹å³åˆ›å»ºé—¹é’Ÿï¼ˆè‹¥æ»¡è¶³æ¡ä»¶ï¼‰
    * ä¸ç‚¹å‡»ç¡®è®¤ï¼šä¸å½±å“å€’è®¡æ—¶ç»“æŸåè¿›å…¥ç¡çœ ä¸è‡ªåŠ¨åˆ›å»ºé€»è¾‘

  - æ–°å¢ sleepCountdownAlarmPrepared å»é‡
    * è‹¥ç¡®è®¤é˜¶æ®µå·²åˆ›å»º App é—¹é’Ÿï¼Œå€’è®¡æ—¶ç»“æŸé˜¶æ®µä¸é‡å¤åˆ›å»º

  - getSleepAlarmPlan(duration æ¨¡å¼) æ”¹ä¸ºåŸºäºä¼ å…¥ baseTime è®¡ç®—
    * ç¡®ä¿â€œç¡®è®¤æå‰åˆ›å»ºâ€ä¸â€œå€’è®¡æ—¶ç»“æŸåˆ›å»ºâ€ç›®æ ‡æ—¶é—´ä¸€è‡´
  ```

  #### 12) ç¡®è®¤æŒ‰é’®æ”¹ä¸ºâ€œç«‹å³ç»“æŸå€’è®¡æ—¶å¹¶å…¥ç¡â€ [v7.19.0-fix11]
  **æ–‡ä»¶**: `index.html` (~L29390-29410)

  **ä¿®å¤**:
  ```text
  - confirmSleepCountdownAndPrepareAlarm() ä¸å†ä»…å…³é—­å¼¹çª—
  - ç‚¹å‡»â€œç¡®è®¤â€åï¼š
    1) å°† sleepCountdownState.endTime æ”¶å£ä¸ºå½“å‰æ—¶é—´
    2) æŒ‰â€œå½“å‰æ—¶åˆ»â€å‡†å¤‡é—¹é’Ÿè®¡åˆ’
    3) ç«‹å³è°ƒç”¨ startSleepRecording() è¿›å…¥ç¡çœ 

  - ç»“æœï¼šç¡®è®¤æŒ‰é’®è¯­ä¹‰ä¸ç”¨æˆ·é¢„æœŸä¸€è‡´ï¼ˆç¡®è®¤å³å…¥ç¡ï¼‰ï¼Œä¸å†å‡ºç°â€œä»…å…³å¼¹çª—ã€å€’è®¡æ—¶ç»§ç»­â€
  ```

  #### 13) é¦–é¡µå–æ¶ˆç¡çœ è”åŠ¨ç³»ç»Ÿé—¹é’Ÿè®¾ç½® [v7.19.0-fix12]
  **æ–‡ä»¶**: `index.html` (~L30000-30120)

  **ä¿®å¤**:
  ```text
  - é€šè¿‡é¦–é¡µç¡çœ å¡ç‰‡æ‰§è¡Œ cancelSleep() æ—¶ï¼š
    1) è‹¥å­˜åœ¨å·²åŒæ­¥ç³»ç»Ÿé—¹é’Ÿï¼Œå…ˆå°è¯• dismissSystemAlarmWithResult æ’¤é”€
    2) è‡ªåŠ¨è°ƒç”¨ openAlarmSettings è·³è½¬ç³»ç»Ÿé—¹é’Ÿé¡µ

  - ç›®çš„ï¼šè®©ç”¨æˆ·åœ¨â€œå–æ¶ˆç¡çœ â€åå¯ç«‹å³åœ¨ç³»ç»Ÿæ—¶é’Ÿä¸­ç¡®è®¤å…³é—­æ®‹ç•™é—¹é’Ÿ
  ```

  #### 14) é…ç½®å˜æ›´ä¸å†è§¦å‘å³æ—¶å»ºé—¹é’Ÿ [v7.19.0-fix13]
  **æ–‡ä»¶**: `index.html` (~L29430-29630)

  **é—®é¢˜é“¾**:
  ```text
  ç”¨æˆ·åœ¨å€’è®¡æ—¶å¼¹çª—å†…åˆ‡æ¢â€œå°ç¡/å¤œé—´â€æˆ–ä¿®æ”¹è¾“å…¥
  â†’ refreshSleepAlarmInfoPanel(true) è§¦å‘ auto-refresh åŒæ­¥
  â†’ åœ¨æœªç¡®è®¤ã€æœªå€’è®¡æ—¶ç»“æŸå‰å³åˆ›å»ºç³»ç»Ÿé—¹é’Ÿ
  â†’ ä¸â€œä»…ç¡®è®¤/å€’è®¡æ—¶ç»“æŸåˆ›å»ºâ€è§„åˆ™å†²çª
  ```

  **ä¿®å¤**:
  ```text
  - setSleepCountdownMode / setSleep*AlarmType / setSleep*FromInput ç»Ÿä¸€æ”¹ä¸º refreshSleepAlarmInfoPanel(false)
  - onSleepSystemAlarmToggle / onSleepAlarmEnabledToggle / onSleepSkipAlarmToggle åœ¨â€œæ‰“å¼€â€åœºæ™¯ä¸å†ä¸»åŠ¨ sync
  - ä¿ç•™â€œå…³é—­â€åœºæ™¯çš„æ’¤é”€é€»è¾‘ï¼ˆè‹¥å·²æœ‰å·²åŒæ­¥é—¹é’Ÿåˆ™å°è¯• dismissï¼‰

  - å½“å‰åˆ›å»ºæ—¶æœºï¼ˆæ”¶æ•›åï¼‰ï¼š
    1) ç‚¹å‡»å€’è®¡æ—¶å¼¹çª—â€œç¡®è®¤â€
    2) å€’è®¡æ—¶è‡ªç„¶ç»“æŸè¿›å…¥ç¡çœ 
  ```

---
## v7.18.5 (2026-02-15) - æ‚¬æµ®çª—ç‚¹å‡»è·³è½¬ä¿®å¤ + æ‹–æ‹½è¾¹ç•Œçº¦æŸ

### å…³é”®æ”¹åŠ¨

#### 1) openApp() å”¤é†’ç­–ç•¥é‡æ„ [v7.18.5]
**æ–‡ä»¶**: `FloatingTimerService.java` (~L763-795)

**é—®é¢˜é“¾**:
```text
openApp() ä»¥ moveTaskToFront() ä¸ºé¦–é€‰æ–¹æ³• â†’ è°ƒç”¨åç«‹å³ return
â†’ moveTaskToFront() åœ¨æ¸¸æˆæ²‰æµ¸æ¨¡å¼ä¸‹é™é»˜å¤±è´¥ï¼ˆä¸æŠ›å¼‚å¸¸ä½†ä¸ç”Ÿæ•ˆï¼‰
â†’ æ›´å¯é çš„ startActivity() ä½œä¸ºç¬¬4å…œåº•æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ
â†’ ç¬¬ä¸€æ¬¡ç‚¹å‡»åªæœ‰éœ‡åŠ¨åé¦ˆæ— è·³è½¬ï¼Œç¬¬äºŒæ¬¡æ‰æˆåŠŸï¼ˆç³»ç»ŸçŠ¶æ€å·²å˜åŒ–ï¼‰
```

**ä¿®å¤**:
```text
ä¿®æ”¹å‰: moveTaskToFront (primary, early return) â†’ AlarmManager â†’ å…¨å±é€šçŸ¥ â†’ startActivity (fallback)
ä¿®æ”¹å: startActivity (primary, å‰å°æœåŠ¡å¯é ) + moveTaskToFront (complement, ä¸ early return)
- ç§»é™¤ AlarmManager å”¤é†’ï¼ˆå¼•å…¥å»¶è¿Ÿã€è¿‡äºæ¿€è¿›ï¼‰
- ç§»é™¤ showFullScreenNotificationï¼ˆæœ‰ bug ä¸”è¿‡äºæ¿€è¿›ï¼‰
- ä¸¤ä¸ªæ–¹æ³•å‡æ‰§è¡Œï¼Œä¸ä¾èµ–å•ä¸€æ–¹æ³•çš„è¿”å›å€¼
```

#### 2) wakeUpFromImmersive ç®€åŒ–ä¸º performClickFeedback [v7.18.5]
**æ–‡ä»¶**: `FloatingTimerService.java` (~L737-752)

**é—®é¢˜**: æ—§æ–¹æ³•åœ¨æ¯æ¬¡ç‚¹å‡»æ—¶æ‰§è¡Œã€Œå¾®è°ƒä½ç½® x+1 å†æ¢å¤ã€ï¼Œå¼ºåˆ¶ WindowManager åˆ·æ–°ã€‚è¯¥æ“ä½œåœ¨éƒ¨åˆ†è®¾å¤‡ä¸Šå¹²æ‰°ç³»ç»ŸçŠ¶æ€ï¼Œå¯¼è‡´éæ¸¸æˆåº”ç”¨ä¹Ÿå‡ºç°ç‚¹å‡»å¤±æ•ˆ

**ä¿®å¤**: ç§»é™¤ä½ç½®å¾®è°ƒæ“ä½œï¼Œä»…ä¿ç•™ 15ms è½»éœ‡åŠ¨ä½œä¸ºç‚¹å‡»è§¦è§‰åé¦ˆ

#### 3) ç§»é™¤ FLAG_LAYOUT_NO_LIMITS + æ‹–æ‹½è¾¹ç•Œçº¦æŸ [v7.18.5]
**æ–‡ä»¶**: `FloatingTimerService.java` (~L505, ~L298, ~L650)

**é—®é¢˜**: `FLAG_LAYOUT_NO_LIMITS` å…è®¸è§†å›¾å¸ƒå±€è¶…å‡ºå±å¹•è¾¹ç•Œï¼ˆè¯¥ flag ä¸å½±å“è§¦æ‘¸äº‹ä»¶ï¼Œ`FLAG_NOT_TOUCH_MODAL` æ‰è´Ÿè´£è§¦æ‘¸ï¼‰ã€‚æ‹–æ‹½ä»£ç æ— è¾¹ç•Œæ£€æŸ¥ï¼Œç”¨æˆ·å¯å°†æ‚¬æµ®çª—æ‹–è‡³å±å¹•å¤–

**ä¿®å¤**:
```text
- ç§»é™¤ FLAG_LAYOUT_NO_LIMITSï¼ˆä»…ä¿ç•™ FLAG_NOT_FOCUSABLE | FLAG_NOT_TOUCH_MODALï¼‰
- æ–°å¢ clampPositionToScreen(): çº¦æŸ currentX/Y åœ¨ [0, screenSize-48dp] èŒƒå›´å†…
- åœ¨ 5 ä¸ªä½ç½®è°ƒç”¨: setupFloatingViewã€ACTION_MOVE æ‹–æ‹½ã€saveCurrentPosition å‰ã€
  onConfigurationChanged å±å¹•æ—‹è½¬ã€loadSavedPositions å
```

#### 4) ç§»é™¤ showFullScreenNotification [v7.18.5]
**é—®é¢˜**: é€šçŸ¥ cancel ä½¿ç”¨æ–°çš„ `System.currentTimeMillis()` ä½œä¸º IDï¼Œä¸ notify æ—¶çš„ ID ä¸åŒï¼Œæ°¸è¿œæ— æ³•å–æ¶ˆã€‚ä¸”è¯¥æ–¹æ³•ä½œä¸ºå”¤é†’æ‰‹æ®µè¿‡äºæ¿€è¿›

**ä¿®å¤**: æ•´ä½“ç§»é™¤ï¼Œç”±ç®€åŒ–çš„ openApp() æ›¿ä»£

---
## v7.18.3 (2026-02-13) - æ‚¬æµ®çª—æš‚åœ/æ¢å¤åŒæ­¥ä¿®å¤ + æ²‰æµ¸æ¨¡å¼å”¤é†’å¢å¼º

### å…³é”®æ”¹åŠ¨

#### 1) æ‚¬æµ®çª—ä¸ä»»åŠ¡è®¡æ—¶åŒæ­¥ä¿®å¤ [v7.18.3]
**é—®é¢˜**: åœ¨å…³è”åº”ç”¨å†…ç‚¹å‡»æ‚¬æµ®çª—è·³è½¬å› Time Bank æ—¶ï¼Œæ‚¬æµ®çª—æ˜¾ç¤ºæš‚åœ â¸ï¼Œä½†å‰ç«¯ä»»åŠ¡è®¡æ—¶ä»åœ¨ç»§ç»­

**æ ¹å› **: æ‚¬æµ®çª—ç‚¹å‡»æš‚åœåªå½±å“ Android Service å†…éƒ¨çŠ¶æ€ï¼Œæ— æ³•é€šçŸ¥å‰ç«¯ JavaScript å±‚

**ä¿®å¤æ–¹æ¡ˆ**:
```text
æ–‡ä»¶: FloatingTimerService.java (L714-759)
- æ–°å¢ notifyWebView(action, taskName) æ–¹æ³•å‘é€å¹¿æ’­
- handleFloatingTimerClick() ä¸­æš‚åœ/æ¢å¤åè°ƒç”¨ notifyWebView()

æ–‡ä»¶: MainActivity.java (L1-200)
- æ–°å¢ floatingTimerReceiver å¹¿æ’­æ¥æ”¶å™¨
- onCreate() ä¸­æ³¨å†Œæ¥æ”¶å™¨ï¼Œæ¥æ”¶å¹¿æ’­åè°ƒç”¨ WebView.evaluateJavascript()
- onDestroy() ä¸­æ³¨é”€æ¥æ”¶å™¨

æ–‡ä»¶: index.html (L19137)
- æ–°å¢ window.__onFloatingTimerAction(action, taskName) å…¨å±€å›è°ƒ
- æ ¹æ® action è°ƒç”¨ pauseTask() æˆ– resumeTask() åŒæ­¥ä»»åŠ¡çŠ¶æ€
```

**æŠ€æœ¯ç»†èŠ‚**:
- å¹¿æ’­ Action: `com.jianglicheng.timebank.FLOATING_TIMER_ACTION`
- æ”¯æŒå‚æ•°: `action` (pause/resume), `taskName`
- JS å›è°ƒé€šè¿‡ `evaluateJavascript` å¼‚æ­¥æ‰§è¡Œ

#### 2) æ²‰æµ¸å¼æ¸¸æˆåœºæ™¯ç‚¹å‡»ä¼˜åŒ– [v7.18.3-fix]
**é—®é¢˜**: åœ¨æ²‰æµ¸å¼æ¸¸æˆåœºæ™¯ä¸‹ï¼Œæ‚¬æµ®çª—ç‚¹å‡»è¢«ç³»ç»Ÿæ‰‹åŠ¿æ‹¦æˆª

**ä¿®å¤æ–¹æ¡ˆ**:
```text
æ–‡ä»¶: FloatingTimerService.java (L507-520)
- ä¼˜åŒ– Window Flags: FLAG_NOT_TOUCH_MODAL + FLAG_LAYOUT_NO_LIMITS
- å…è®¸æ‚¬æµ®çª—åœ¨æ²‰æµ¸æ¨¡å¼ä¸‹æ¥æ”¶è§¦æ‘¸äº‹ä»¶

æ–‡ä»¶: FloatingTimerService.java (L651)
- ç‚¹å‡»æ—¶è°ƒç”¨ wakeUpFromImmersive()
- é€šè¿‡å¾®è°ƒå’Œéœ‡åŠ¨å¸®åŠ©ç³»ç»Ÿè¯†åˆ«äº¤äº’æ„å›¾
```

#### 3) é•¿æ—¶é—´åå°åå”¤é†’ä¿®å¤ [v7.18.3-fix2]
**é—®é¢˜**: Service é•¿æ—¶é—´åå°è¿è¡Œåï¼Œç‚¹å‡»æ‚¬æµ®çª—æœ‰éœ‡åŠ¨ä½†æ— æ³•è·³å›åº”ç”¨

**ä¿®å¤æ–¹æ¡ˆ** (å››å±‚é€’è¿›å”¤é†’):
```text
æ–‡ä»¶: FloatingTimerService.java (L717-850)
- æ–¹æ³•1: moveTaskToFront - æœ€å¿«æ–¹å¼ï¼ˆå·²åœ¨å‰å°æ—¶ï¼‰
- æ–¹æ³•2: AlarmManager + PendingIntent - ç»•è¿‡åå°é™åˆ¶
- æ–¹æ³•3: å…¨å±é€šçŸ¥ (CATEGORY_ALARM) - ç±»ä¼¼é—¹é’Ÿå¼ºåˆ¶å”¤é†’
- æ–¹æ³•4: å…œåº• startActivity
```

#### 4) æ‚¬æµ®çª—ä¸ä»»åŠ¡å¡ç‰‡è®¡æ—¶ä¸åŒæ­¥ä¿®å¤ [v7.18.3-fix4]
**é—®é¢˜**: æš‚åœåæ‚¬æµ®çª—è®¡æ—¶å™¨å’Œä»»åŠ¡å¡ç‰‡è®¡æ—¶ä¸åŒ¹é…ï¼Œä¸¤è€…å­˜åœ¨æ—¶é—´å·®

**æ ¹å› **: æ‚¬æµ®çª— Service å’Œå‰ç«¯ JavaScript å„è‡ªç‹¬ç«‹è®¡æ—¶ï¼Œæš‚åœ/æ¢å¤æ—¶æ²¡æœ‰æ—¶é—´åŒæ­¥æœºåˆ¶

**ä¿®å¤æ–¹æ¡ˆ** (å¼ºåŒæ­¥æœºåˆ¶ - å®Œå…¨ä»¥æ‚¬æµ®çª—ä¸ºå‡†):
```text
æ–‡ä»¶: FloatingTimerService.java
- æ–°å¢ getCurrentElapsedTime() è®¡ç®—å½“å‰å®é™…è®¡æ—¶å€¼
- saveTimerStateToPrefs() ä¿å­˜çŠ¶æ€åˆ°ç‹¬ç«‹ SharedPreferences
- notifyWebView() å¢åŠ  elapsedTime å‚æ•°
- æš‚åœ/æ¢å¤æ—¶å…ˆæ‰§è¡Œæ“ä½œï¼Œå†è·å–å‡†ç¡®æ—¶é—´

æ–‡ä»¶: MainActivity.java
- BroadcastReceiver æ¥æ”¶ elapsedTime å¹¶é€šè¿‡ JS ä¼ é€’

æ–‡ä»¶: WebAppInterface.java
- getFloatingTimerSyncState() æ–°å¢å¼ºåŒæ­¥æŸ¥è¯¢æ¥å£
- clearFloatingTimerSyncState() æ¸…é™¤åŒæ­¥çŠ¶æ€

æ–‡ä»¶: index.html
- pauseTask()/resumeTask() é‡æ„ï¼šå…ˆæš‚åœ/æ¢å¤æ‚¬æµ®çª—ï¼Œå†æŸ¥è¯¢åŒæ­¥çŠ¶æ€
- å¦‚æœæœ‰æ‚¬æµ®çª—æ—¶é—´ï¼Œå®Œå…¨ä»¥å…¶ä¸ºå‡† (elapsedTime = serviceTime)
- __onFloatingTimerAction() ç›´æ¥æ“ä½œï¼Œä¸èµ° pauseTask/resumeTask é¿å…å¾ªç¯
```

**å…³é”®æ”¹åŠ¨**:
- å‰ç«¯ä¸å†ç´¯åŠ è®¡ç®— elapsedTimeï¼Œè€Œæ˜¯å®Œå…¨é‡‡ç”¨æ‚¬æµ®çª—æ—¶é—´
- æŸ¥è¯¢å»¶è¿Ÿ 50msï¼Œç¡®ä¿æ‚¬æµ®çª—å·²æ›´æ–°çŠ¶æ€
- å¼ºåŒæ­¥ï¼šæ— è®ºå·®å€¼å¤šå°‘ï¼Œéƒ½ä½¿ç”¨æ‚¬æµ®çª—æ—¶é—´è¦†ç›–å‰ç«¯

**æ•°æ®æµ**:
```
ç”¨æˆ·ç‚¹å‡»æ‚¬æµ®çª—æš‚åœ
    â†“
Service: pauseTimer() â†’ æš‚åœå®Œæˆ
    â†“
Service: getCurrentElapsedTime() â†’ 5000ms (å‡†ç¡®å€¼)
    â†“
Service: saveTimerStateToPrefs(5000ms)
    â†“
Service: notifyWebView("pause", "ä»»åŠ¡å", 5000)
    â†“
MainActivity â†’ JS: __onFloatingTimerAction("pause", "ä»»åŠ¡å", 5000)
    â†“
å‰ç«¯: runningTask.elapsedTime = 5000 (å®Œå…¨è¦†ç›–ï¼Œä¸æ¯”è¾ƒ)
    â†“
å‰ç«¯: isPaused = true
```

**å‰ç«¯ç‚¹å‡»æš‚åœæµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡»å¡ç‰‡æš‚åœæŒ‰é’®
    â†“
å‰ç«¯: pauseFloatingTimer() â†’ æš‚åœæ‚¬æµ®çª—
    â†“
ç­‰å¾… 50ms
    â†“
å‰ç«¯: getFloatingTimerSyncState() â†’ è·å–æ‚¬æµ®çª—æ—¶é—´
    â†“
å¦‚æœæœ‰æ‚¬æµ®çª—æ—¶é—´: elapsedTime = æ‚¬æµ®çª—æ—¶é—´
å¦åˆ™: elapsedTime += Date.now() - startTime (å›é€€)
    â†“
isPaused = true
```

---
## v7.18.0 (2026-02-12) - é¦–é¡µå¡ç‰‡ç³»ç»Ÿé‡æ„ä¸è§†è§‰å‡çº§

### æ¦‚è¿°
æœ¬æ¬¡æ›´æ–°å¯¹é¦–é¡µä¸‰å¤§å¡ç‰‡ï¼ˆæ—¶é—´ä½™é¢ã€å±å¹•æ—¶é—´ã€ç¡çœ æ—¶é—´ï¼‰è¿›è¡Œäº†ç³»ç»Ÿæ€§é‡æ„ï¼Œä¿®å¤äº†å¡ç‰‡æ˜¾ç¤ºæ§åˆ¶çš„è€¦åˆé—®é¢˜ï¼Œç»Ÿä¸€äº†äº¤äº’å¸ƒå±€ï¼Œå¹¶å¼•å…¥äº†å…¨æ–°çš„åŠ¨æ€æ¸å˜è§†è§‰ä½“ç³»ã€‚

### å…³é”®æ”¹åŠ¨

#### 1) å¡ç‰‡æ˜¾ç¤ºæ§åˆ¶è§£è€¦ [v7.18.0]
**é—®é¢˜**: `updateScreenTimeCardVisibility()` å…³é—­å±å¹•æ—¶é—´æ—¶éšè—æ•´ä¸ª `stackedContainer`ï¼Œå¯¼è‡´ç¡çœ å¡ç‰‡å³ä½¿å¼€å¯ä¹Ÿè¢«è¿å¸¦éšè—ã€‚

**ä¿®å¤**:
- åˆ†ç¦»å®¹å™¨æ§åˆ¶ï¼š`updateScreenTimeCardVisibility()` ä»…æ§åˆ¶å±å¹•æ—¶é—´å¡ç‰‡æœ¬èº«
- æ–°å¢ç»Ÿä¸€æ§åˆ¶å‡½æ•° `updateStackedContainerVisibility()`ï¼Œæ£€æŸ¥ `screenTimeVisible || sleepVisible`
- ä¸¤å¡ç‰‡ç‹¬ç«‹æ§åˆ¶æ˜¾ç¤ºçŠ¶æ€ï¼Œäº’ä¸å¹²æ‰°

**æ–‡ä»¶**: `index.html` (~L32040, ~L28090, ~L32180)

---

#### 2) é¦–é¡µæ˜¾ç¤ºå¼€å…³ä½ç½®ç»Ÿä¸€ [v7.18.0]
**è°ƒæ•´**: å°†ä¸‰ä¸ªç³»ç»Ÿçš„"é¦–é¡µæ˜¾ç¤ºå¡ç‰‡"å¼€å…³ç»Ÿä¸€è°ƒæ•´è‡³å­è®¾ç½®é¡¹é¦–ä½ï¼Œæå‡äº¤äº’ä¸€è‡´æ€§ã€‚

| ç³»ç»Ÿ | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| é‡‘èç³»ç»Ÿ | åˆ©ç‡è®¾ç½®(1) â†’ é¦–é¡µæ˜¾ç¤º(2) | **é¦–é¡µæ˜¾ç¤º(1)** â†’ åˆ©ç‡è®¾ç½®(2) |
| å±å¹•æ—¶é—´ | æ¯æ—¥é™é¢(1) â†’ é¦–é¡µæ˜¾ç¤º(2) | **é¦–é¡µæ˜¾ç¤º(1)** â†’ æ¯æ—¥é™é¢(2) |
| ç¡çœ æ—¶é—´ | å¤œé—´è®¡åˆ’(1) â†’ å°ç¡å‚æ•°(2) â†’ é¦–é¡µæ˜¾ç¤º(3) | **é¦–é¡µæ˜¾ç¤º(1)** â†’ å¤œé—´è®¡åˆ’(2) â†’ å°ç¡å‚æ•°(3) |

**æ–‡ä»¶**: `index.html` (~L6296, ~L6363, ~L6447)

---

#### 3) ä¸‰å¡ç‰‡åŠ¨æ€æ¸å˜ç³»ç»Ÿ [v7.18.0]
**è®¾è®¡ç›®æ ‡**: ä¸‰ä¸ªå¡ç‰‡æ ¹æ®çŠ¶æ€åŠ¨æ€å˜è‰²ï¼Œç›¸é‚»åŒè‰²ç³»å¡ç‰‡æ–¹å‘ç›¸åå½¢æˆè§†è§‰éŸµå¾‹ã€‚

**é¢œè‰²ä½“ç³»ï¼ˆ4çº§ï¼‰**:
```
Level 1 (ç†æƒ³): #27ae60 â†’ #1abc9c (ç¿ ç»¿â†’é’ç»¿)
Level 2 (æ­£å¸¸): #3498db â†’ #9b59b6 (è“è‰²â†’ç´«è‰²)  
Level 3 (è­¦ç¤º): #f39c12 â†’ #e74c3c (æ©™è‰²â†’çº¢è‰²)
Level 4 (å±é™©): #e74c3c â†’ #8e44ad (æ·±çº¢â†’ç´«çº¢)
```

**åˆ¤å®šé€»è¾‘**:
| å¡ç‰‡ | Level 1 | Level 2 | Level 3 | Level 4 |
|------|---------|---------|---------|---------|
| æ–°ä½™é¢ | >24h | 0~24h | -24~0h | <-24h |
| å±å¹•æ—¶é—´ | â‰¤33% | 34-66% | 67-100% | >100% |
| ç¡çœ  | â‰¥1hå¥–åŠ± | <1hå¥–åŠ± | <1hæƒ©ç½š | â‰¥1hæƒ©ç½š |

**æ–¹å‘è§„åˆ™** [v7.18.0-fix]: ä»…ç›¸é‚»å¡ç‰‡é¢œè‰²ç›¸åŒæ—¶æ‰æ–¹å‘ç›¸åï¼Œå¦åˆ™é»˜è®¤å·¦æµ…å³æ·±ï¼ˆ135degï¼‰ã€‚

**æ–‡ä»¶**: `index.html` (~L268, ~L530, ~L675, ~L16462, ~L28182, ~L32209)

---

#### 4) ç¡çœ å¡ç‰‡é¢œè‰²åˆ¤å®šä¿®å¤ [v7.18.0-fix]
**é—®é¢˜**: `getSleepGradientColorsFromLastRecord()` ä½¿ç”¨ `amount`ï¼ˆç»å¯¹å€¼ï¼‰åˆ¤æ–­å¥–æƒ©ï¼Œå¯¼è‡´ -2.5h æƒ©ç½šæ˜¾ç¤ºä¸º Level 1ï¼ˆç¿ ç»¿ï¼‰ã€‚

**ä¿®å¤**:
- æ”¹ç”¨ `type` å­—æ®µåˆ¤æ–­ï¼š`spend`=æƒ©ç½šï¼Œ`earn`=å¥–åŠ±
- åŒºé—´ç»Ÿä¸€ä¸º 60åˆ†é’Ÿï¼ˆ1å°æ—¶ï¼‰

**æ–‡ä»¶**: `index.html` (~L32254, ~L28462)

---

#### 5) ç¡çœ æ¡å½¢å›¾é¢œè‰²ä½“ç³» [v7.18.0]
**è®¾è®¡**: å¡ç‰‡å†…æ¡å½¢å›¾ä¸è¿‘7å¤©ç¡çœ æ¡å½¢å›¾é‡‡ç”¨ç»Ÿä¸€çš„"å·¦æµ…å³æ·±"è‰²ç³»ï¼Œä¸å¡ç‰‡ä¸»è‰²ç³»åŒºåˆ†ï¼š

```
Level 1: #81c784 â†’ #27ae60 (æµ…ç»¿â†’æ·±ç»¿)
Level 2: #64b5f6 â†’ #3498db (æµ…è“â†’æ·±è“)
Level 3: #ffb74d â†’ #f39c12 (æµ…æ©™â†’æ·±æ©™)
Level 4: #e57373 â†’ #e74c3c (æµ…çº¢â†’æ·±çº¢)
```

**æ–‡ä»¶**: `index.html` (~L966, ~L3851, ~L28462, ~L29684)

---

#### 6) ç¡çœ å¡ç‰‡å †å æ ·å¼ä¿®å¤ [v7.18.0]
**é—®é¢˜**: å±å¹•æ—¶é—´éšè—æ—¶ï¼Œç¡çœ å¡ç‰‡ä½œä¸ºé¦–ä¸ªå¯è§å¡ç‰‡ä»åº”ç”¨ `-12px` è´Ÿ marginï¼Œå¯¼è‡´å‘ä¸Šåç§»è¢«é®æŒ¡ã€‚

**ä¿®å¤**: æ·»åŠ  `.first-visible-card` ç±»ï¼Œé¦–ä¸ªå¯è§å¡ç‰‡æ—¶ `margin-top: 0`ã€‚

**æ–‡ä»¶**: `index.html` (~L708, ~L32198)

---
## v7.17.0 (2026-02-12) - ä»»åŠ¡å±•å¼€æ ‡ç­¾é‡æ„ä¸äº‘ç«¯è°ƒç”¨ä¼˜åŒ–

### å…³é”®æ”¹åŠ¨

#### 1) ä»»åŠ¡å±•å¼€æ ‡ç­¾é‡æ„ [v7.17.0]
**æ–‡ä»¶**: `index.html` (~L1157, ~L14500, ~L15943)

**é—®é¢˜**: "å±•å¼€ x ä¸ª"æŒ‰é’®å æ®æ•´è¡Œç©ºé—´ï¼Œé€ æˆå‚ç›´ç©ºé—´æµªè´¹

**æ–¹æ¡ˆ**: å°†å±•å¼€åŠŸèƒ½åµŒå…¥åˆ°æœ€åä¸€ä¸ªä»»åŠ¡å¡ç‰‡å³ä¸‹è§’

```text
ä¿®æ”¹å‰:
- å±•å¼€æŒ‰é’®ä½œä¸ºç‹¬ç«‹è¡Œ: grid-column: 1 / -1
- åŒ…å«å±•å¼€å›¾æ ‡ + "å±•å¼€ x ä¸ª" æ–‡å­—
- padding: 2px 0 å æ®å‚ç›´ç©ºé—´

ä¿®æ”¹å:
- renderTaskCards(taskList, options) æ–°å¢ options å‚æ•°
  * isLastVisible: æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå¯è§ä»»åŠ¡
  * hiddenCount: å‰©ä½™éšè—ä»»åŠ¡æ•°
  * isExpanded: æ˜¯å¦å·²å±•å¼€
  * category: åˆ†ç±»åï¼ˆç”¨äºç‚¹å‡»äº‹ä»¶ï¼‰
- æ”¶èµ·çŠ¶æ€ï¼šæœ€åä¸€ä¸ªå¡ç‰‡æ˜¾ç¤º "+x" æ ‡ç­¾ï¼ˆå·¦ä¾§åŠåœ†å½¢çŠ¶ï¼‰
- å±•å¼€çŠ¶æ€ï¼šæœ€åä¸€ä¸ªå¡ç‰‡æ˜¾ç¤º "æ”¶èµ·" æ ‡ç­¾
- æ ‡ç­¾ä½ç½®ï¼šposition: absolute; right: 0; top: 50%
- å®Œå…¨ç§»é™¤åŸå±•å¼€æŒ‰é’®çš„ grid-rowï¼ŒèŠ‚çœå‚ç›´ç©ºé—´
```

**æ–°å¢ CSS**:
```text
.task-expand-tag: ç»å¯¹å®šä½ï¼Œå³ä¾§åŠåœ†æ ‡ç­¾
.task-expand-tag.expanded: æ”¶èµ·çŠ¶æ€æ ·å¼ï¼ˆç°è‰²ï¼‰
body.glass-mode .task-expand-tag: é€šé€æ¨¡å¼é€‚é…ï¼ˆæ¯›ç»ç’ƒæ•ˆæœï¼‰
```

**åŠ¨ç”»å…¼å®¹**:
```text
toggleCategory() åŠ¨ç”»å‡½æ•°æ›´æ–°ï¼š
- ç§»é™¤ .category-expand-btn çš„ opacity æ§åˆ¶
- æ–°å¢ .task-expand-tag çš„ opacity æ§åˆ¶
- ä¿æŒæ”¶èµ·/å±•å¼€åŠ¨ç”»ä¸€è‡´æ€§
```

#### 2) äº‘ç«¯ API è°ƒç”¨æ¬¡æ•°ä¼˜åŒ– [v7.17.0]
**æ–‡ä»¶**: `index.html` (~L37288, ~L10464, ~L37488, ~L37468)

**é—®é¢˜**: ä¸ªäººä½¿ç”¨åœºæ™¯ä¸‹ï¼Œé¢‘ç¹åˆ‡æ¢åº”ç”¨ã€watch é‡è¿ã€å¿ƒè·³æ£€æµ‹ç­‰å¯¼è‡´äº‘ç«¯ API è°ƒç”¨æ¬¡æ•°è¿‡é«˜ï¼Œä¸ªäººç‰ˆå¥—é¤ï¼ˆ20ä¸‡æ¬¡/æœˆï¼‰ä¸åˆ°ä¸€ä¸ªæœˆå³è€—å°½

**æ–¹æ¡ˆ**: ç²¾ç»†è°ƒæ•´å„ç±»è§¦å‘é˜ˆå€¼å’Œé—´éš”æ—¶é—´ï¼Œåœ¨ä¸å½±å“æ ¸å¿ƒä½“éªŒçš„å‰æä¸‹é™ä½çº¦ 25% è°ƒç”¨æ¬¡æ•°

```text
åŒæ­¥å†·å´æ—¶é—´: 5000ms â†’ 15000ms
  - SYNC_COOLDOWN: 5000 â†’ 15000
  - å‡å°‘é¡µé¢é¢‘ç¹åˆ‡æ¢å¸¦æ¥çš„ triggerSync è°ƒç”¨

Watch é‡è¿å‚æ•°: 
  - åŸºç¡€å»¶è¿Ÿ: 3000ms â†’ 8000ms
  - é€€é¿å€ç‡: 1.5 â†’ 1.8
  - æœ€å¤§å»¶è¿Ÿ: 60000ms â†’ 120000ms
  - å¢åŠ  MIN_RECONNECT_INTERVAL = 10000ms é˜²æ­¢é¢‘ç¹è°ƒåº¦

å¿ƒè·³æ£€æµ‹é—´éš”:
  - 30000ms â†’ 45000ms
  - å‡å°‘å¿ƒè·³æ£€æµ‹å¸¦æ¥çš„è°ƒç”¨

Focus äº‹ä»¶è§¦å‘é˜ˆå€¼:
  - 60000ms â†’ 120000ms
  - é¿å… visibilitychange å’Œ focus äº‹ä»¶é‡å¤è§¦å‘
```

**é¢„æœŸæ•ˆæœ**:
- é¡µé¢åˆ‡æ¢åŒæ­¥: ~8% å‡å°‘
- Watch é‡è¿: ~10% å‡å°‘  
- å¿ƒè·³æ£€æµ‹: ~33% å‡å°‘ï¼ˆè¯¥éƒ¨åˆ†ï¼‰
- Focus äº‹ä»¶: ~5% å‡å°‘
- æ€»ä½“: ~25% å‡å°‘
```

---
## v7.16.2 (2026-02-11) - äº¤äº’ä½“éªŒä¼˜åŒ–

### å…³é”®æ”¹åŠ¨

#### 1) ä»»åŠ¡å±•å¼€æ ‡ç­¾é‡æ„ [v7.17.0]
**æ–‡ä»¶**: `index.html` (~L1157, ~L14500, ~L15943)

**é—®é¢˜**: "å±•å¼€ x ä¸ª"æŒ‰é’®å æ®æ•´è¡Œç©ºé—´ï¼Œé€ æˆå‚ç›´ç©ºé—´æµªè´¹

**æ–¹æ¡ˆ**: å°†å±•å¼€åŠŸèƒ½åµŒå…¥åˆ°æœ€åä¸€ä¸ªä»»åŠ¡å¡ç‰‡å³ä¸‹è§’

```text
ä¿®æ”¹å‰:
- å±•å¼€æŒ‰é’®ä½œä¸ºç‹¬ç«‹è¡Œ: grid-column: 1 / -1
- åŒ…å«å±•å¼€å›¾æ ‡ + "å±•å¼€ x ä¸ª" æ–‡å­—
- padding: 2px 0 å æ®å‚ç›´ç©ºé—´

ä¿®æ”¹å:
- renderTaskCards(taskList, options) æ–°å¢ options å‚æ•°
  * isLastVisible: æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå¯è§ä»»åŠ¡
  * hiddenCount: å‰©ä½™éšè—ä»»åŠ¡æ•°
  * isExpanded: æ˜¯å¦å·²å±•å¼€
  * category: åˆ†ç±»åï¼ˆç”¨äºç‚¹å‡»äº‹ä»¶ï¼‰
- æ”¶èµ·çŠ¶æ€ï¼šæœ€åä¸€ä¸ªå¡ç‰‡æ˜¾ç¤º "+x" æ ‡ç­¾ï¼ˆå·¦ä¾§åŠåœ†å½¢çŠ¶ï¼‰
- å±•å¼€çŠ¶æ€ï¼šæœ€åä¸€ä¸ªå¡ç‰‡æ˜¾ç¤º "æ”¶èµ·" æ ‡ç­¾
- æ ‡ç­¾ä½ç½®ï¼šposition: absolute; right: 0; top: 50%
- å®Œå…¨ç§»é™¤åŸå±•å¼€æŒ‰é’®çš„ grid-rowï¼ŒèŠ‚çœå‚ç›´ç©ºé—´
```

**æ–°å¢ CSS**:
```text
.task-expand-tag: ç»å¯¹å®šä½ï¼Œå³ä¾§åŠåœ†æ ‡ç­¾
.task-expand-tag.expanded: æ”¶èµ·çŠ¶æ€æ ·å¼ï¼ˆç°è‰²ï¼‰
body.glass-mode .task-expand-tag: é€šé€æ¨¡å¼é€‚é…ï¼ˆæ¯›ç»ç’ƒæ•ˆæœï¼‰
```

**åŠ¨ç”»å…¼å®¹**:
```text
toggleCategory() åŠ¨ç”»å‡½æ•°æ›´æ–°ï¼š
- ç§»é™¤ .category-expand-btn çš„ opacity æ§åˆ¶
- æ–°å¢ .task-expand-tag çš„ opacity æ§åˆ¶
- ä¿æŒæ”¶èµ·/å±•å¼€åŠ¨ç”»ä¸€è‡´æ€§
```

---
## v7.16.2 (2026-02-11) - äº¤äº’ä½“éªŒä¼˜åŒ–

### å…³é”®æ”¹åŠ¨

#### 1) ä½™é¢å¡ç‰‡ç‚¹å‡»åŒºåŸŸåˆ†ç¦» [v7.16.2]
**æ–‡ä»¶**: `index.html` (~L5484, ~L16442)

```text
- ä»Šæ—¥ç»Ÿè®¡åŒºåŸŸ(.bc-today-stats): onclick â†’ showTodayDetails()
- åˆ©æ¯ä¿¡æ¯åŒºåŸŸ(.bc-finance-interest): onclick â†’ showFinanceDetailCombinedModal()
- body åŒºåŸŸä¸å†æœ‰ç»Ÿä¸€ onclickï¼Œç”±å­å…ƒç´ å„è‡ªå¤„ç†
- å¼¹çª—æ ‡é¢˜ä»ã€Œä½™é¢è¯¦æƒ…ã€æ”¹ä¸ºã€Œä½™é¢å’Œåˆ©æ¯è¯¦æƒ…ã€
```

#### 2) ç¡çœ å€’è®¡æ—¶ä¼‘çœ æ¢å¤ä¿®å¤ï¼ˆ4éƒ¨åˆ†ï¼‰[v7.16.2]
**æ–‡ä»¶**: `index.html` (~L28562, ~L28724, ~L12737, ~L37276)

**é—®é¢˜é“¾**:
```text
å€’è®¡æ—¶æœŸé—´è®¾å¤‡ä¼‘çœ  â†’ setInterval è¢«å†»ç»“
â†’ Date.now() å·²è¿‡ endTime ä½†å›è°ƒæœªè§¦å‘
â†’ visibilitychange æ¢å¤æ—¶ startSleepRecording() ä½¿ç”¨ Date.now() ä½œä¸ºå…¥ç¡æ—¶é—´
â†’ å®é™…å…¥ç¡æ—¶é—´æ™šäºçœŸå®å€’è®¡æ—¶ç»“æŸæ—¶é—´
```

**ä¿®å¤**:
```text
- saveSleepCountdownState() / clearSleepCountdownState(): localStorage æŒä¹…åŒ–å€’è®¡æ—¶ endTime
- startSleepRecording(): ä½¿ç”¨ sleepCountdownState.endTime ä½œä¸ºå…¥ç¡æ—¶é—´ï¼ˆé Date.now()ï¼‰
- startSleepRecording(): æ–°å¢ isRecording å®ˆå«é˜²æ­¢é‡å¤è°ƒç”¨
- visibilitychange: æ¢å¤æ—¶æ£€æŸ¥æœªå®Œæˆå€’è®¡æ—¶ï¼Œè¿‡æœŸåˆ™ç«‹å³è§¦å‘ startSleepRecording()
- initApp(): å†·å¯åŠ¨æ¢å¤è¿‡æœŸå€’è®¡æ—¶
```

#### 3) æˆ’é™¤ä¹ æƒ¯å¥–åŠ±ä¸‰é‡ä¿®å¤ [v7.16.2]
**æ–‡ä»¶**: `index.html` (~L18124, ~L18227, ~L37311)

```text
- æ ¹å› 1: checkAbstinenceCompletion() â†’ å‡½æ•°åé”™è¯¯ï¼Œå®é™…å‡½æ•°ä¸º checkAbstinenceHabits()
- æ ¹å› 2: ä¼‘çœ æ¢å¤è·¯å¾„ï¼ˆtriggerSync.then + å…œåº•ï¼‰æœªè°ƒç”¨ checkAbstinenceHabits()
- æ ¹å› 3: lastSettledDate åˆå§‹åŒ–æ—¶ task æœªåŠ å…¥ updatedTasks â†’ äº‘ç«¯ä¸åŒæ­¥
  ä¿®å¤: if (!updatedTasks.includes(task)) updatedTasks.push(task)
```

#### 4) åˆ†ç±»å±•å¼€/æ”¶èµ·å¡ç‰‡åŠ¨ç”» [v7.16.2]
**æ–‡ä»¶**: `index.html` (~L1786, ~L16286)

```text
- ç§»é™¤: max-height keyframe åŠ¨ç”»ï¼ˆcategoryExpand/categoryCollapseï¼‰
- æ–°å¢: å¡ç‰‡çº§ CSS transitionï¼ˆopacity + transformï¼‰ï¼Œ50ms äº¤é”™é—´éš”
- å±•å¼€: å®¹å™¨ displayâ†’visibleï¼Œå¡ç‰‡ä» card-hidden ä¾æ¬¡ç§»é™¤
- æ”¶èµ·: å¡ç‰‡ä»æœ«å°¾åˆ°å¼€å¤´ä¾æ¬¡æ·»åŠ  card-hiddenï¼Œå…¨éƒ¨å®Œæˆå display:none
- GPUä¼˜åŒ–: .category-animating ç±»æœŸé—´å¯ç”¨ will-changeï¼Œ
  glass-mode é™ä½ backdrop-filter ä¸º blur(4px * --glass-blur-scale)
- åŠ¨ç”»ç»“æŸåæ¸…ç† will-change å’Œ transitionDelay
```

#### 5) ä»»åŠ¡æ˜¾ç¤ºæ•°é‡ç»Ÿä¸€è®¾ç½® [v7.16.2]
**æ–‡ä»¶**: `index.html` (~L6087, ~L14072, ~L16364)

```text
- åˆå¹¶: æœ€è¿‘ä»»åŠ¡æ•°é‡ + åˆ†ç±»ä»»åŠ¡æ•°é‡ â†’ å•ä¸€ã€Œä»»åŠ¡æ˜¾ç¤ºæ•°é‡ã€è®¾ç½®
- UI: åŸç”Ÿ <select> â†’ style-switcher æŒ‰é’®ç»„ï¼ˆ2/4/6/8ï¼‰ï¼Œå¤ç”¨å¡ç‰‡æ ·å¼é€‰æ‹©å™¨ CSS
- setTaskDisplayLimit(val): åŒæ—¶è®¾ç½® RECENT_TASK_LIMIT + CATEGORY_TASK_LIMIT
- é»˜è®¤å€¼: 4ï¼ˆä» 6 æ”¹ä¸º 4ï¼‰
```

#### 6) æ‹–åŠ¨æ’åºè‡ªåŠ¨å±•å¼€æŠ˜å åˆ†ç±» [v7.16.2]
**æ–‡ä»¶**: `index.html` (~L13789)

```text
- é•¿æŒ‰æ¿€æ´»æ‹–åŠ¨æ—¶ï¼Œæ£€æµ‹ catTasks.length > CATEGORY_TASK_LIMIT ä¸”æœªå±•å¼€
- è‡ªåŠ¨ expandedTaskCategories.add(category) + updateCategoryTasks()
- é€šè¿‡ data-task-id é‡æ–°å®šä½å¡ç‰‡ï¼Œæ›´æ–° taskDragState å¼•ç”¨
- æ‹–åŠ¨ç»“æŸå updateCategoryTasks() æ­£å¸¸é‡æ¸²æŸ“
```

#### 7) é€šé€æ¨¡å¼å±•å¼€æŒ‰é’®å“åº”æ»‘å— [v7.16.2]
```text
- .category-expand-btn: background ä½¿ç”¨ --glass-opacity-scale
- æ–°å¢ backdrop-filter: blur(calc(10px * --glass-blur-scale))
```

---
## v7.16.1 (2026-02-10) - åˆ†ç±»ç³»ç»Ÿä¼˜åŒ–

### å…³é”®æ”¹åŠ¨

#### 1) ç³»ç»Ÿåˆ†ç±»ç»†åˆ†ï¼šå±å¹•/ç¡çœ /åˆ©æ¯ [v7.16.1]
**æ–‡ä»¶**: `index.html` (~L12547, ~L20101)

**ä¿®æ”¹**:
```text
- æ–°å¢å¸¸é‡: INTEREST_CATEGORY='åˆ©æ¯', SCREEN_TIME_CATEGORY='å±å¹•', SLEEP_CATEGORY='ç¡çœ '
- getTransactionCategory(): å±å¹•/ç¡çœ /åˆ©æ¯å„è¿”å›ç‹¬ç«‹åˆ†ç±»åï¼ˆä¸å†å…±ç”¨ SYSTEM_CATEGORYï¼‰
- getCategoryColorSafe(): åŠ¨æ€é€‰è‰²ï¼Œå±å¹•è“ç»¿ç³»/ç¡çœ çº¢è‰²ç³»ï¼Œé¿å¼€ç”¨æˆ·å·²é€‰é¢œè‰²
  * SCREEN_TIME_COLORS = ['#26A69A','#009688','#00897B','#00796B','#00ACC1','#0097A7']
  * SLEEP_COLORS = ['#E53935','#D32F2F','#C62828','#EF5350','#F44336','#E57373']
  * INTEREST_CATEGORY_COLOR = '#5C6BC0' (é™æ€)
- buildTaskViewColorMap(): åŒæ­¥æ›´æ–°å±å¹•æ—¶é—´ fallback ä¸º SCREEN_TIME_CATEGORY
- åˆ†ç±»é€‰æ‹©å™¨é»˜è®¤é¡¹: 'å±å¹•ï¼ˆé»˜è®¤ï¼‰'/'ç¡çœ ï¼ˆé»˜è®¤ï¼‰' æ›¿ä»£ 'ç³»ç»Ÿï¼ˆé»˜è®¤ï¼‰'
```

#### 2) é¥¼å›¾ä»»åŠ¡å emoji å»é™¤ [v7.16.1]
**æ–‡ä»¶**: `index.html` (~L20869, ~L25267, ~L26445)

```text
- parseTransactionDescription(): åˆ©æ¯æ ‡é¢˜å»é™¤ğŸ’°ğŸ’¸å‰ç¼€ï¼ˆå­˜æ¬¾åˆ©æ¯/è´·æ¬¾åˆ©æ¯/åˆ©æ¯è°ƒæ•´ï¼‰
- getItemNameAndCategory / buildCategoryTaskBreakdown / showCategoryDetail:
  ç³»ç»Ÿä»»åŠ¡ taskName ç»Ÿä¸€ regex å»é™¤å‰å¯¼ emoji: rawName.replace(/^[\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}]\s*/u, '')
- é¥¼å›¾ tooltip ä»»åŠ¡/åˆ†ç±»æ˜ç»†è¡Œç§»é™¤ 'Â· ' å‰ç¼€ï¼Œé¡¶æ ¼æ˜¾ç¤º
```

#### 3) å¤œé—´ç¡çœ è·³è¿‡ç¡®è®¤å¼¹çª— [v7.16.1]
**æ–‡ä»¶**: `index.html` (~L28761)

```text
- endUnifiedSleep() ç›´æ¥è°ƒç”¨ doSleepSettlement() æ‰§è¡Œç»“ç®—ï¼ˆä¸å†æ‰“å¼€ç¡®è®¤å¼¹çª—ï¼‰
- æ–°å¢ doSleepSettlement(sleepType, startTime, wakeTime): ä» confirmSleepSettlement() æå–çš„ç»“ç®—æ ¸å¿ƒ
- confirmSleepSettlement() ä¿ç•™ä¸ºåˆ«åï¼Œå§”æ‰˜ doSleepSettlement()
```

#### 4) å¼¹çª—åŠ¨ç”»ç»Ÿä¸€ + åˆ‡æ¢æŒ‰é’®é¢œè‰² [v7.16.1]
```text
- .modal-overlay .modal-content / .sleep-settings-modal .modal-content: ç»Ÿä¸€ modalPopIn åŠ¨ç”»
- ç§»é™¤ .modal-animate æ»‘å…¥ CSS å’Œ 3 å¤„ requestAnimationFrame è§¦å‘
- #generalInfoModal / #dayDetailModal .view-switch-btn: color: var(--text-color), font-size: 1.3rem
```

#### 5) åˆ†ç±»é¢œè‰²é€‰æ‹©å¢å¼º [v7.16.1]
```text
- .color-swatch.disabled: opacity 0.3â†’0.45, æ˜¾ç¤ºå°å·âœ”æ ‡è®°
- .color-swatch.disabled.selected: opacity: 1
- selectCategory(): ä¼ å…¥ existingColor ä½œä¸º editingColorï¼Œè§£é™¤å½“å‰åˆ†ç±»é¢œè‰²çš„ç¦ç”¨
```

---
## v7.16.0 (2026-02-10) - ç»Ÿä¸€ç¡çœ æ¨¡å¼ï¼ˆæ™ºèƒ½æ£€æµ‹ï¼‰

### å…³é”®æ”¹åŠ¨

#### 1) ç¡çœ æ¨¡å¼åˆå¹¶ï¼šç§»é™¤åˆç¡/å¤œé—´åˆ‡æ¢ [v7.16.0]
**æ–‡ä»¶**: `index.html`

**é—®é¢˜**:
```text
ç”¨æˆ·éœ€è¦åœ¨é¦–é¡µå¡ç‰‡æ‰‹åŠ¨åˆ‡æ¢"å¤œé—´æ¨¡å¼"å’Œ"åˆç¡æ¨¡å¼"
â†’ æ“ä½œç¹çï¼Œå®¹æ˜“å¿˜è®°åˆ‡æ¢
â†’ é€‰é”™æ¨¡å¼å¯¼è‡´ç»“ç®—ç»“æœä¸æ­£ç¡®
```

**æ–¹æ¡ˆ**: ç»Ÿä¸€ä¸ºä¸€ä¸ª"å¼€å§‹ç¡çœ "æŒ‰é’® + ç»“æŸæ—¶æ™ºèƒ½æ£€æµ‹ + ç¡®è®¤å¼¹çª—

**æ ¸å¿ƒæ–°å‡½æ•°**:
```text
- detectSleepType(startTime, wakeTime): æ™ºèƒ½åˆ¤æ–­å¤œé—´/å°ç¡
  * å…¥ç¡æ—¶é—´ 20:00~06:00 â†’ å¤œé—´
  * æˆ–ç¡çœ æ—¶é•¿ â‰¥ napMinDurationMinutes(é»˜è®¤240åˆ†é’Ÿ) â†’ å¤œé—´
  * å…¶ä»– â†’ å°ç¡
- startUnifiedSleep(): ç»Ÿä¸€å…¥ç¡ï¼ˆæ›¿ä»£ startSleepMode + startNapï¼‰
- endUnifiedSleep(): ç»Ÿä¸€ç»“æŸï¼ˆæ˜¾ç¤ºç»“ç®—ç¡®è®¤å¼¹çª—ï¼‰
- showSleepSettlementModal(): ç¡®è®¤å¼¹çª—ï¼ˆæ˜¾ç¤ºæ£€æµ‹ç»“æœï¼Œå¯åˆ‡æ¢ç±»å‹ï¼‰
- confirmSleepSettlement(): æŒ‰é€‰å®šç±»å‹æ‰§è¡Œç»“ç®—
```

**åˆ é™¤/åºŸå¼ƒ**:
```text
- getCurrentSleepMode() â†’ åˆ é™¤ï¼ˆè¢« detectSleepType æ›¿ä»£ï¼‰
- toggleSleepCardMode() â†’ åˆ é™¤
- startSleepMode() â†’ åˆ«åæŒ‡å‘ startUnifiedSleep
- startNap()/endNap()/cancelNap() â†’ åˆ«åå­˜æ ¹
- endSleep() â†’ åˆ«åæŒ‡å‘ endUnifiedSleep
- sleepSettings.cardMode â†’ åºŸå¼ƒï¼ˆä¿ç•™å­—æ®µå…¼å®¹ï¼‰
- sleepSettings.napEnabled â†’ åºŸå¼ƒ
- sleepSettings.napMaxDurationMinutes â†’ åºŸå¼ƒ
- sleepState.isNapping/napStartTime/napTargetMinutes â†’ åºŸå¼ƒ
```

#### 2) æ–°å¢ sleepData.sleepType å­—æ®µ [v7.16.0]
**æ–‡ä»¶**: `index.html` (~L11117, ~L28700)

**ä¿®æ”¹**:
```text
- æ–°äº‹åŠ¡ç»Ÿä¸€ä½¿ç”¨ sleepDataï¼Œå†…å« sleepType: 'night'|'nap'
- æ—§ napData è®°å½•åœ¨ DAL.loadAll åŠ è½½æ—¶è‡ªåŠ¨å½’ä¸€åŒ–ä¸º sleepData
  { sleepType: 'nap', _migratedFromNapData: true }
- napData å­—æ®µä¿ç•™è¯»å–å…¼å®¹ï¼Œä¸å†å†™å…¥æ–°è®°å½•
- æ‰‹åŠ¨è¡¥å½• submitManualSleep é»˜è®¤ sleepType: 'night'
- å°ç¡ç»“ç®—æ—¶äº¤æ˜“ taskName æ”¹ä¸º 'ğŸ˜´ ç¡çœ æ—¶é—´ç®¡ç†'ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
```

#### 3) ç»“ç®—ç¡®è®¤å¼¹çª— [v7.16.0]
**æ–‡ä»¶**: `index.html` (~L28680)

**äº¤äº’æµç¨‹**:
```text
ç»“æŸç¡çœ  â†’ å¼¹å‡ºç¡®è®¤å¼¹çª—
  - æ˜¾ç¤ºæ™ºèƒ½æ£€æµ‹ç»“æœï¼ˆğŸŒ™å¤œé—´/ğŸ’¤å°ç¡ï¼‰
  - ä¸¤ä¸ªåˆ‡æ¢æŒ‰é’®å¯æ‰‹åŠ¨çº æ­£
  - å¤œé—´: calculateSleepReward() å®Œæ•´å¥–æƒ©
  - å°ç¡: è¾¾æ ‡åˆ¤å®šï¼ˆâ‰¥napDurationMinutes â†’ å›ºå®šå¥–åŠ±napRewardï¼‰
  - "ç»§ç»­ç¡çœ "æŒ‰é’®å¯å–æ¶ˆç»“æŸå¹¶æ¢å¤ç›‘å¬
```

#### 4) å¡ç‰‡ HTML é‡æ„ [v7.16.0]
**æ–‡ä»¶**: `index.html` (~L5378)

```text
- ç§»é™¤: sleepModeLabel, sleepModeSwitchï¼ˆæ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼‰
- ç§»é™¤: sleepNightTimeRow, sleepNapTimeRowï¼ˆåˆ†å¼€çš„æ—¶é—´è¡Œï¼‰
- æ–°å¢: sleepTimeInfoRowï¼ˆç»Ÿä¸€æ—¶é—´è¡Œï¼Œæ˜¾ç¤ºè®¡åˆ’å…¥ç¡/èµ·åºŠï¼‰
- æŒ‰é’®æ–‡æ¡ˆ: "è¿›å…¥ç¡çœ "â†’"å¼€å§‹ç¡çœ ", "ç»“æŸ"â†’"ç»“æŸç¡çœ "
```

#### 5) äº‘ç«¯å…¼å®¹æ€§å¤„ç† [v7.16.0]
```text
- applySleepStateFromCloud: æ—§ isNapping=true â†’ è½¬æ¢ä¸º isSleeping=true
- syncSleepStateFromCloud: æ—§ isNapping â†’ è½¬æ¢ä¸º isSleeping
- saveSleepState/saveSleepStateShared: ä¸å†åŒæ­¥ isNapping/napStartTime
- getSleepRecordForDate: è¿‡æ»¤ sleepType=napï¼Œé˜²æ­¢å°ç¡æ±¡æŸ“å¤œé—´å›¾è¡¨
```

#### 6) æ˜¾ç¤ºå±‚æ›´æ–° [v7.16.0]
```text
- äº¤æ˜“åˆ—è¡¨: sleepData.sleepType=nap æ˜¾ç¤º ğŸ’¤ å‰ç¼€
- parseTransactionDescription: å°ç¡æ ‡é¢˜'å°ç¡'+ğŸ’¤å›¾æ ‡
- showNapDetailModal: å…¼å®¹ sleepData.sleepType=nap + æ—§ napData
- showSleepHistory: ç›´æ¥æ˜¾ç¤ºå¤œé—´è¯¦æƒ…ï¼ˆä¸å† switch æ¨¡å¼ï¼‰
- å°ç¡è®¾ç½®å¼¹çª—: ç§»é™¤"æœ€å¤§æ—¶é•¿"è®¾ç½®é¡¹ï¼Œæ›´æ–°æ–‡æ¡ˆ åˆç¡â†’å°ç¡
```

#### 7) ç¡çœ å¡ç‰‡æ¡å½¢å›¾ [v7.16.0]
**æ–‡ä»¶**: `index.html` (~L5378, ~L27200)

```text
- å¡ç‰‡å±•å¼€åæ˜¾ç¤ºã€Œè®¡åˆ’ vs å®é™…ã€æ¡å½¢å¯¹æ¯”å›¾ï¼ˆSVGï¼‰
- è“è‰²æ¡ = è®¡åˆ’æ—¶é—´æ®µï¼Œç»¿è‰²/æ©™è‰²æ¡ = å®é™…å…¥ç¡â†’èµ·åºŠ
- timeToPercent() è®¡ç®—æ—¶é—´åœ¨åæ ‡è½´ä¸Šçš„ç™¾åˆ†æ¯”ä½ç½®
- æ— ç¡çœ è®°å½•æ—¶æ˜¾ç¤º"æ˜¨æ™šæ— ç¡çœ è®°å½•"å ä½
- updateSleepCard() ç»Ÿä¸€æ›´æ–°å¡ç‰‡çŠ¶æ€ + æ¡å½¢å›¾
```

#### 8) å…¥ç¡æ—¶é—´å†³å®šé—¹é’Ÿç±»å‹ [v7.16.0]
**æ–‡ä»¶**: `index.html` (~L28500)

```text
- startUnifiedSleep() è°ƒç”¨ detectSleepType(startTime, null) é¢„åˆ¤ç±»å‹
- å¤œé—´: è®¾ç½®èµ·åºŠé—¹é’Ÿï¼ˆAndroid.setWakeAlarmï¼‰
- å°ç¡: è®¾ç½®å°ç¡é—¹é’Ÿï¼ˆAndroid.setNapAlarmï¼‰
- ç»“æŸæ—¶ detectSleepType(start, wake) æœ€ç»ˆç¡®è®¤ï¼ˆå¯å¼¹çª—çº æ­£ï¼‰
```

#### 9) å€’è®¡æ—¶é—¹é’Ÿä¿¡æ¯ä¸è·³è¿‡ [v7.16.0]
**æ–‡ä»¶**: `index.html` (~L28400)

```text
- å€’è®¡æ—¶é¡µé¢åº•éƒ¨æ˜¾ç¤ºæ˜æ—¥é—¹é’Ÿæ—¶é—´ï¼ˆä» sleepSettings.plannedWakeTime è¯»å–ï¼‰
- "è·³è¿‡ä»Šå¤©é—¹é’Ÿ"æŒ‰é’® â†’ è°ƒç”¨ Android.cancelWakeAlarm()
- è·³è¿‡çŠ¶æ€æŒä¹…åŒ–åˆ° sleepState.alarmSkippedDateï¼ˆå½“æ—¥æœ‰æ•ˆï¼‰
- é€šé€æ¨¡å¼ä¸‹é—¹é’Ÿä¿¡æ¯åŒºå¢åŠ åŠé€æ˜èƒŒæ™¯å’Œæ–‡å­—é˜´å½±
```

#### 10) å¼¹çª—æ ‡ç­¾åˆ‡æ¢ï¼ˆä½™é¢è¯¦æƒ… â‡„ æ¯æ—¥è¯¦æƒ… â‡„ æ—¶é—´æµå›¾ï¼‰[v7.16.0]
**æ–‡ä»¶**: `index.html` (~L8225, ~L16098, ~L19000)

```text
- showBalanceDetailModal() / showDayDetailModal() / showTimeFlowChart()
  å„å¼¹çª—æ ‡é¢˜æ å¢åŠ  â‡„ æŒ‰é’®
- ç‚¹å‡»å…³é—­å½“å‰å¼¹çª— â†’ æ‰“å¼€ä¸‹ä¸€ä¸ªï¼ˆå¾ªç¯åˆ‡æ¢ï¼‰
- åˆ‡æ¢é¡ºåº: ä½™é¢è¯¦æƒ… â†’ æ¯æ—¥è¯¦æƒ… â†’ æ—¶é—´æµå›¾ â†’ ä½™é¢è¯¦æƒ…
```

#### 11) é€šé€æ¨¡å¼å¯è¯»æ€§ä¿®å¤ [v7.16.0]
```text
- å€’è®¡æ—¶é—¹é’Ÿä¿¡æ¯åŒº: åŠé€æ˜èƒŒæ™¯ + æ–‡å­—é˜´å½±
- é‡‘èåˆ©ç‡è®¾ç½®ï¼ˆå¼¹çª—+è®¾ç½®é¡µï¼‰: .finance-rate-box èƒŒæ™¯/è¾¹æ¡†å¢å¼º
- æ—¶é—´æµå›¾ SVG åæ ‡è½´: é€šé€æ¨¡å¼ä¸‹è½´çº¿å’Œæ–‡å­—é¢œè‰²åŠ æ·±
- è®¾ç½®é¡µåˆ©ç‡åŠ å‡æŒ‰é’®: é€šé€æ¨¡å¼ä¸‹èƒŒæ™¯/è¾¹æ¡†å¯è¯»æ€§å¢å¼º
```

#### 12) å…¶ä»– UI/äº¤äº’ [v7.16.0]
```text
- ç¡çœ çŠ¶æ€æ–‡æ¡ˆ: æ”¶èµ·æ—¶æ˜¾ç¤ºå¯ç‚¹å‡»"å¼€å§‹ç¡çœ "æŒ‰é’®ï¼Œå±•å¼€æ—¶æ˜¾ç¤º"æœªå¼€å§‹"
- å¡ç‰‡å±•å¼€ç®­å¤´: å§‹ç»ˆå¯è§(opacity:1)ï¼Œå±•å¼€æ—¶æ—‹è½¬180Â°ï¼ˆç§»é™¤æ·¡å…¥æ·¡å‡ºï¼‰
- å°ç¡å‚æ•°è®¾ç½®å¼¹çª—: napDurationMinutes / napReward ç‹¬ç«‹è®¾ç½®
- ç§»é™¤è®¾ç½®é¡µæ•°æ®ä¿®å¤å·¥å…· HTML + repairDuplicateInterestData() å‡½æ•°
  ï¼ˆä¿ç•™ autoDeduplicateInterest å¯åŠ¨æ—¶é™é»˜å»é‡ï¼‰
```

---
## v7.15.4 (2026-02-09) - é‡å¤åˆ©æ¯äº¤æ˜“ä¿®å¤

### å…³é”®æ”¹åŠ¨

#### 1) åˆ©æ¯äº¤æ˜“çº§å»é‡ï¼ˆé˜²ç«æ€ï¼‰[v7.15.4]
**æ–‡ä»¶**: `index.html` (~L31127)

**é—®é¢˜é“¾**:
```text
v7.15.2 æ•°æ®ä¿®å¤è„šæœ¬åˆ›å»ºäº†æ ¡æ­£åˆ©æ¯äº¤æ˜“ fix_feb8_interest_20260209 (1494s)
â†’ ä½†æœªåˆ é™¤åŸå§‹åˆ©æ¯äº¤æ˜“ 1770615993264z3af267gf (1713s)
â†’ å¯¼å…¥å¤‡ä»½åä¸¤æ¡å…±å­˜ â†’ ä½™é¢åŒé‡æ‰£é™¤

åŒæ—¶ï¼ŒsettleDailyInterest() ä»…ä¾èµ–å†…å­˜ settledDates æ£€æŸ¥
â†’ å¤šè®¾å¤‡ç«æ€ä¸‹å¯èƒ½ç»•è¿‡ï¼ˆä¸¤è®¾å¤‡åŒæ—¶æ£€æŸ¥ settledDates â†’ éƒ½æ‰¾ä¸åˆ° â†’ éƒ½ç»“ç®—ï¼‰
```

**ä¿®å¤**: `settleDailyInterest()` åœ¨åˆ›å»ºåˆ©æ¯äº¤æ˜“å‰æ–°å¢äº¤æ˜“çº§å»é‡æ£€æŸ¥ï¼š
```javascript
const existingInterestTx = transactions.find(t => 
    (t.systemType === 'interest' || t.systemType === 'interest-adjust') && 
    !t.undone && t.interestData?.date === yesterdayStr
);
if (existingInterestTx) { /* è·³è¿‡åˆ›å»ºï¼Œä»…æ ‡è®° settledDates */ }
```

#### 2) å¯åŠ¨æ—¶è‡ªåŠ¨å»é‡ [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L31416, ~L12588)

**ä¿®æ”¹**: æ–°å¢ `autoDeduplicateInterest()` å‡½æ•°ï¼Œåœ¨ initApp è‡ªåŠ¨ç»“ç®—å‰æ‰§è¡Œï¼š
```text
- æŒ‰ interestData.date åˆ†ç»„
- åŒæ—¥æœŸå¤šæ¡æ—¶ï¼Œä¼˜å…ˆä¿ç•™æœ‰ taskId çš„æ­£å¸¸ç»“ç®—è®°å½•
- å¤šä½™è®°å½•æ ‡è®° undoneï¼Œè‡ªåŠ¨è°ƒæ•´ä½™é¢
- é™é»˜æ‰§è¡Œï¼Œä»… console.log è¾“å‡º
- å»é‡ç»“æœåŒæ­¥äº‘ç«¯ï¼ˆDAL.deleteTransactionï¼‰ï¼Œé˜²æ­¢ä¸‹æ¬¡åŠ è½½æ—¶é‡å¤å‡ºç°
```

#### 3) ä¿®å¤å·¥å…· ID åŒ¹é… [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L31500)

**é—®é¢˜**: `repairDuplicateInterestData()` ç”¨ `t.id` æŸ¥æ‰¾ï¼Œä¿®å¤è„šæœ¬åˆ›å»ºçš„è®°å½•ä½¿ç”¨ `_id` å­—æ®µ â†’ `findIndex` å¤±è´¥
**ä¿®å¤**: æ”¹ä¸º `(t.id || t._id)` åŒå­—æ®µåŒ¹é…ï¼›æ’åºå¢åŠ  `taskId` æœ‰æ— ä½œä¸ºæ‰“ç ´å¹³å±€ä¾æ®

#### 4) DAL.loadAll ä½™é¢è®¡ç®—è¿‡æ»¤ undone [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L11943)

**é—®é¢˜**: `finalTransactions.reduce()` æœªè·³è¿‡ `undone` äº¤æ˜“ â†’ å·²æ’¤å›/å»é‡çš„äº¤æ˜“ä»å‚ä¸ä½™é¢è®¡ç®—
**ä¿®å¤**: æ·»åŠ  `if (tx.undone) return sum;`

#### 5) å±å¹•æ—¶é—´ç»“ç®—äº‘åŒæ­¥å®ˆå« [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L31856)

**é—®é¢˜**: `autoSettleScreenTime()` æ—  `hasCompletedFirstCloudSync` æ£€æŸ¥ â†’ ä¼‘çœ æ¢å¤æ—¶å¯èƒ½åœ¨æ—§æ•°æ®ä¸Šé‡å¤ç»“ç®—
**ä¿®å¤**: æ·»åŠ  `if (!hasCompletedFirstCloudSync && isLoggedIn()) return emptyResult;`

#### 6) ç¡çœ æƒ©ç½šäº‘åŒæ­¥å®ˆå« [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L27990)

**é—®é¢˜**: `checkMissedSleepPenalty()` æ— äº‘åŒæ­¥å®ˆå« â†’ å¯èƒ½åœ¨æ•°æ®æœªå°±ç»ªæ—¶è¯¯åˆ›å»ºæƒ©ç½šäº¤æ˜“
**ä¿®å¤**: æ·»åŠ  `if (!hasCompletedFirstCloudSync && isLoggedIn()) return null;`

#### 7) ä¼‘çœ æ¢å¤ç»“ç®—ä¸²è”ä¼˜åŒ– [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L37026)

**é—®é¢˜**: ä¼‘çœ æ¢å¤ç”¨å›ºå®š 5000ms å»¶è¿Ÿæ‰§è¡Œç»“ç®—ï¼Œè‹¥ `triggerSync` æœªå®Œæˆåˆ™æ•°æ®ä¸å®Œæ•´
**ä¿®å¤**: æ”¹ä¸º `triggerSync().then()` é“¾å¼è°ƒç”¨ï¼ŒåŒæ­¥å®Œæˆ â†’ é‡å»º watch â†’ 1s åç»“ç®—ï¼›å¤±è´¥æ—¶ 3s åå…œåº•

#### 8) å¯¼å…¥å‰å…³é—­ watch ç›‘å¬ [v7.15.4]
**æ–‡ä»¶**: `index.html` (~L10440)

**é—®é¢˜**: `importFromBackup()` åœ¨ `clearAllData()` å‰æœªå…³é—­ watch â†’ åˆ é™¤æ—§æ•°æ®è§¦å‘ remove äº‹ä»¶ â†’ ä½™é¢è¢« watch handler é”™è¯¯è°ƒæ•´
**ä¿®å¤**: åœ¨æ¸…ç†æ•°æ®å‰æ·»åŠ  `await this.unsubscribeAll()`

---
## v7.15.3 (2026-02-09) - å‡è¡¡æ¨¡å¼åŒæ­¥ä¸è‡ªåŠ¨æ£€æµ‹è¡¥å½•ä¿®å¤

### å…³é”®æ”¹åŠ¨

#### 1) å‡è¡¡æ¨¡å¼ watch å®æ—¶åŒæ­¥ä¿®å¤ [v7.15.3]
**æ–‡ä»¶**: `index.html` (~L11802)

**é—®é¢˜é“¾**:
```text
Profile watch handler ç›‘å¬åˆ° doc å˜æ›´å â†’ æ›´æ–°äº† profileData
â†’ ä½†ä»æœªè°ƒç”¨ loadBalanceModeFromCloud(doc)
â†’ balanceMode å˜é‡ä¿æŒåˆå§‹å€¼ {enabled: false}
â†’ updateAllUI() â†’ updateBalanceModeUI() è¯»åˆ°æ—§å€¼ â†’ å¼€å…³æ˜¾ç¤ºä¸ºå…³é—­
```

**ä¿®å¤**: Profile watch handler ä¸­æ–°å¢ `loadBalanceModeFromCloud(doc)` è°ƒç”¨

#### 2) è‡ªåŠ¨æ£€æµ‹è¡¥å½•æ˜¨æ—¥æ•°æ®äºŒæ¬¡æ£€æŸ¥ [v7.15.3]
**æ–‡ä»¶**: `index.html` (~L32040)

**é—®é¢˜**:
```text
é¦–æ¬¡æ£€æŸ¥æ˜¨å¤©æ—¶ï¼ˆå¦‚æ—©æ™¨å¼€æœºï¼‰ï¼ŒUsageStats æ•°æ®å¯èƒ½ä¸å®Œæ•´
â†’ actual â‰ˆ recordedï¼Œå·®å€¼ < 5åˆ†é’Ÿé˜ˆå€¼
â†’ æ ‡è®°ä¸º processedDates[taskKey] = {type:'ok'}
â†’ æ°¸è¿œä¸ä¼šå†æ£€æŸ¥è¿™ä¸ªæ—¥æœŸ â†’ æ¼è¡¥å½•
```

**ä¿®å¤**:
```text
- å·²æœ‰è‡ªåŠ¨æ£€æµ‹äº¤æ˜“çš„æ—¥æœŸ â†’ å§‹ç»ˆè·³è¿‡ï¼ˆé˜²æ­¢é‡å¤åˆ›å»ºäº¤æ˜“ï¼‰
- æ˜¨å¤©çš„æ•°æ® â†’ è·³è¿‡ processedDates ç¼“å­˜ï¼Œå…è®¸äºŒæ¬¡æ£€æŸ¥
- æ›´æ—©æ—¥æœŸ â†’ ä¿æŒåŸæœ‰ç¼“å­˜é€»è¾‘
```

#### 3) ä¼‘çœ æ¢å¤åé‡æ–°æ‰§è¡Œè‡ªåŠ¨ç»“ç®— [v7.15.3]
**æ–‡ä»¶**: `index.html` (~L36899)

**é—®é¢˜**: `autoDetectAppUsage()` ä»…åœ¨ `initApp()` å†·å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œå‰å°æ¢å¤æ—¶ä¸è§¦å‘
**ä¿®å¤**: `visibilitychange` æ£€æµ‹åˆ°é•¿ä¼‘çœ ï¼ˆ>1åˆ†é’Ÿï¼‰åå»¶è¿Ÿ 5 ç§’æ‰§è¡Œ `autoSettleScreenTime()` + `checkAndSettleInterest()`

#### 4) æ—¥æœŸèŒƒå›´å®‰å…¨ä¸Šé™ [v7.15.3]
**æ–‡ä»¶**: `index.html` (~L32138)

**é—®é¢˜**: `lastCheckedDate` è¿‡æ—§æ—¶è¿½æº¯å¤©æ•°æ— ä¸Šé™
**ä¿®å¤**: å³ä½¿ `lastCheckedDate` å¾ˆæ—§ï¼Œ`startDate` é™åˆ¶ä¸è¶…è¿‡ `AUTO_DETECT_MAX_DAYS`(7) å¤©å‰

#### 5) è®¾ç½®é¡µæ¸…ç†ä¸ UI è°ƒæ•´ [v7.15.3]
```text
- åˆ é™¤è®¾ç½®é¡µç´¯è®¡å‡€æ”¶ç›Šï¼ˆHTML + showNetInterestInfo() + updateFinanceSettingsUI ä¸­ netInterest æ›´æ–°ï¼‰
- å¼¹çª—åˆ©ç‡è®¾ç½® .finance-rate-box text-align: center â†’ left
- è®¾ç½®é¡µåˆ©ç‡åŠ å‡å· padding: 4px 10px â†’ 2px 8px, font-size: 0.9rem â†’ 0.85rem
```

---
## v7.15.2 (2026-02-09) - é‡‘èç³»ç»Ÿç¨³å®šæ€§ä¿®å¤ä¸å¯¼å…¥æé€Ÿ

### å…³é”®æ”¹åŠ¨

#### 1) settledDates æŒä¹…åŒ–ä¿®å¤ï¼ˆæ ¹å› ä¿®å¤ï¼‰[v7.15.2]
**æ–‡ä»¶**: `index.html` (~L31188)

**é—®é¢˜é“¾**:
```text
settleDailyInterest() ç»“ç®—åæœªè°ƒç”¨ saveFinanceSettings()
â†’ settledDates ä»…å­˜å†…å­˜ï¼Œé‡å¯ä¸¢å¤±
â†’ æ¯æ¬¡å¯åŠ¨é‡å¤ç»“ç®—åŒä¸€å¤© â†’ åˆ©æ¯äº¤æ˜“ç¿»å€ â†’ ä½™é¢ä¸¥é‡åç§»
ï¼ˆæ­¤ä¸º v7.15.0 æ•°æ®æŸåäº‹ä»¶çš„æ ¹å› ï¼‰
```

**ä¿®å¤**: åœ¨ `settleDailyInterest()` ä¿å­˜æ®µé¦–è¡Œæ·»åŠ  `saveFinanceSettings()`

#### 2) é‡‘èç³»ç»Ÿå…¨é‡äº‘ç«¯ç»Ÿä¸€åŒæ­¥ [v7.15.2]
**æ–‡ä»¶**: `index.html` (~L31046, ~L11816, ~L12099, ~L30981)

**ä¿®æ”¹å†…å®¹**:
```text
- applyFinanceSettingsFromCloud â†’ applyFinanceDataFromCloudï¼ˆé‡å‘½å+æ‰©å±•ï¼‰
  * åŒæ—¶å¤„ç† financeSettings + interestLedger
  * settledDates: å–æœ¬åœ°ä¸äº‘ç«¯å¹¶é›† + 60å¤©è£å‰ª
  * interestLedger: æŒ‰æ—¥æœŸåˆå¹¶ï¼ˆå·²ç»“ç®—ä¼˜å…ˆã€æ—¶é—´æˆ³æ–°è€…ä¼˜å…ˆï¼‰
  * äº‘ç«¯åŠ è½½æ—¶ä»…å­˜æœ¬åœ°ä¸å›å†™ï¼Œé¿å… watch å¾ªç¯
- saveInterestLedger() æ–°å¢ skipCloudSync å‚æ•°ï¼Œé»˜è®¤åŒæ­¥åˆ°äº‘ç«¯ profile
- Profile watch handler: ç›‘å¬ financeSettings + interestLedger å˜æ›´
- DAL.loadAll(): åˆå§‹åŠ è½½æ—¶è°ƒç”¨ applyFinanceDataFromCloud(profile)
```

#### 3) recalculateInterestOnUndo é‡å†™ [v7.15.2]
**æ–‡ä»¶**: `index.html` (~L16129)

**é—®é¢˜**:
```text
æ—§ç‰ˆç”¨ currentBalance åæ¨å„æ—¥ä½™é¢ â†’ ä¸¤ä¸ª Bug:
1. currentBalance æ­¤æ—¶ä»å«è¢«æ’¤å›äº¤æ˜“é‡‘é¢ï¼ˆåŸºæ•°é”™è¯¯ï¼‰
2. åŒ…å«åˆ©æ¯äº¤æ˜“å‚ä¸ä½™é¢è®¡ç®—ï¼ˆå¾ªç¯ä¾èµ–ï¼‰
```

**ä¿®å¤**: å®Œå…¨é‡å†™ä¸ºæ­£å‘ç´¯ç§¯æ³•ï¼š
```text
1. è¿‡æ»¤æ‰åˆ©æ¯/åˆ©æ¯è°ƒæ•´äº¤æ˜“å’Œè¢«æ’¤å›äº¤æ˜“
2. æŒ‰æ—¥æœŸåˆ†ç»„ï¼Œç´¯ç§¯è®¡ç®—å„æ—¥ç»“æŸä½™é¢
3. å¯¹å—å½±å“æ—¥æœŸé‡ç®—åˆ©æ¯ï¼Œä¸å®é™…åˆ©æ¯äº¤æ˜“å¯¹æ¯”
4. ç”Ÿæˆå·®é¢è°ƒæ•´äº¤æ˜“
```

#### 4) settleDailyInterest ä½™é¢å›é€€ä¿®å¤ [v7.15.2]
**æ–‡ä»¶**: `index.html` (~L31131)

**é—®é¢˜**: æ—  interestLedger è®°å½•æ—¶å›é€€åˆ° `currentBalance`ï¼ˆä»Šå¤©å€¼ï¼Œéæ˜¨å¤©å€¼ï¼‰
**ä¿®å¤**: ä»äº¤æ˜“è®°å½•æ­£å‘ç´¯åŠ åˆ°æ˜¨æ—¥ï¼ˆæ’é™¤åˆ©æ¯äº¤æ˜“é¿å…å¾ªç¯ï¼Œå†åŠ ä¸Šå·²æœ‰åˆ©æ¯äº¤æ˜“ï¼‰

#### 5) recalculateFinanceStatsFromTransactions é‡å†™ [v7.15.2]
**æ–‡ä»¶**: `index.html` (~L30998)

**é—®é¢˜**: ä»…ç»Ÿè®¡ä»Šæ—¥åˆ©æ¯äº¤æ˜“ â†’ ç´¯è®¡ç»Ÿè®¡æ°¸è¿œåªæœ‰å½“å¤©æ•°æ®
**ä¿®å¤**: éå†å…¨éƒ¨ transactionsï¼Œç´¯è®¡æ‰€æœ‰ interest/interest-adjustï¼ŒinterestDays ç”¨ Set å»é‡

#### 6) ç»“ç®—å®‰å…¨é˜²æŠ¤ [v7.15.2]
**æ–‡ä»¶**: `index.html` (~L31241)

**ä¿®æ”¹**: `checkAndSettleInterest()` æ–°å¢ `hasCompletedFirstCloudSync` æ£€æŸ¥ï¼Œå·²ç™»å½•ä½†äº‘ç«¯æœªå°±ç»ªæ—¶è·³è¿‡ç»“ç®—

#### 7) å¯¼å…¥é€Ÿåº¦ä¼˜åŒ– [v7.15.2]
**æ–‡ä»¶**: `index.html` (~L10656, ~L10511)

**ä¿®æ”¹**:
```text
- clearAllData(): è‡ªå®šä¹‰è§„åˆ™è¡¨æ”¹ç”¨ where().remove() æ‰¹é‡åˆ é™¤ï¼ˆ~2æ¬¡APIæ›¿ä»£500+æ¬¡ï¼‰
  * é¢„ç½®è§„åˆ™è¡¨å¹¶å‘ä»20æå‡åˆ°50
  * å†…ç½®é™çº§æ–¹æ¡ˆï¼šæ‰¹é‡åˆ é™¤å¤±è´¥è‡ªåŠ¨å›é€€é€æ¡åˆ é™¤
- importFromBackup: äº¤æ˜“å¯¼å…¥ BATCH_SIZE ä» 50 æå‡åˆ° 100
- é¢„è®¡å¯¼å…¥æ—¶é—´ä» ~3åˆ†é’Ÿé™åˆ° 30-60ç§’
```

#### 8) ä»£ç æ¸…ç† [v7.15.2]
```text
- åˆ é™¤åºŸå¼ƒ showFinanceDetailModal()ï¼ˆ~120è¡Œï¼‰ï¼Œå·²è¢« CombinedModal æ›¿ä»£
- åˆ é™¤ financeStats æœªä½¿ç”¨å­—æ®µ maxBalance/minBalance
- æ–°å¢ interest-adjust äº¤æ˜“æ˜¾ç¤ºè§£æåˆ†æ”¯
- settledDates 60å¤©è‡ªåŠ¨è£å‰ªï¼ˆinit + äº‘ç«¯åˆå¹¶æ—¶æ‰§è¡Œï¼‰
```

---
## v7.15.0 (2026-02-07) - æ—¶é—´é‡‘èç³»ç»Ÿ

### å…³é”®æ”¹åŠ¨

#### 1) æ—¶é—´é‡‘èç³»ç»Ÿ [v7.15.0]
**æ–‡ä»¶**: `index.html` (~L29470, ~L6110)

**ä¿®æ”¹å†…å®¹**:
```text
- æ–°å¢é‡‘èç³»ç»Ÿè®¾ç½®ï¼šå­˜æ¬¾åˆ©ç‡/è´·æ¬¾åˆ©ç‡è°ƒèŠ‚ï¼ˆå¹¶æ’ç´§å‡‘å¸ƒå±€ï¼‰
- æ¯æ—¥è‡ªåŠ¨ç»“ç®—åˆ©æ¯ï¼ˆé»˜è®¤ 04:00ï¼‰ï¼Œäº¤æ˜“æ—¶é—´è®¾ä¸ºæ˜¨æ—¥ 23:59
- settledDates å·²ç»“ç®—æ ‡è®°ï¼Œé˜²æ­¢é‡å¤ç»“ç®—
- å¼€å¯ç³»ç»Ÿæ—¶è‡ªåŠ¨æ ‡è®°å†å²æ—¥æœŸä¸ºå·²ç»“ç®—ï¼Œé˜²æ­¢å†å²ç»“ç®—
- åˆ©æ¯ç»Ÿè®¡ä»…ä»ä»Šæ—¥èµ·ç®—ï¼Œä¸è¿½æº¯å†å²
```

#### 2) æ–°ä½™é¢å¡ç‰‡è®¾è®¡ [v7.15.0]
**æ–‡ä»¶**: `index.html` (~L268, ~L5310)

**ä¿®æ”¹å†…å®¹**:
```text
- é‡‘èç³»ç»Ÿå¼€å¯æ—¶ä½¿ç”¨æ–°å¡ç‰‡ï¼ˆåŒæ–¹æ¡ˆåˆ‡æ¢ï¼‰
- Header å§‹ç»ˆæ˜¾ç¤ºä½™é¢ï¼Œå±•å¼€æ˜¾ç¤ºä»Šæ—¥ç»Ÿè®¡/é¢„è®¡åˆ©æ¯
- æ”¯æŒæ»‘åŠ¨æ‰‹åŠ¿å±•å¼€/æ”¶èµ·
- ä¸å±å¹•æ—¶é—´/ç¡çœ å¡ç‰‡åè°ƒçš„å †å æ•ˆæœ
- æ–°å¢"é¦–é¡µæ˜¾ç¤ºæ–°å¡ç‰‡"ç‹¬ç«‹å¼€å…³
```

#### 3) åˆ©æ¯äº¤æ˜“è§£æ [v7.15.0]
**æ–‡ä»¶**: `index.html` (~L20296)

**ä¿®æ”¹å†…å®¹**:
```text
- æ–°å¢åˆ©æ¯äº¤æ˜“ç‰¹æ®Šè§£æé€»è¾‘
- æ ‡é¢˜ï¼šğŸ’° å­˜æ¬¾åˆ©æ¯ / ğŸ’¸ è´·æ¬¾åˆ©æ¯ï¼ˆçº¯å‡€æ— åç¼€ï¼‰
- è¯¦æƒ…ï¼š-42å°æ—¶58åˆ† Ã— 1% æ ¼å¼
- å½’å…¥ç³»ç»Ÿåˆ†ç±»ï¼Œç»Ÿä¸€è§†è§‰å¤„ç†
```

#### 4) ä½™é¢è¯¦æƒ…å¼¹çª— [v7.15.0]
**æ–‡ä»¶**: `index.html` (~L8225, ~L16098)

**ä¿®æ”¹å†…å®¹**:
```text
- 7æ—¥ä½™é¢è¶‹åŠ¿å›¾ï¼ˆè¿·ä½ æŸ±çŠ¶å›¾ï¼‰
- åˆ©æ¯ç»Ÿè®¡ï¼ˆç´¯è®¡å­˜æ¬¾/è´·æ¬¾/å‡€æ”¶ç›Šï¼‰
- æ˜¨æ—¥è¯¦æƒ…ï¼ˆä½™é¢/åˆ©æ¯ï¼‰
- æœ¬å‘¨æ±‡æ€»ï¼ˆè·å¾—/æ¶ˆè´¹/å‡€å€¼ï¼‰
```

#### 5) æ’¤å›åˆ©æ¯é‡ç®— [v7.15.0]
**æ–‡ä»¶**: `index.html` (~L16090, ~L18668)

**ä¿®æ”¹å†…å®¹**:
```text
- 7æ—¥å†…æ’¤å›ä»»åŠ¡è‡ªåŠ¨é‡ç®—å—å½±å“æ—¥æœŸçš„åˆ©æ¯
- >7æ—¥æ’¤å›è·³è¿‡é‡ç®—
- ç”Ÿæˆåˆ©æ¯è°ƒæ•´äº¤æ˜“è®°å½•
- ä½™é¢è‡ªåŠ¨æ ¡æ­£
```

#### 6) æ•°æ®ä¿®å¤å·¥å…·å¢å¼º [v7.15.0]
**æ–‡ä»¶**: `index.html` (~L30820)

**ä¿®æ”¹å†…å®¹**:
```text
- æ–°å¢èµ„äº§è´Ÿå€ºå®¡è®¡ï¼šè®¡ç®— Sum(Transactions) ä¸ currentBalance çš„åå·®
- ä¿®å¤é‡å¤åˆ©æ¯ï¼šåˆ é™¤åŒä¸€æ—¥æœŸå¤šæ¡åˆ©æ¯è®°å½•ï¼Œä¿ç•™æœ€æ–°
- ä½™é¢æ ¡æ­£ï¼šè‡ªåŠ¨åˆ›å»ºæ ¡æ­£äº¤æ˜“ï¼Œç¡®ä¿è´¦ç›®å¹³è¡¡
- å®¡è®¡æŠ¥å‘Šï¼šæ˜¾ç¤ºåå·®é‡‘é¢å’Œä¿®å¤è¯¦æƒ…
```

---
## v7.14.1 (2026-02-07) - Tab æŒ‡ç¤ºå™¨åŠ¨ç”»ä¸é€šé€æ¨¡å¼ä¼˜åŒ–

### å…³é”®æ”¹åŠ¨

#### 1) Tab æŒ‡ç¤ºå™¨æ»‘åŠ¨åŠ¨ç”» [v7.14.1]
**æ–‡ä»¶**: `index.html` (~L7600, ~L800)

**ä¿®æ”¹å†…å®¹**:
```text
- åº•éƒ¨å¯¼èˆªæ–°å¢ .tab-indicator å…ƒç´ 
- ä½¿ç”¨ transform: translateX() å®ç°å¹³æ»‘æ»‘åŠ¨
- Tab åˆ‡æ¢æ—¶æŒ‡ç¤ºæ¡è·Ÿéšç§»åŠ¨ï¼ˆ300ms ç¼“åŠ¨ï¼‰
- é€šé€æ¨¡å¼ä¸‹æŒ‡ç¤ºæ¡ä¸ºç™½è‰²å¸¦å…‰æ™•æ•ˆæœ
```

#### 2) Tab æŒ‰é’®å›¾æ ‡åŠ¨ç”» [v7.14.1]
**æ–‡ä»¶**: `index.html` (~L1640)

**ä¿®æ”¹å†…å®¹**:
```text
- æ´»è·ƒ Tab å›¾æ ‡æ”¾å¤§ 1.15 å€
- 200ms ease è¿‡æ¸¡æ•ˆæœ
- ä»…ä½¿ç”¨ transform: scale()ï¼Œä¸å½±å“æ€§èƒ½
```

#### 3) æ¡Œé¢å°ç»„ä»¶æƒé™ç®¡ç† [v7.14.1]
**æ–‡ä»¶**: `WebAppInterface.java`, `index.html`

**ä¿®æ”¹å†…å®¹**:
```text
- æ–°å¢ canAddWidget() æ–¹æ³•æ£€æµ‹ç³»ç»Ÿæ”¯æŒæƒ…å†µ
- æƒé™ç®¡ç†æ–°å¢ã€Œæ¡Œé¢å°ç»„ä»¶ã€é¡¹
- ä¸æ”¯æŒä¸€é”®æ·»åŠ æ—¶æ˜¾ç¤ºå¼•å¯¼å¼¹çª—
- å°ç»„ä»¶é€‰æ‹©å™¨ç§»é™¤åº•éƒ¨æŒ‰é’®ï¼Œç‚¹å‡»é®ç½©å…³é—­
```

#### 4) é€šé€æ¨¡å¼å¯è¯»æ€§ä¿®å¤ [v7.14.1]
**æ–‡ä»¶**: `index.html`

**ä¿®å¤å†…å®¹**:
```text
- #permissionGrantedSection summary æ–‡å­—é¢œè‰²ä¼˜åŒ–
- .about-section è‘—ä½œæƒä¿¡æ¯é¢œè‰²ç»Ÿä¸€
- .demo-task-tag ç¤ºä¾‹ä»»åŠ¡æ ‡ç­¾æ ·å¼
- .demo-task-icon ç¤ºä¾‹ä»»åŠ¡å›¾æ ‡æ ·å¼
- .setting-name .info-button è®¾ç½®é¡¹è¯´æ˜æŒ‰é’®
- .text-positive/.text-negative/.text-neutral é¢œè‰²å¢å¼º
- .empty-message ç©ºçŠ¶æ€æç¤ºæ–‡å­—
```

---
## v7.14.0 (2026-02-05) - æ‚¬æµ®çª—æ™ºèƒ½ç‚¹å‡»ä¿®å¤

### å…³é”®æ”¹åŠ¨

#### 1) æ‚¬æµ®çª—æ™ºèƒ½ç‚¹å‡»æš‚åœåŠŸèƒ½ä¿®å¤ï¼ˆå…³é”®ä¿®å¤ï¼‰
**é—®é¢˜**: æŸäº› Android 12+ / 16 è®¾å¤‡ä¸Š"åœ¨å…³è”åº”ç”¨å†… â†’ æš‚åœè®¡æ—¶ + è¿”å› Time Bank"åŠŸèƒ½ä¸­çš„æš‚åœåŠŸèƒ½å¤±æ•ˆ

**æ ¹å› åˆ†æ**:
- `getRunningAppProcesses()` åœ¨ Android 10+ ä¸Šå—é™ï¼Œè¿”å›ä¿¡æ¯ä¸å®Œæ•´
- `process.importance` åˆ¤æ–­è¿‡äºä¸¥æ ¼ï¼ŒæŸäº›è®¾å¤‡ä¸Šå‰å°åº”ç”¨å¯èƒ½æ˜¯ `IMPORTANCE_FOREGROUND_SERVICE`
- ç¼ºå°‘è°ƒè¯•æ—¥å¿—ï¼Œæ— æ³•å®šä½é—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ**:
```text
- æ–°å¢ UsageStatsManager ä½œä¸ºå¤‡é€‰æ£€æµ‹æ–¹æ¡ˆï¼ˆAndroid 5.0+ï¼‰
- æ”¾å®½è¿›ç¨‹é‡è¦æ€§åˆ¤æ–­ï¼šæ¥å— FOREGROUND æˆ– FOREGROUND_SERVICE
- æ–°å¢ getTopAppPackageViaUsageStats() æ–¹æ³•é€šè¿‡ä½¿ç”¨ç»Ÿè®¡æŸ¥è¯¢å‰å°åº”ç”¨
- æ–°å¢è¯¦ç»†è°ƒè¯•æ—¥å¿—ï¼ˆDEBUG_LOG å¼€å…³ï¼ŒTAG="FloatingTimer"ï¼‰
- isAppInForeground() åŒæ­¥å¢å¼ºï¼Œä½¿ç”¨ç›¸åŒçš„åŒé‡éªŒè¯æœºåˆ¶
```

**Logcat è°ƒè¯•**:
```
# ç­›é€‰å…³é”®è¯
package:com.jianglicheng.timebank tag:FloatingTimer

# è°ƒè¯•æ­¥éª¤
1. å¼€å¯æ‚¬æµ®çª—è®¡æ—¶å™¨å¹¶å…³è”åº”ç”¨
2. æ‰“å¼€å…³è”åº”ç”¨ï¼Œç‚¹å‡»æ‚¬æµ®çª—

#### 2) å±å¹•æ—¶é—´å°ç»„ä»¶ UI ä¼˜åŒ–
**æ–‡ä»¶**: `ScreenTimeWidgetProvider.java`, `widget_screen_time_classic.xml`, `widget_screen_time_classic_info.xml`

**ä¿®æ”¹å†…å®¹**:
```text
- å°ºå¯¸è°ƒæ•´ï¼š2Ã—2 â†’ 2Ã—1ï¼ˆä¸æ—¶é—´ä½™é¢å°ç»„ä»¶ä¸€è‡´ï¼‰
- å¸ƒå±€é‡æ„ï¼šæ°´å¹³æ’åˆ—ï¼Œå·¦ä¾§æ ‡é¢˜+ç™¾åˆ†æ¯”ï¼Œå³ä¾§ä½¿ç”¨é‡/é™é¢
- åœ†è§’ç»Ÿä¸€ï¼š20dpï¼ˆä¸æ—¶é—´ä½™é¢å°ç»„ä»¶ä¸€è‡´ï¼‰
- èƒŒæ™¯æ ·å¼ï¼šçº¯è‰² â†’ æ¸å˜è‰²ï¼ˆä¸é¦–é¡µå±å¹•æ—¶é—´å¡ç‰‡ä¸€è‡´ï¼‰
  * â‰¤33%: ç»¿è‰²æ¸å˜ (#27ae60 â†’ #1abc9c)
  * 34%-66%: è“è‰²æ¸å˜ (#3498db â†’ #9b59b6)
  * 67%-100%: æ©™è‰²æ¸å˜ (#f39c12 â†’ #e74c3c)
  * >100%: çº¢è‰²æ¸å˜ (#e74c3c â†’ #8e44ad)
- ç§»é™¤è¿›åº¦æ¡ï¼ˆ2Ã—1 å°ºå¯¸é™åˆ¶ï¼‰
- æ–°å¢æ¸å˜èƒŒæ™¯ drawableï¼šwidget_screen_time_green/blue/orange/red.xml
```

**åˆ é™¤æ–‡ä»¶**:
- `widget_screen_time_classic_bg.xml`ï¼ˆè¢«æ–°çš„æ¸å˜èƒŒæ™¯æ›¿æ¢ï¼‰

#### 3) æ—¶é—´ä½™é¢å°ç»„ä»¶æ¸å˜è‰²æ–¹æ¡ˆ [v7.14.0]
**æ–‡ä»¶**: `BalanceWidgetProvider.java`, `widget_balance_*.xml`

**åŠŸèƒ½**: æ ¹æ®ä½™é¢åŒºé—´è‡ªåŠ¨åˆ‡æ¢æ¸å˜èƒŒæ™¯é¢œè‰²ï¼ˆä¸å±å¹•æ—¶é—´å°ç»„ä»¶é…è‰²ä¸€è‡´ï¼‰

**åŒºé—´é…è‰²**:
```text
>24å°æ—¶:  è“è‰²æ¸å˜ (#3498db â†’ #9b59b6)   - ä½™é¢å……è¶³
0~24h:    ç»¿è‰²æ¸å˜ (#27ae60 â†’ #1abc9c)   - ç†æƒ³åŒºé—´ â­
-24~0h:   æ©™è‰²æ¸å˜ (#f39c12 â†’ #e74c3c)   - ä½™é¢åå°‘
<-24h:    çº¢è‰²æ¸å˜ (#e74c3c â†’ #8e44ad)   - ä½™é¢ä¸è¶³
```

**ä¿®æ”¹å†…å®¹**:
- BalanceWidgetProvider: ç®€åŒ–åŒºé—´é€»è¾‘ä¸º 4 æ¡£ï¼ˆç»¿/è“/æ©™/çº¢ï¼‰
- æ–‡å­—é¢œè‰²: ç»Ÿä¸€ç™½è‰²ï¼ˆåœ¨æ¸å˜èƒŒæ™¯ä¸Šæ›´æ¸…æ™°ï¼‰

**èƒŒæ™¯æ–‡ä»¶**:
- widget_balance_green.xml (#27ae60 â†’ #1abc9c)
- widget_balance_blue.xml (#3498db â†’ #9b59b6)
- widget_balance_orange.xml (#f39c12 â†’ #e74c3c)
- widget_balance_red.xml (#e74c3c â†’ #8e44ad)

**åˆ é™¤æ–‡ä»¶**:
- widget_balance_purple.xml / yellow.xmlï¼ˆåŒºé—´åˆå¹¶åä¸å†ä½¿ç”¨ï¼‰
- widget_balance_bg.xmlï¼ˆæ—§èƒŒæ™¯ï¼‰
- æç®€å’Œè¯¦æƒ…å°ç»„ä»¶ç›¸å…³æ–‡ä»¶
```

#### 4) å°ç»„ä»¶é€šé€æ¨¡å¼ä¸‰ç§æ–¹æ¡ˆ [v7.14.0]
**æ–‡ä»¶**: `BalanceWidgetGlass/System/TransparentProvider.java`, `ScreenTimeWidgetGlass/System/TransparentProvider.java`

**ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”**:
```text
æ–¹æ¡ˆä¸€ï¼šæ¯›ç»ç’ƒæ–‡å­—æ¸å˜
- èƒŒæ™¯: è‡ªç„¶åŠé€æ˜ç°è‰² (#40f5f5f5) + ç™½è‰²è¾¹æ¡†ï¼ˆä¸æ³›ç™½ï¼‰
- æ ‡ç­¾: **æ·±ç°è‰²** (#333333, alpha=0.95)
- æ•°å­—: **åŠ¨æ€æ¸å˜ Bitmap**ï¼ˆéšæ•°æ®å˜è‰²ï¼‰

æ–¹æ¡ˆäºŒï¼šç³»ç»Ÿé€æ˜
- èƒŒæ™¯: è¾ƒæµ…é€æ˜ (#60ffffff)
- æ ‡ç­¾: **æ·±ç°è‰²** (#333333)
- æ•°å­—: **åŠ¨æ€æ¸å˜ Bitmap**ï¼ˆæ–°å¢æ¸å˜æ•ˆæœï¼‰

æ–¹æ¡ˆä¸‰ï¼šé«˜é€æ˜æ¸å˜
- èƒŒæ™¯: 25% é€æ˜åº¦æ¸å˜è‰² + ç™½è‰²è¾¹æ¡†
- æ ‡ç­¾: **æ·±ç°è‰²** (#333333)
- æ•°å­—: **åŠ¨æ€æ¸å˜ Bitmap**ï¼ˆæ–°å¢æ¸å˜æ•ˆæœï¼‰

**æ¸å˜å®ç°**: æ‰€æœ‰é€šé€æ¨¡å¼å°ç»„ä»¶ä½¿ç”¨ Canvas.drawText() + LinearGradient ç»˜åˆ¶æ¸å˜æ–‡å­—

æ–¹æ¡ˆäºŒï¼šç³»ç»Ÿé€æ˜
- èƒŒæ™¯: è¾ƒæµ…é€æ˜ (#60ffffff)
- æ–‡å­—: æ·±ç°è‰² (#2c3e50)
- ç‰¹ç‚¹: ä¾èµ–ç³»ç»Ÿ launcher æ¨¡ç³Šå¤„ç†ï¼Œæ•ˆæœå› æ‰‹æœºè€Œå¼‚

æ–¹æ¡ˆä¸‰ï¼šé«˜é€æ˜æ¸å˜
- èƒŒæ™¯: 25% é€æ˜åº¦æ¸å˜è‰² + ç™½è‰²è¾¹æ¡†
- æ–‡å­—: æ·±ç°è‰² (#2c3e50)
- ç‰¹ç‚¹: éšä½™é¢/å±å¹•æ—¶é—´æ¯”ä¾‹å˜è‰²ï¼Œå…¼é¡¾é€šé€æ„Ÿå’ŒåŠŸèƒ½æ€§
```

**æ–°å¢ Provider** (6ä¸ª):
- æ—¶é—´ä½™é¢: BalanceWidgetGlassProvider / SystemProvider / TransparentProvider
- å±å¹•æ—¶é—´: ScreenTimeWidgetGlassProvider / SystemProvider / TransparentProvider

**æ–°å¢å¸ƒå±€** (6ä¸ª):
- widget_balance_glass.xml / system.xml / transparent.xml
- widget_screen_time_glass.xml / system.xml / transparent.xml

**æ–°å¢èƒŒæ™¯** (6ä¸ª):
- widget_glass_bg.xml / widget_system_bg.xml
- widget_transparent_green.xml / blue.xml / orange.xml / red.xml

**æ–°å¢é…ç½®** (6ä¸ª):
- widget_balance_glass_info.xml / system_info.xml / transparent_info.xml
- widget_screen_time_glass_info.xml / system_info.xml / transparent_info.xml

**ä¿®æ”¹æ–‡ä»¶**:
- AndroidManifest.xml: æ³¨å†Œ 6 ä¸ªæ–°çš„å°ç»„ä»¶
- strings.xml: æ·»åŠ  6 ä¸ªæè¿°å­—ç¬¦ä¸²
- WebAppInterface.updateWidgets(): åŒæ­¥æ›´æ–°æ‰€æœ‰ 8 ç§å°ç»„ä»¶
```

#### 4) æ¡Œé¢å°ç»„ä»¶æ·»åŠ å¼•å¯¼ [v7.14.0]
**æ–‡ä»¶**: `index.html`, `WebAppInterface.java`

**åŠŸèƒ½**: åœ¨è®¾ç½®é¡µå¤–è§‚è®¾ç½®ä¸­æ–°å¢ã€Œæ¡Œé¢å°ç»„ä»¶ã€å…¥å£ï¼Œç‚¹å‡»å¼¹å‡ºå°ç»„ä»¶é€‰æ‹©å™¨

**å¼¹çª—å†…å®¹**:
```text
- 2Ã—2 ç½‘æ ¼å±•ç¤º 8 ç§å°ç»„ä»¶é¢„è§ˆå›¾
- å·¦åˆ—ï¼šå±å¹•æ—¶é—´ç³»åˆ—ï¼ˆæ¸å˜ã€æ¯›ç»ç’ƒã€ç³»ç»Ÿé€æ˜ã€é«˜é€æ˜æ¸å˜ï¼‰
- å³åˆ—ï¼šæ—¶é—´ä½™é¢ç³»åˆ—ï¼ˆæ¸å˜ã€æ¯›ç»ç’ƒã€ç³»ç»Ÿé€æ˜ã€é«˜é€æ˜æ¸å˜ï¼‰
- æ¯ä¸ªé¢„è§ˆå›¾æ¨¡æ‹ŸçœŸå®æ ·å¼å’Œé…è‰²
- ç‚¹å‡»å°ç»„ä»¶æ˜¾ç¤ºæ·»åŠ å¼•å¯¼æç¤º
```

**æŠ€æœ¯å®ç°**:
```text
- Android 8.0+ (API 26+) æ”¯æŒ requestPinAppWidget() æ–¹æ³•
- è°ƒç”¨åä¼šå¼¹å‡ºç³»ç»Ÿçº§å¯¹è¯æ¡†ï¼Œç”¨æˆ·ç‚¹å‡»ç¡®è®¤å³å¯æ·»åŠ 
- ä½ç‰ˆæœ¬æˆ–ä¸æ”¯æŒçš„è®¾å¤‡ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨æ·»åŠ å¼•å¯¼
- å‰ç«¯è°ƒç”¨ï¼šAndroid.addWidgetToHomeScreen(widgetType)
- åŸç”Ÿå¤„ç†ï¼šæ ¹æ®ç±»å‹è·å–å¯¹åº” Providerï¼Œè°ƒç”¨ç³»ç»Ÿ API
```

**æ–°å¢ä»£ç **:
- openWidgetSelector() / closeWidgetSelector()
- addWidgetToHomeScreen() - è°ƒç”¨åŸç”Ÿæ–¹æ³•
- showWidgetGuide() - æ˜¾ç¤ºæ·»åŠ æ–¹æ³•å¼•å¯¼
- WebAppInterface.addWidgetToHomeScreen() - åŸç”Ÿå®ç°
```

---
## v7.13.0 (2026-02-04) - æ‚¬æµ®çª—è®¡æ—¶å™¨äº¤äº’å¢å¼º

### å…³é”®æ”¹åŠ¨

#### 1) æ‚¬æµ®çª—ç‚¹å‡»è¡Œä¸ºæ™ºèƒ½åˆ¤æ–­
**æ–‡ä»¶**: `FloatingTimerService.java`, `WebAppInterface.java`, `index.html`
```text
- TimerInfo æ–°å¢ appPackage å­—æ®µå­˜å‚¨å…³è”åº”ç”¨åŒ…å
- æ–°å¢ isAppInForeground()ï¼šåˆ¤æ–­ Time Bank æ˜¯å¦åœ¨å‰å°
- æ–°å¢ handleFloatingTimerClick()ï¼šæ™ºèƒ½åˆ¤æ–­ç‚¹å‡»è¡Œä¸º
  * å¦‚æœ Time Bank åœ¨å‰å°ï¼šæ¢å¤è®¡æ—¶ï¼ˆå¦‚æœæš‚åœï¼‰+ è·³è½¬å…³è”åº”ç”¨
  * å¦‚æœ Time Bank åœ¨åå°ï¼šæ‰“å¼€ Time Bank ä¸»ç•Œé¢ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
- WebAppInterface.startFloatingTimer() æ–°å¢ appPackage å‚æ•°
- å‰ç«¯å¯åŠ¨æ‚¬æµ®çª—æ—¶ä¼ å…¥ task.appPackage
```

#### 2) æ‚¬æµ®çª—è®¡æ—¶å™¨è¯´æ˜æŒ‰é’®
**æ–‡ä»¶**: `index.html`
```text
- è®¾ç½®é¡µã€Œæ‚¬æµ®çª—è®¡æ—¶å™¨ã€å¼€å…³æ ‡é¢˜æ—æ–°å¢è¯´æ˜æŒ‰é’®ï¼ˆ?ï¼‰
- ä»»åŠ¡ç¼–è¾‘é¡µã€Œæ‚¬æµ®çª—è®¡æ—¶å™¨ã€å¼€å…³æ ‡é¢˜æ—æ–°å¢è¯´æ˜æŒ‰é’®ï¼ˆ?ï¼‰
- æ–°å¢æ‚¬æµ®çª—è®¡æ—¶å™¨è¯´æ˜å¼¹çª—ï¼ŒåŒ…å«åŠŸèƒ½ä»‹ç»å’Œä½¿ç”¨æç¤º
- æ–°å¢å¼¹çª—é€šé€æ¨¡å¼æ ·å¼æ”¯æŒ
- æ–°å¢ showFloatingTimerInfoModal() / hideFloatingTimerInfoModal() å‡½æ•°
```

#### 3) ã€Œå…¨éƒ¨ä»»åŠ¡ã€è¾¹ä¸ŠæŒ‰é’®é¢œè‰²ä¿®å¤
**æ–‡ä»¶**: `index.html`
```text
- view-switch-btn é¢œè‰²ä» --text-color-light æ”¹ä¸º --section-title-color
- section-title-group å†…çš„ info-button é¢œè‰²æ”¹ä¸º --section-title-color
- ç¡®ä¿æŒ‰é’®é¢œè‰²ä¸æ ‡é¢˜é¢œè‰²ä¸€è‡´ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†
```

#### 4) è®¾ç½®é¡µã€Œå…³äºã€æ”¹ä¸ºå¯æŠ˜å 
**æ–‡ä»¶**: `index.html`
```text
- å°†å…³äºéƒ¨åˆ†æ”¹ä¸º details/summary å¯æŠ˜å ç»“æ„
- summary æ ·å¼ä¸ã€Œç‰ˆæœ¬æ›´æ–°æ—¥å¿—ã€ç»Ÿä¸€ï¼ˆç§»é™¤è‡ªå®šä¹‰æ ·å¼ï¼‰
- é‡æ–°æ’ç‰ˆè‘—ä½œæƒä¿¡æ¯ï¼š
  * ä½¿ç”¨ flex å¸ƒå±€å·¦å³å¯¹é½æ˜¾ç¤ºï¼ˆæ ‡ç­¾: å€¼ï¼‰
  * è½¯ä»¶åç§°å³ä¾§æ˜¾ç¤ºï¼Œé™åˆ¶æœ€å¤§å®½åº¦é¿å…æ¢è¡Œ
  * ä½¿ç”¨ CSS å˜é‡é€‚é…æ·±è‰²/æµ…è‰²ä¸»é¢˜
  * ç‰ˆæƒæ‰€æœ‰ç®€åŒ–ä¸º"å§œåŠ›æˆ"ï¼Œé‚®ç®±å•ç‹¬ä¸€è¡Œ
  * åº•éƒ¨ç‰ˆæƒä¿¡æ¯æ”¹ä¸ºå•è¡Œç´§å‡‘æ˜¾ç¤º
- ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤ºæ•ˆæœï¼Œå‡å°‘ä¸å¿…è¦çš„æ¢è¡Œ
```

#### 5) Android çŠ¶æ€æ é«˜åº¦é€‚é…
**æ–‡ä»¶**: `WebAppInterface.java`, `index.html`
```text
- WebAppInterface æ–°å¢ getStatusBarHeight() æ–¹æ³•
- index.html æ–°å¢ --status-bar-height CSS å˜é‡
- index.html æ–°å¢ setAndroidStatusBarHeight() JS å‡½æ•°
- .header padding å¢åŠ  var(--status-bar-height) å˜é‡
```

#### 6) æ¡Œé¢ç«¯ä»»åŠ¡å¡ç‰‡æ‹–æ‹½é‡æ–°è®¾è®¡
**æ–‡ä»¶**: `index.html`
```text
- ç§»é™¤ HTML5 drag API å®ç°ï¼ˆå…¼å®¹æ€§é—®é¢˜ï¼‰
- æ–°å¢æ¡Œé¢ç«¯ä¸“ç”¨æ‹–æ‹½æ–¹æ¡ˆï¼š
  * é¼ æ ‡å·¦é”®æŒ‰ä¸‹ â†’ ç§»åŠ¨è¶…è¿‡10pxå¼€å§‹æ‹–åŠ¨ â†’ é¼ æ ‡é‡Šæ”¾å®Œæˆäº¤æ¢
  * æ”¯æŒé¼ æ ‡å’Œè§¦æ§æ¿æ“ä½œ
  * æ‹–åŠ¨æ—¶å¡ç‰‡è·Ÿéšé¼ æ ‡ç§»åŠ¨
  * å…¶ä»–å¡ç‰‡å¹³æ»‘è¿‡æ¸¡åˆ°æ–°ä½ç½®
  * é‡Šæ”¾åä¿å­˜æ’åºå¹¶åŒæ­¥äº‘ç«¯
- æ–°å¢å‡½æ•°ï¼šhandleDesktopTaskDragStart/Move/End, updateDesktopCardPositions
```

#### 7) ç½‘é¡µç«¯ä¼‘çœ æ¢å¤åæ•°æ®åŒæ­¥ä¿®å¤ï¼ˆå…³é”®ä¿®å¤ï¼‰
**æ–‡ä»¶**: `index.html`
```text
é—®é¢˜ï¼šç½‘é¡µç«¯é•¿æ—¶é—´ä¼‘çœ åï¼Œwatchè¿æ¥æ–­å¼€ï¼Œæ— æ³•åŠæ—¶è·å–å®‰å“ç«¯æ›´æ–°
      å¯¼è‡´"ä»»åŠ¡æŒç»­è®¡æ—¶"ã€"ç¼ºå¤±æ–°è®°å½•"ã€"ç›‘å¬å¤±æ•ˆ"

ä¿®å¤æªæ–½ï¼š
- triggerSync() æ–°å¢ runningTasks å†²çªæ£€æµ‹ (checkRunningTasksConflict)
  * æ£€æµ‹æœ¬åœ°æœ‰ä½†äº‘ç«¯æ²¡æœ‰çš„ä»»åŠ¡ï¼ˆå…¶ä»–è®¾å¤‡å·²å…³é—­ï¼‰
  * æ£€æµ‹äº‘ç«¯æœ‰ä½†æœ¬åœ°æ²¡æœ‰çš„ä»»åŠ¡ï¼ˆå…¶ä»–è®¾å¤‡æ–°å¯åŠ¨ï¼‰
  * å‘ç”¨æˆ·æ˜¾ç¤ºå†²çªæç¤º
  
- checkAndRebuildWatchers() å¢å¼ºï¼š
  * æ–°å¢ forceRebuild å‚æ•°
  * ä¼‘çœ æ¢å¤åå¼ºåˆ¶é‡å»ºæ‰€æœ‰ watch è¿æ¥
  * é‡å»ºæˆåŠŸåé‡ç½® isRecoveringFromHibernate æ ‡å¿—
  
- visibilitychange/focus äº‹ä»¶å¤„ç†ï¼š
  * é•¿æ—¶é—´ä¼‘çœ åå¼ºåˆ¶é‡å»º watchï¼ˆå¸¦500mså»¶è¿Ÿç¡®ä¿æ•°æ®å·²åŠ è½½ï¼‰
  * çŸ­æ—¶é—´ä¼‘çœ åªæ£€æŸ¥å¤±æ•ˆè¿æ¥
  
- WebAppInterface.java æ–°å¢ï¼š
  * getStatusBarHeight() æ–¹æ³•ï¼ˆé…åˆé¡¶éƒ¨çŠ¶æ€æ é€‚é…ï¼‰
```

#### 8) ç¡çœ æ¡å½¢å›¾æ˜¾ç¤ºé”™è¯¯ä¿®å¤ï¼ˆä¸‹åˆå…¥ç¡æ˜¾ç¤ºå¼‚å¸¸ï¼‰
**æ–‡ä»¶**: `index.html` (~L27154)
```text
é—®é¢˜ï¼šä¸‹åˆå…¥ç¡ï¼ˆ13:22ï¼‰ä½†è®¡åˆ’æ—¶é—´æ˜¯æ™šä¸Šï¼ˆ22:30ï¼‰ï¼Œæ¡å½¢å›¾æ˜¾ç¤ºå¼‚å¸¸
      - å…¥ç¡æ—¶é—´ç™¾åˆ†æ¯”è®¡ç®—è¶…è¿‡100%ï¼Œæ˜¾ç¤ºåœ¨æœ€å³ä¾§å¤–
      - æ¡å½¢å›¾å®½åº¦æçª„ï¼ˆåªæœ‰ä¸€ç‚¹ç‚¹é˜´å½±ï¼‰
      - å¥–åŠ±æ˜¾ç¤ºé”™è¯¯ï¼ˆ-0.2ï¼‰

åŸå› ï¼štimeToPercent() å‡½æ•°æŠŠä¸‹åˆ1ç‚¹å½“æˆ"æ¬¡æ—¥ä¸‹åˆ1ç‚¹"è®¡ç®—ï¼Œ
      å¯¼è‡´ç›¸å¯¹å°æ—¶æ•°è¶…å‡ºåæ ‡è½´èŒƒå›´

ä¿®å¤ï¼š
- timeToPercent() æ–°å¢ isWakeTime å‚æ•°
- å¯¹äºå…¥ç¡æ—¶é—´ï¼šå¦‚æœåœ¨è½´èŒƒå›´ä¹‹åï¼ˆå¦‚13:22ï¼Œè½´ä»21:30å¼€å§‹ï¼‰ï¼Œ
  è¯´æ˜æ˜¯å‰ä¸€å¤©çš„ä¸‹åˆï¼Œå‡å»24å°æ—¶
- å¯¹äºèµ·åºŠæ—¶é—´ï¼šå¦‚æœåœ¨è½´èŒƒå›´ä¹‹å‰ï¼ˆå¦‚01:05ï¼‰ï¼ŒåŠ ä¸Š24å°æ—¶
- æ­£ç¡®è®¡ç®—ç›¸å¯¹ä½ç½®ç™¾åˆ†æ¯”
```

#### 9) ç¡çœ æ—¶åŒºé—®é¢˜ä¿®å¤ï¼ˆå…³é”®ä¿®å¤ï¼‰
**æ–‡ä»¶**: `index.html`
```text
é—®é¢˜ï¼šç”¨æˆ·å®é™…å…¥ç¡æ—¶é—´21:22ï¼Œä½†è®°å½•æ˜¾ç¤ºä¸º13:22ï¼ˆå·®8å°æ—¶ï¼‰
      ç–‘ä¼¼Android WebViewä¸­Date.now()æ—¶åŒºå¤„ç†ä¸ä¸€è‡´

æ ¹æœ¬åŸå› åˆ†æï¼š
- Date.now()åº”è¿”å›UTCæ—¶é—´æˆ³ï¼ˆæ ‡å‡†è¡Œä¸ºï¼‰
- ä½†æŸäº›Android WebViewå¯èƒ½è¿”å›æœ¬åœ°æ—¶é—´æˆ³
- å¯¼è‡´åŒ—äº¬æ—¶é—´21:22è¢«è®°å½•ä¸ºUTC 13:22ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰

ä¿®å¤æªæ–½ï¼ˆä¿æŒUTCæ ‡å‡†ï¼Œç¡®ä¿ä¸€è‡´æ€§ï¼‰ï¼š
1. æ–°å¢getCurrentUTCTimestamp()å‡½æ•°
   - ä½¿ç”¨Date.UTC()æ˜¾å¼ç”ŸæˆUTCæ—¶é—´æˆ³
   - é¿å…ä¾èµ–WebViewçš„Date.now()å®ç°

2. startSleepRecording()ä¸­ä½¿ç”¨getCurrentUTCTimestamp()
   æ›¿ä»£Date.now()è®°å½•å…¥ç¡æ—¶é—´

3. æ‰‹åŠ¨ç¡çœ è¡¥å½•ä¸­æ˜¾å¼æ·»åŠ ç§’(:00)
   - new Date(`${date}T${time}:00`)ç¡®ä¿æœ¬åœ°æ—¶é—´æ­£ç¡®è§£æ

è¯„ä¼°ï¼šä¿æŒUTCæ—¶é—´æˆ³æ–¹æ¡ˆï¼ˆä¸æ”¹ä¸ºåŒ—äº¬æ—¶é—´ç”Ÿæˆï¼‰
- ç¬¦åˆå›½é™…æ ‡å‡†
- è·¨æ—¶åŒºå…¼å®¹æ€§å¥½
- æ•°æ®å­˜å‚¨ç»Ÿä¸€
```

#### 10) ç¡çœ æŠ¥å‘Šå¼¹çª—ä¿®å¤ä¸ä¼˜åŒ–ï¼ˆv7.13.0ï¼‰
**æ–‡ä»¶**: `index.html` (~L26320)
```text
é—®é¢˜ï¼š
1. æ˜¨å¤©ã€å‰å¤©ç­‰æ—¥æœŸçš„æ¡å½¢å›¾ç‚¹å‡»æ— ååº”
2. éœ€è¦å¢åŠ æ˜ŸæœŸæ˜¾ç¤º
3. è®¡åˆ’æ—¶é—´æ˜¾ç¤ºæ ¼å¼éœ€è¦ç²¾ç®€

ä¿®å¤æ–¹æ¡ˆï¼ˆæœ€å°åŒ–ä¿®æ”¹ï¼‰ï¼š
1. showSleepReportModal() æ·»åŠ é˜²å¾¡æ€§æ£€æŸ¥ï¼š
   if (!record || !record.sleepStartTime || !record.wakeTime) return;
   - è§£å†³ getSleepRecordForDate è¿”å› null æ—¶å´©æºƒé—®é¢˜

2. æ—¥æœŸæ ¼å¼ï¼ˆé¿å…åŒå±‚æ‹¬å·ï¼‰ï¼š
   - ä»Šæ—¥å‘¨ä¸€ï¼ˆä¸æ˜¯"ä»Šæ—¥ï¼ˆå‘¨ä¸€ï¼‰"ï¼‰
   - æ˜¨æ—¥å‘¨æ—¥
   - 2æœˆ3æ—¥å‘¨ä¸€

3. è®¡åˆ’æ—¶é—´æ ¼å¼ç²¾ç®€ï¼š
   åŸï¼šè®¡åˆ’å…¥ç¡ 22:30 Â· è®¡åˆ’èµ·åºŠ 06:30 Â· ç›®æ ‡ 8å°æ—¶
   æ–°ï¼šè®¡åˆ’æ—¶é—´ 22:30~06:30 Â· 8å°æ—¶0åˆ†
```

#### 11) ç¡çœ æ—¶åŒºä¸¥é‡ Bug ä¿®å¤ï¼ˆv7.13.1ï¼‰ã€å…³é”®ä¿®å¤ã€‘
**æ–‡ä»¶**: `index.html` (~L26599)
```text
é—®é¢˜ï¼ˆä¸¥é‡ï¼‰ï¼š
- ç”¨æˆ·åŒ—äº¬æ—¶é—´ 00:05 å…¥ç¡ï¼Œè¢«é”™è¯¯è®°å½•ä¸º 08:05
- å¯¼è‡´ç¡çœ æ—¶é—´æ˜¾ç¤ºå’Œè®¡ç®—å®Œå…¨é”™è¯¯

æ ¹å› åˆ†æï¼š
- getCurrentUTCTimestamp() å®ç°é”™è¯¯
- ä½¿ç”¨ new Date() è·å–æœ¬åœ°æ—¶é—´ç»„ä»¶
- ç”¨ Date.UTC() æŠŠæœ¬åœ°å°æ—¶å½“æˆ UTC å°æ—¶æ„é€ æ—¶é—´æˆ³
- ç»“æœï¼šåŒ—äº¬æ—¶é—´ 00:05 â†’ é”™è¯¯åœ°ç”Ÿæˆ UTC 00:05 æ—¶é—´æˆ³

ä¿®å¤ï¼š
- ç›´æ¥è¿”å› Date.now()ï¼Œå®ƒæœ¬èº«å°±æ˜¯ UTC æ—¶é—´æˆ³
- åˆ é™¤é”™è¯¯çš„ Date.UTC() æ„é€ é€»è¾‘

æ•™è®­ï¼š
- Date.UTC(year, month, day, hours...) ä¼šæŠŠå‚æ•°å½“æˆ UTC æ—¶é—´
- å¦‚æœç”¨æœ¬åœ°æ—¶é—´ç»„ä»¶è°ƒç”¨ Date.UTC()ï¼Œä¼šäº§ç”Ÿæ—¶åŒºåç§»é”™è¯¯
- Date.now() æˆ– new Date().getTime() æœ¬èº«å°±æ˜¯ UTC æ—¶é—´æˆ³
```

---
## v7.11.4 (2026-02-03) - æ— å…³é”®æ”¹åŠ¨

### å…³é”®æ”¹åŠ¨
ï¼ˆä»… UI é—´è·ä¸ç¼“å­˜ç‰ˆæœ¬æ›´æ–°ï¼Œä¸è®°å½•ä¸ºå…³é”®æ”¹åŠ¨ï¼‰

## v7.11.3 (2026-02-03) - ç¡çœ åŒæ­¥æœºåˆ¶

### å…³é”®æ”¹åŠ¨

#### 1) ç¡çœ è®¾ç½®/çŠ¶æ€æ”¹ä¸ºäº‘ç«¯å…±äº« + å®æ—¶ç›‘å¬
**æ–‡ä»¶**: `index.html` (~L24880, ~L10880)
```text
deviceSleepSettings/deviceSleepState â†’ sleepSettingsShared/sleepStateShared
Profile watch å¢åŠ  applySleepSettingsFromCloud/applySleepStateFromCloud
```

#### 2) ç¡çœ è®¾ç½®å…±äº«ä¸ºå”¯ä¸€çœŸç›¸ï¼ˆå¼ºåˆ¶åº”ç”¨äº‘ç«¯ï¼‰
**æ–‡ä»¶**: `index.html` (~L25080, ~L10890)
```text
applySleepSettingsFromCloud å¢åŠ  forceï¼›shared/watch å¼ºåˆ¶è¦†ç›–æœ¬åœ°
```

## v7.11.2 (2026-02-02) - è®¾ç½®é‡å¯åä¸¢å¤±é—®é¢˜ï¼ˆä¸‰å±‚é—®é¢˜ä¿®å¤ï¼‰

### é—®é¢˜é“¾ï¼ˆé‡è¦ç»éªŒï¼‰
```
é—®é¢˜1: WebView localStorage ä¸å¯é 
    â†“ ä¿®å¤åå‘ç°
é—®é¢˜2: initApp() ä¸­ updateNotificationSettingsUI() å´©æºƒï¼Œé˜»æ–­åç»­ init å‡½æ•°
    â†“ ä¿®å¤åå‘ç°  
é—®é¢˜3: åˆ†ç±»æ ‡ç­¾å­˜å‚¨ä½ç½®åˆ†ç¦»ï¼ŒinitScreenTimeSettings æœªä» profile.screenTimeCategories æ¢å¤
```

### è°ƒè¯•ç»éªŒ
1. **WebView console.log è¢«ç³»ç»Ÿè¿‡æ»¤** â†’ éœ€ç”¨åŸç”Ÿæ–¹æ³•æ‰“æ—¥å¿—æ‰èƒ½çœ‹åˆ°çœŸç›¸
2. **é”™è¯¯ä¼šä¼ æ’­é˜»æ–­** â†’ ä¸€ä¸ªæ—©æœŸé”™è¯¯ä¼šä¸­æ–­åç»­æ‰€æœ‰åˆå§‹åŒ–ï¼Œå¿…é¡»ç”¨ try-catch éš”ç¦»
3. **æ¶æ„å¤æ‚æ€§** â†’ åŒä¸€åŠŸèƒ½çš„æ•°æ®å¯èƒ½åˆ†æ•£åœ¨å¤šä¸ªä½ç½®å­˜å‚¨

### å…³é”®ä¿®å¤

#### 1. Android åŸç”Ÿå­˜å‚¨ï¼ˆè§£å†³ localStorage ä¸å¯é ï¼‰
**æ–‡ä»¶**: `WebAppInterface.java`
```java
// æ–°å¢æ–¹æ³•
@JavascriptInterface
public void saveScreenTimeSettingsNative(String json) {
    prefs.edit().putString("screenTimeSettings", json).apply();
}
@JavascriptInterface
public String getScreenTimeSettingsNative() {
    return prefs.getString("screenTimeSettings", null);
}
// åŒç†: saveSleepSettingsNative, getSleepSettingsNative, saveSleepStateNative, getSleepStateNative
// è°ƒè¯•ç”¨: nativeLog(String tag, String message)
```

#### 2. é˜²æ­¢ initApp ä¸­æ–­ï¼ˆtry-catch éš”ç¦»ï¼‰
**æ–‡ä»¶**: `index.html` (~L11638)
```javascript
// ä¿®æ”¹å‰
updateNotificationSettingsUI();
initScreenTimeSettings();
initSleepSettings();

// ä¿®æ”¹å
try { updateNotificationSettingsUI(); } catch (e) { console.error(e); }
try { initScreenTimeSettings(); } catch (e) { console.error(e); }
try { initSleepSettings(); } catch (e) { console.error(e); }
```

#### 3. åˆ†ç±»æ ‡ç­¾ä»äº‘ç«¯æ¢å¤
**æ–‡ä»¶**: `index.html`

**å­˜å‚¨æ¶æ„**ï¼ˆå¯¼è‡´é—®é¢˜çš„æ ¹å› ï¼‰:
```
deviceScreenTimeSettings[deviceId]  â†’ enabled, dailyLimit ç­‰ï¼ˆè®¾å¤‡ä¸“å±ï¼‰
profile.screenTimeCategories        â†’ earnCategory, spendCategoryï¼ˆè·¨è®¾å¤‡å…±äº«ï¼‰
```

**ä¿®å¤**: åœ¨ `initScreenTimeSettings()` ä¸­æ·»åŠ  (~L27305):
```javascript
// [v7.11.2] ä»äº‘ç«¯æ¢å¤åˆ†ç±»æ ‡ç­¾
if (isLoggedIn() && DAL.profileData?.screenTimeCategories) {
    const categories = DAL.profileData.screenTimeCategories;
    if (categories.earnCategory !== undefined) {
        screenTimeSettings.earnCategory = categories.earnCategory;
    }
    if (categories.spendCategory !== undefined) {
        screenTimeSettings.spendCategory = categories.spendCategory;
    }
}
```

**ä¿®å¤**: åœ¨ `updateScreenTimeCategories()` ä¸­æ·»åŠ åŸç”Ÿå­˜å‚¨ (~L27791):
```javascript
// ä¿®æ”¹åˆ†ç±»ååŒæ­¥åˆ°åŸç”Ÿå­˜å‚¨
if (window.Android?.saveScreenTimeSettingsNative) {
    window.Android.saveScreenTimeSettingsNative(JSON.stringify(screenTimeSettings));
}
```

#### 4. è®¾å¤‡è¿ç§»æ¢å¤
```javascript
function getLatestDeviceSettings(deviceSettingsMap) {
    // éå†æ‰€æœ‰è®¾å¤‡é…ç½®ï¼Œè¿”å› lastUpdated æœ€æ–°çš„
    // ç”¨äºé‡è£…å deviceId æ”¹å˜æ—¶æ¢å¤è®¾ç½®
}
```

---
## v7.11.1 (2026-02-02) - è·¨è®¾å¤‡åŒæ­¥ä¸æ¢å¤

### å…³é”®æ”¹åŠ¨
**æ–‡ä»¶**: `index.html`

- å‡è¡¡æ¨¡å¼ï¼šæ”¹ä¸ºäº‘ç«¯å”¯ä¸€çœŸç›¸ï¼Œå¿½ç•¥æœ¬åœ°ç¼“å­˜
- è‡ªåŠ¨æ£€æµ‹è¡¥å½•ï¼šæ”¹ä¸ºå¤šè®¾å¤‡åŸå§‹è®°å½•ï¼ˆ`autoDetectRawRecords`ï¼‰+ æ±‡æ€»ç”Ÿæˆæœ€ç»ˆè¡¥å½•/ä¿®æ­£äº¤æ˜“
- è‡ªåŠ¨æ£€æµ‹å¤„ç†æ—¥æœŸï¼šäº‘ç«¯å…¨å±€è®°å½•ï¼ˆ`autoDetectProcessedDates`ï¼‰ï¼Œé¿å…é‡å¤ç»“ç®—
- ç½‘é¡µç«¯é•¿æ—¶é—´ä¼‘çœ æ¢å¤ï¼šç™»å½•æ€å¾…æ¢å¤æ—¶è·³è¿‡æœ¬åœ°ç¼“å­˜å¹¶ç­‰å¾…äº‘ç«¯ï¼Œé˜²æ­¢æ—§æ•°æ®è¦†ç›–
- ç½‘é¡µç«¯æ¢å¤è¶…æ—¶å…œåº•ï¼šå¼ºåˆ¶åˆ·æ–°ç™»å½•çŠ¶æ€å¹¶é‡æ‹‰äº‘ç«¯æ•°æ®

## v7.11.0 (2026-02-01) - æ— å…³é”®æ”¹åŠ¨

### å…³é”®æ”¹åŠ¨
ï¼ˆå¼•å¯¼å®šä½ä¸äº¤äº’ä¼˜åŒ–ä¸º UI/ä½“éªŒå±‚è°ƒæ•´ï¼Œä¸è®°å½•ä¸ºå…³é”®æ”¹åŠ¨ï¼‰

## v7.10.1 (2026-01-31) - æ— å…³é”®æ”¹åŠ¨

### å…³é”®æ”¹åŠ¨
ï¼ˆæ–°æ‰‹å¼•å¯¼å®šä½ä¸äº¤äº’ä¼˜åŒ–ä¸º UI/ä½“éªŒå±‚è°ƒæ•´ï¼Œä¸è®°å½•ä¸ºå…³é”®æ”¹åŠ¨ï¼‰

#### 5. ä¿®å¤æ¶ˆè´¹ä»»åŠ¡æˆ’é™¤è®¾ç½®æ˜¾ç¤º
- `ensureOnboardingHabitEnabled()` ç°åœ¨ä¼šè°ƒç”¨ `updateTaskTypeUI()` ç¡®ä¿æˆ’é™¤è®¾ç½®åŒºåŸŸæ­£ç¡®æ˜¾ç¤º

#### 6. å¼•å¯¼ç»“æŸæ¸…ç†
- `finishTaskOnboarding()` å…³é—­æ‰€æœ‰æ‰“å¼€çš„å¼¹çª—å’Œèœå•ï¼Œé‡ç½®çŠ¶æ€

#### 7. å¼•å¯¼èœå•ç¼–è¾‘æµç¨‹ä¿®å¤
**æ–‡ä»¶**: `index.html`
- æ¢å¤ä»»åŠ¡å¼•å¯¼æ­¥éª¤ç»“æ„ï¼ˆè¡¥å› `pick-earn-task`ï¼‰ï¼Œç§»é™¤â€œç‚¹å‡»èœå•â€æ­¥éª¤ï¼Œä»…ä¿ç•™â€œè¿›å…¥ç¼–è¾‘â€ã€‚
- æ–°å¢ `openOnboardingMenuEdit(taskId)`ï¼šæ‰“å¼€èœå•å¹¶ä¸ºâ€œç¼–è¾‘â€é¡¹ç»‘å®šå…œåº•ç‚¹å‡»ï¼Œç¡®ä¿è¿›å…¥ç¼–è¾‘å¼¹çª—ã€‚
- æ¶ˆè´¹ç±»ä»»åŠ¡å¼•å¯¼åˆ‡æ¢æ—¶å…³é—­ä¸Šä¸€ä»»åŠ¡ç¼–è¾‘å¼¹çª—ï¼Œé¿å…é˜»æ–­åç»­å¼•å¯¼ã€‚

#### 8. å¼•å¯¼ç¼–è¾‘å¼¹çª—æ»šåŠ¨é‡ç½®
**æ–‡ä»¶**: `index.html`
- `openOnboardingEditTask()` åœ¨å¼•å¯¼æœŸé—´æ‰“å¼€ç¼–è¾‘å¼¹çª—åé‡ç½®æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œé¿å…åœç•™åœ¨åº•éƒ¨å¯¼è‡´å®šä½å¤±è´¥ã€‚

#### 9. æ¶ˆè´¹å¼•å¯¼å®šä½ä¿®å¤
**æ–‡ä»¶**: `index.html`
- â€œè¿›å…¥æˆ’é™¤é…ç½®â€æ­¥éª¤ç›®æ ‡æ”¹ä¸º `#habitToggleContainer` å¹¶æ»šåŠ¨å®šä½ï¼Œé¿å…é”™è¯¯æŒ‡å‘ä»»åŠ¡ç±»å‹ã€‚

#### 10. æ¶ˆè´¹å¼•å¯¼ä¿å­˜æŒ‰é’®å®šä½
**æ–‡ä»¶**: `index.html`
- â€œä¿å­˜ä¸ºæˆ‘çš„ä»»åŠ¡â€æ­¥éª¤æ”¹ç”¨ `getVisibleElement('#submitBtn')` å¹¶æ»šåŠ¨å®šä½ï¼Œé¿å…æŒ‰é’®ä¸å¯è§å¯¼è‡´å¡ä½ã€‚

#### 11. æ¶ˆè´¹æˆ’é™¤æ­¥éª¤ç­‰å¾…æ—¶é—´
**æ–‡ä»¶**: `index.html`
- ä¸ºæ¶ˆè´¹æˆ’é™¤ç›¸å…³æ­¥éª¤å¢åŠ  `waitTime`ï¼Œç¡®ä¿ä¹ æƒ¯æˆ’é™¤ UI åˆ‡æ¢å®Œæˆåå†å®šä½å¼•å¯¼ã€‚

### æŠ€æœ¯è¦ç‚¹
- **æ»šåŠ¨å®¹å™¨è¯†åˆ«**: å¼¹çª—å†…å…ƒç´ ä½¿ç”¨ `.modal-content` æ»šåŠ¨ï¼Œä¸»é¡µé¢ä½¿ç”¨ `#appScrollContainer`
- **æ»šåŠ¨å›è°ƒ**: ç›‘å¬ `scroll` äº‹ä»¶ç»“æŸï¼ˆ80ms æ— æ»šåŠ¨ï¼‰åè§¦å‘å›è°ƒ
- **åŒé‡ rAF**: ä½¿ç”¨ä¸¤æ¬¡ `requestAnimationFrame` ç¡®ä¿æµè§ˆå™¨å®Œæˆå¸ƒå±€è®¡ç®—
- **èœå•é”å®š**: `onboardingMenuLocked` æ ‡å¿—é˜²æ­¢ç‚¹å‡»/æ»šåŠ¨å…³é—­èœå•

---

## v7.10.0 (2026-01-31) - é¦–æ¬¡å¯åŠ¨ç¤ºä¾‹å¯¼å…¥å¼¹çª—

### å…³é”®æ”¹åŠ¨
**æ–‡ä»¶**: `index.html`
- é¦–æ¬¡å¯åŠ¨æ—¶å¼¹å‡ºç¤ºä¾‹æ•°æ®å¼•å¯¼å¼¹çª—ï¼Œå±•ç¤ºä¸¤æ¡ç¤ºä¾‹ä»»åŠ¡å¹¶å¼•å¯¼å¯¼å…¥ã€‚
- æ–°å¢ `tb_first_launch_demo_shown`/`tb_onboarding_pending` æ ‡è®°ï¼Œé¿å…é‡å¤å¼¹çª—å¹¶ä¸ºåç»­å¯¼è§ˆç•™é’©å­ã€‚
- æ–°å¢åˆ›å»ºä»»åŠ¡æ–°æ‰‹å¼•å¯¼ï¼ˆFAB â†’ ä»»åŠ¡ç±»å‹ â†’ ç±»å‹é€‰é¡¹ï¼‰ä¸å¯¼è§ˆå®šä½ä¼˜åŒ–ï¼ŒåŒ…å« `tb_task_onboarding_pending`/`tb_task_onboarding_done` çŠ¶æ€ã€‚
- ä»»åŠ¡ç±»å‹é€‰æ‹©åæ–°å¢ç»†åˆ†å¼•å¯¼ï¼ˆæŒ‰æ¬¡/è®¡æ—¶/è¾¾æ ‡/æ¶ˆè´¹ï¼‰ï¼Œè¦†ç›–ä¹ æƒ¯ç³»ç»Ÿã€æ‚¬æµ®çª—ä¸æˆ’é™¤ä¹ æƒ¯è¯´æ˜ï¼›å¯¼è§ˆå®šä½é€‚é… `visualViewport` å¹¶æ”¯æŒæ»šåŠ¨æ—¶é‡å®šä½ã€‚
- åˆ›å»ºä»»åŠ¡å¼•å¯¼æ”¹ä¸ºâ€œä¼˜ç§€ä»»åŠ¡ç¤ºä¾‹â€çš„ç¼–è¾‘å¼å¼•å¯¼ï¼ˆä» FAB ç›´è¾¾ç¤ºä¾‹ç¼–è¾‘é¡µï¼‰ï¼Œå±•ç¤ºä¹ æƒ¯ç³»ç»Ÿã€æ‚¬æµ®çª—ã€æˆ’é™¤æŒ‘æˆ˜ä¸å…³è”åº”ç”¨ç­‰é«˜çº§èƒ½åŠ›ã€‚
- åˆ›å»ºä»»åŠ¡å¼•å¯¼æ”¹ä¸ºåœ¨ä»»åŠ¡åˆ—è¡¨é€‰æ‹©åˆé€‚ä»»åŠ¡ï¼Œé€šè¿‡â€œèœå•â†’ç¼–è¾‘â€è¿›å…¥ç¼–è¾‘é¡µç»§ç»­å¼•å¯¼ï¼Œè¦†ç›–å€ç‡ã€æ‚¬æµ®çª—ã€ä¹ æƒ¯ä¸æˆ’é™¤é…ç½®ï¼Œå¹¶å¯¹ä¸‹æ–¹æ­¥éª¤è¿›è¡ŒæŒ‰éœ€æ»šåŠ¨å®šä½ã€‚
- åˆ›å»ºä»»åŠ¡å¼•å¯¼ä¼˜å…ˆé€‰å–å¼€å¯ä¹ æƒ¯çš„ä»»åŠ¡ï¼Œå¹¶åœ¨èœå•ä¿æŒå±•å¼€æ—¶èšç„¦â€œç¼–è¾‘â€æŒ‰é’®ï¼›ä»…åœ¨å…ƒç´ ä¸åœ¨è§†å£æ—¶æ‰è‡ªåŠ¨æ»šåŠ¨ã€‚

---

## v7.9.13 (2026-01-31) - å‡è¡¡æ¨¡å¼é™åˆ¶ç§»é™¤ä¸æ¯æ—¥è¯¦æƒ…è¯´æ˜ä¼˜åŒ–

### å…³é”®æ”¹åŠ¨
**æ–‡ä»¶**: `index.html`
- ç§»é™¤å‡è¡¡æ¨¡å¼ 180 å¤©é”å®šé™åˆ¶ï¼Œå…è®¸éšæ—¶å¼€å¯/å…³é—­ï¼Œå¹¶åˆ é™¤ç›¸å…³æç¤ºä¸å€’è®¡æ—¶æ–‡æ¡ˆã€‚
- æ¯æ—¥è¯¦æƒ…æ ‡é¢˜çš„â€œï¼Ÿâ€è¯´æ˜æŒ‰é’®æ ·å¼ä¸å…¶ä»–åŒºåŸŸä¿æŒä¸€è‡´ï¼ˆé€šé€æ¨¡å¼ä¸‹ç»Ÿä¸€æ ·å¼ï¼‰ã€‚
- æ¯æ—¥è¯¦æƒ…è¯´æ˜å¼¹çª—æ”¹ä¸ºåˆ—è¡¨å¼æ’ç‰ˆï¼Œç»“æ„ä¸å…¶ä»–è¯´æ˜å¼¹çª—ä¸€è‡´ã€‚

---

## v7.9.12 (2026-01-31) - ç‰ˆæœ¬å·ä¸ç¼“å­˜æ›´æ–°

### å…³é”®æ”¹åŠ¨
**æ–‡ä»¶**: `index.html`, `sw.js`
- ç‰ˆæœ¬å·å‡çº§åˆ° `v7.9.12`ã€‚
- Service Worker ç¼“å­˜åæ›´æ–°ä¸º `timebank-cache-v7.9.12`ã€‚

---

## v7.9.11 (2026-01-31) - é€šé€æ¨¡å¼å¯è¯»æ€§ä¿®å¤

### é—®é¢˜èƒŒæ™¯
ç¡çœ æŠ¥å‘Šä¸æ¯æ—¥è¯¦æƒ…è¯´æ˜æŒ‰é’®åœ¨é€šé€æ¨¡å¼ä¸‹å¯¹æ¯”åº¦ä¸è¶³ï¼Œå¯¼è‡´æ–‡å­—ä¸æŒ‰é’®å¯è¯»æ€§å·®ã€‚

### è§£å†³æ–¹æ¡ˆ
1. æå‡ç¡çœ æŠ¥å‘Šå¼¹çª—çš„æ–‡å­—å¯¹æ¯”ä¸æ˜ç»†åŒºåŸŸèƒŒæ™¯ï¼Œç¡®ä¿é€šé€æ¨¡å¼ä¸‹æ¸…æ™°å¯è¯»ã€‚
2. å¼ºåŒ–æ¯æ—¥è¯¦æƒ…å¼¹çª—â€œï¼Ÿâ€è¯´æ˜æŒ‰é’®åœ¨é€šé€æ¨¡å¼ä¸‹çš„è¾¹æ¡†ä¸èƒŒæ™¯å¯¹æ¯”åº¦ã€‚

### å…³é”®æ”¹åŠ¨

#### 1. ç¡çœ æŠ¥å‘Šé€šé€æ¨¡å¼æ ·å¼å¢å¼º
**æ–‡ä»¶**: `index.html`
- ä¸º `#sleepReportModal` çš„ `text-muted` æ–‡æœ¬æå‡äº®åº¦ä¸é˜´å½±ã€‚
- ä¸º `.sleep-report-details` å¢åŠ åŠé€æ˜èƒŒæ™¯ã€è¾¹æ¡†ä¸å†…è¾¹è·ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚

#### 2. æ¯æ—¥è¯¦æƒ…è¯´æ˜æŒ‰é’®é€šé€æ¨¡å¼å¯è¯»æ€§
**æ–‡ä»¶**: `index.html`
- ä¸º `#dayDetailModal .info-button` è®¾ç½®æ›´é«˜å¯¹æ¯”çš„è¾¹æ¡†ã€æ–‡å­—ä¸èƒŒæ™¯è‰²ã€‚

#### 3. ç‰ˆæœ¬å·ä¸ç¼“å­˜æ›´æ–°
**æ–‡ä»¶**: `index.html`, `sw.js`
- ç‰ˆæœ¬å·å‡çº§åˆ° `v7.9.11` å¹¶æ›´æ–° Service Worker ç¼“å­˜åã€‚

#### 4. ç½‘é¡µç«¯ç™»å½•æ¢å¤é˜²æŠ¤
**æ–‡ä»¶**: `index.html`
- å¯åŠ¨æ—¶ä»¥ `DAL.getCurrentUid()` åˆ¤å®šç™»å½•ï¼Œé¿å…ä»…å‡­ç¼“å­˜å¯¼è‡´è¯¯åˆ¤æœªç™»å½•ã€‚
- ç½‘é¡µç«¯ç™»å½•çŠ¶æ€å¾…æ¢å¤æ—¶ï¼Œå»¶è¿ŸåŠ è½½æœ¬åœ°ç¼“å­˜ï¼Œå¹¶è½®è¯¢ç­‰å¾… UID å°±ç»ªåå†åŠ è½½äº‘ç«¯æ•°æ®ã€‚
- `loadData()` åœ¨æ£€æµ‹åˆ°ç™»å½•æ€æˆ–å¾…æ¢å¤ç™»å½•æ€æ—¶è·³è¿‡æœ¬åœ°ç¼“å­˜ï¼Œé¿å…æ—§æ•°æ®è¦†ç›–äº‘ç«¯ã€‚

---

## v7.9.10 (2026-01-30) - è¡¥å½•è¿èƒœè·¨è®¾å¤‡åŒæ­¥ä¿®å¤

### é—®é¢˜èƒŒæ™¯
è¡¥å½•è§¦å‘ `rebuildHabitStreak()` åï¼Œè¿èƒœä¸è¡¥å‘å¥–åŠ±ä»…æ›´æ–°æœ¬åœ°ä»»åŠ¡/äº¤æ˜“ï¼Œäº‘ç«¯æœªåŒæ­¥ï¼Œå¯¼è‡´å…¶ä»–è®¾å¤‡ä¸Šè¿èƒœå¼‚å¸¸ä¸­æ–­ã€‚

### è§£å†³æ–¹æ¡ˆ
1. é‡å»ºè¿èƒœååŒæ­¥ä»»åŠ¡ä¸äº¤æ˜“åˆ°äº‘ç«¯ï¼Œç¡®ä¿è·¨è®¾å¤‡ä¸€è‡´ã€‚
2. æ–°å¢äº¤æ˜“æ›´æ–°èƒ½åŠ›ï¼Œç”¨äºè¡¥å½•é‡å»ºæ—¶ä¿®æ­£ `isStreakAdvancement` ä¸å¥–åŠ±é‡‘é¢ã€‚

### å…³é”®æ”¹åŠ¨

#### 1. è¿èƒœé‡å»ºåäº‘åŒæ­¥
**æ–‡ä»¶**: `index.html`
- `rebuildHabitStreak()` è®°å½•å˜æ›´å‰å¿«ç…§ï¼Œè®¡ç®—å˜æ›´çš„äº¤æ˜“åˆ—è¡¨ã€‚
- æ–°å¢ `syncHabitRebuildToCloud()`ï¼šåŒæ­¥æ›´æ–°åçš„ä»»åŠ¡ä¸äº¤æ˜“åˆ° CloudBaseã€‚

#### 2. äº‘ç«¯äº¤æ˜“æ›´æ–°æ¥å£
**æ–‡ä»¶**: `index.html`
- æ–°å¢ `DAL.updateTransaction(tx, prevTx)`ï¼šæ›´æ–°äº¤æ˜“å­—æ®µï¼Œå¹¶æ ¹æ®å˜æ›´è°ƒæ•´æ—¥æ±‡æ€»ä¸ç¼“å­˜ä½™é¢ã€‚

#### 3. æ‰‹åŠ¨è¡¥å½•æ˜¾ç¤ºæ ¼å¼ç»Ÿä¸€
**æ–‡ä»¶**: `index.html`
- `parseTransactionDescription()`ï¼šæ‰‹åŠ¨è¡¥å½•è®°å½•æŒ‰æ­£å¸¸å®Œæˆæ ¼å¼è§£æï¼Œä»…ä¿ç•™ğŸ“…å›¾æ ‡ã€‚
- è¡¥å½•å«ä¹ æƒ¯å¥–åŠ±ä¸”å‡è¡¡æ¨¡å¼æ—¶ï¼ŒåŸºç¡€å¥–åŠ±ä¸å†è¢«è¯¯åˆ¤ä¸º 0 ç§’ã€‚
- æ‰‹åŠ¨è¡¥å½•æ ‡é¢˜å¼ºåˆ¶çº¯å‡€ï¼Œä»…å±•ç¤ºä»»åŠ¡åï¼›æ—¶é—´/å€ç‡/å‡è¡¡ä¿¡æ¯å…¨éƒ¨è¿›å…¥è¯¦æƒ…è¡Œã€‚
- å…¼å®¹å…¨è§’æ‹¬å·ä¸â€œå‡è¡¡æ¨¡å¼â€åç¼€ï¼Œé¿å…æ ‡é¢˜æ®‹ç•™ä¸è®¡æ—¶è¯¦æƒ…ä¸¢å¤±ã€‚
- æ‰‹åŠ¨è¡¥å½•è®¡æ—¶ç±»åœ¨æè¿°è§£æå¤±è´¥æ—¶å›é€€é‡å»ºâ€œæ—¶é•¿ Ã— ä»»åŠ¡å€ç‡ (+å‡è¡¡å€ç‡)â€ã€‚
- å…¼å®¹â€œè¡¥å½•ï¼šâ€å…¨è§’å†’å·ä¸ isBackdate æ ‡è®°ï¼Œç¡®ä¿æ‰‹åŠ¨è¡¥å½•è§£æå¿…èµ°ç»Ÿä¸€æ ¼å¼ã€‚

#### 4. æ¯æ—¥è¯¦æƒ…å›¾ä¾‹è¯´æ˜æŒ‰é’®
**æ–‡ä»¶**: `index.html`
- æ–°å¢ `showDayDetailLegend()` å¹¶åœ¨æ¯æ—¥è¯¦æƒ…æ ‡é¢˜å³ä¾§æ·»åŠ è¯´æ˜æŒ‰é’®ï¼Œè§£é‡Šå›¾æ ‡å«ä¹‰ä¸å½©è‰²å€ç‡/å¥–åŠ±æ ‡è¯†ã€‚

#### 5. ç¡çœ è®°å½•å±•ç¤ºç»Ÿä¸€ä¸è‡ªåŠ¨ç»“ç®—æè¿°è¡¥é½
**æ–‡ä»¶**: `index.html`
- è‡ªåŠ¨ç¡çœ ç»“ç®—äº¤æ˜“è¡¥é½ `description` å­—æ®µï¼ˆ`ğŸ˜´ å¤œé—´ç¡çœ : <time>`ï¼‰ã€‚
- æ—  description çš„ç¡çœ è®°å½•åœ¨è§£ææ—¶ç»Ÿä¸€æ ‡é¢˜ä¸ºâ€œå¤œé—´ç¡çœ æ—¶é—´â€ï¼Œå¹¶ä½¿ç”¨ğŸ˜´å›¾æ ‡ã€‚

#### 6. è¯´æ˜å¼¹çª—é¢œè‰²ç¤ºä¾‹ä¿®å¤
**æ–‡ä»¶**: `index.html`
- `.multiplier-good/.multiplier-bad/.bonus-target/.bonus-habit` é¢œè‰²æ ·å¼æ”¹ä¸ºå…¨å±€ç±»ï¼Œç¡®ä¿è¯´æ˜å¼¹çª—æ­£ç¡®ç€è‰²ã€‚

#### 7. ç‰ˆæœ¬å·æ›´æ–°ä¸ç¼“å­˜æ›´æ–°
**æ–‡ä»¶**: `index.html`, `sw.js`
- ç‰ˆæœ¬å·å‡çº§åˆ° `v7.9.10` å¹¶æ›´æ–° Service Worker ç¼“å­˜åã€‚

---

## v7.9.9 (2026-01-29) - æœªç™»å½•ä½“éªŒä¸ç¤ºä¾‹æ•°æ®æ¸…ç†

### é—®é¢˜èƒŒæ™¯
æœªç™»å½•çŠ¶æ€ä¸‹ä»»åŠ¡æ— æ³•ç¨³å®šåˆ›å»º/åˆ é™¤ï¼›æ–°ç”¨æˆ·è¯•ç”¨é˜¶æ®µç¼ºä¹å¯è§çš„å®Œæ•´ç¤ºä¾‹æ•°æ®ï¼›ç™»å½•åç¤ºä¾‹æ•°æ®ä¸ç”¨æˆ·è‡ªå»ºæ•°æ®æ··æ‚ã€‚

### è§£å†³æ–¹æ¡ˆ
1. æ–°ç”¨æˆ·æœªç™»å½•æ—¶è‡ªåŠ¨åŠ è½½ç¤ºä¾‹æ•°æ®ï¼Œå®Œæ•´å±•ç¤ºâ€œæœ€è¿‘ä»»åŠ¡/å…¨éƒ¨ä»»åŠ¡â€ã€‚
2. ç™»å½•æˆåŠŸåæ— æç¤ºæ¸…ç†ç¤ºä¾‹æ•°æ®ï¼ˆä»…åˆ é™¤ demo_ ä»»åŠ¡ä¸äº¤æ˜“ï¼‰ï¼Œä¿ç•™ç”¨æˆ·è‡ªå»ºæ•°æ®ã€‚
3. ç™»å½•åè‹¥äº‘ç«¯æ— æ•°æ®ï¼Œè‡ªåŠ¨ä½¿ç”¨æœ¬åœ°æ•°æ®ä½œä¸ºåˆå§‹åŒæ­¥æºï¼›æ— æœ¬åœ°æ•°æ®åˆ™åˆ›å»ºç©º Profileã€‚

### å…³é”®æ”¹åŠ¨

#### 1. ç™»å½•åˆ¤å®šæ›´ä¸¥æ ¼
**æ–‡ä»¶**: `index.html`
- `isLoggedIn()` ç°åœ¨è¦æ±‚å­˜åœ¨æœ‰æ•ˆ `uid`ï¼Œé¿å…â€œä¼ªç™»å½•â€çŠ¶æ€é˜»æ–­æœ¬åœ°ä¿å­˜ã€‚

#### 2. ç¤ºä¾‹æ•°æ®é€»è¾‘é‡æ„
**æ–‡ä»¶**: `index.html`
- `checkAndBootstrap()`ï¼šä¿æŒç©ºç™½çŠ¶æ€ï¼Œä»…æ˜¾ç¤ºâ€œç¤ºä¾‹æ•°æ®å¯¼å…¥â€CTAã€‚
- æ–°å¢ `cleanupDemoDataLocal()` / `cleanupDemoDataOnLogin()`ï¼šé™é»˜æ¸…ç† demo æ•°æ®å¹¶é‡ç®—ä½™é¢ã€‚
- `maybeCleanupDemoDataOnFirstUse()` æ”¹ä¸ºæ— æç¤ºï¼ˆé¿å…å¼¹çª—å¹²æ‰°ï¼‰ã€‚
- `initDemoData()`ï¼šæ¸…ç©ºæŠ˜å çŠ¶æ€å¹¶é‡ç®—ä½™é¢ï¼Œç¡®ä¿ç¤ºä¾‹ä»»åŠ¡å¯è§ä¸”ä½™é¢å¯å˜æ›´ï¼›ç¤ºä¾‹ä½™é¢ç›®æ ‡è°ƒä¸º 2 å°æ—¶ 30 åˆ†ã€‚
- `initDemoData()`ï¼šä½™é¢è¡¥å·®æ”¹ä¸ºå¾ªç¯ä¿®æ­£ï¼Œç¡®ä¿å¤§åå·®ä¹Ÿèƒ½æ”¶æ•›åˆ°ç›®æ ‡å€¼ã€‚

#### 5. æœªç™»å½•ç¤ºä¾‹æ¨¡å¼çš„â€œå…¨éƒ¨ä»»åŠ¡/ä½™é¢ä¸æ›´æ–°â€ä¿®å¤
**æ–‡ä»¶**: `index.html`
- è¡¥å……å…¨å±€ `profileData` é»˜è®¤å€¼ï¼Œé¿å…æœªç™»å½•åœºæ™¯ä¸‹ `updateCategoryTasks()` è¯»å–æœªå£°æ˜å˜é‡è€Œä¸­æ–­åç»­ UI æ›´æ–°ï¼ˆå¯¼è‡´â€œå…¨éƒ¨ä»»åŠ¡ä¸ºç©ºã€ä½™é¢ä¸å˜â€ï¼‰ã€‚

#### 6. Android ä¸‰é”®å¯¼èˆªæ é¿è®©
**æ–‡ä»¶**: `index.html`, `MainActivity.java`, `WebAppInterface.java`
- æ–°å¢ `--android-nav-bottom` å˜é‡å¹¶å°†åº•éƒ¨æ /æ»šåŠ¨å®¹å™¨ padding ä¸ç³»ç»Ÿå¯¼èˆªæ é«˜åº¦ç›¸åŠ ã€‚
- é€šè¿‡ `WindowInsets` ç›‘å¬å¯¼èˆªæ é«˜åº¦å˜åŒ–å¹¶å›ä¼  JS è°ƒæ•´ã€‚
- æä¾› `getNavigationBarHeight()` å…œåº•æ¥å£ã€‚

#### 3. ç™»å½•åæ•°æ®åˆå§‹åŒ–æµç¨‹ç»Ÿä¸€
**æ–‡ä»¶**: `index.html`
- æ–°å¢ `handlePostLoginDataInit()`ï¼šç»Ÿä¸€å¤„ç†ç™»å½•åæ•°æ®åŠ è½½ã€ç¤ºä¾‹æ¸…ç†ä¸æœ¬åœ°â†’äº‘ç«¯å¼•å¯¼åŒæ­¥ã€‚

#### 4. äº‘ç«¯é¦–æ¬¡åŒæ­¥æœªå®Œæˆæ—¶ä»å…è®¸æœ¬åœ°ä¿å­˜
**æ–‡ä»¶**: `index.html`
- `saveData()` åœ¨ `hasCompletedFirstCloudSync=false` æ—¶ä¿ç•™æœ¬åœ°ç¼“å­˜ï¼Œé¿å…ç¦»çº¿çŠ¶æ€ä»»åŠ¡æ“ä½œä¸¢å¤±ã€‚

---

## v7.9.4 (2026-01-26) - è‡ªåŠ¨é‡æ–°ç™»å½•åŠŸèƒ½

### é—®é¢˜èƒŒæ™¯
ç”¨æˆ·æ‰‹æœºæ¯å¤©æ™šä¸Šè‡ªåŠ¨å…³æœºã€æ¸…æ™¨è‡ªåŠ¨å¼€æœºåï¼Œç™»å½•çŠ¶æ€ä¼šä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨é‡æ–°è¾“å…¥é‚®ç®±å’Œå¯†ç ç™»å½•ã€‚

### è§£å†³æ–¹æ¡ˆ
å®ç°è‡ªåŠ¨é‡æ–°ç™»å½•åŠŸèƒ½ï¼šç™»å½•æˆåŠŸåä¿å­˜å‡­æ®ï¼Œè®¾å¤‡é‡å¯åè‡ªåŠ¨ä½¿ç”¨ä¿å­˜çš„å‡­æ®é‡æ–°ç™»å½•ã€‚

### å…³é”®æ”¹åŠ¨

#### 1. CloudBase SDK æŒä¹…åŒ–é…ç½®
**æ–‡ä»¶**: `index.html` (initCloudBase å‡½æ•°ï¼Œçº¦ L8644)
```javascript
app = sdk.init({
    env: TCB_ENV_ID,
    region: 'ap-shanghai',
    persistence: 'local'   // [v7.9.4] æŒä¹…åŒ–åˆ° localStorage
});
```

#### 2. Android ç«¯å‡­æ®å­˜å‚¨
**æ–‡ä»¶**: `WebAppInterface.java` (æ–°å¢æ–¹æ³•)
- `saveLoginCredentials(email, password)` - ä¿å­˜é‚®ç®±å’Œ Base64 ç¼–ç çš„å¯†ç 
- `getSavedLoginPassword()` - è¯»å–è§£ç åçš„å¯†ç 
- `isAutoLoginEnabled()` - æ£€æŸ¥æ˜¯å¦å¯ç”¨è‡ªåŠ¨ç™»å½•
- `clearLoginCredentials()` - æ¸…é™¤ä¿å­˜çš„å¯†ç 
- `setAutoLoginEnabled(enabled)` - è®¾ç½®è‡ªåŠ¨ç™»å½•å¼€å…³

#### 3. è‡ªåŠ¨é‡æ–°ç™»å½•é€»è¾‘
**æ–‡ä»¶**: `index.html` (æ–°å¢ tryAutoReLogin å‡½æ•°ï¼Œçº¦ L8700)
```javascript
async function tryAutoReLogin() {
    // ä» Android SharedPreferences æˆ– localStorage è·å–ä¿å­˜çš„å‡­æ®
    // å¦‚æœæœ‰å‡­æ®ä¸”å¯ç”¨è‡ªåŠ¨ç™»å½•ï¼Œæ‰§è¡Œç™»å½•
    // ç™»å½•æˆåŠŸååŠ è½½äº‘ç«¯æ•°æ®
}
```

#### 4. ç™»å½•æˆåŠŸåä¿å­˜å‡­æ®
**æ–‡ä»¶**: `index.html` (handleEmailLogin å‡½æ•°ï¼Œçº¦ L27260)
- é»˜è®¤å¯ç”¨"è®°ä½ç™»å½•"ï¼ˆå¤é€‰æ¡†éšè—ä½†åŠŸèƒ½ä¿ç•™ï¼‰
- ä¿å­˜å‡­æ®åˆ° Android SharedPreferences å’Œ localStorage

#### 5. ç™»å‡ºæ—¶æ¸…ç†å‡­æ®
**æ–‡ä»¶**: `index.html` (handleLogout å‡½æ•°ï¼Œçº¦ L27640)
- è°ƒç”¨ `Android.clearLoginCredentials()` æ¸…é™¤å¯†ç 
- æ¸…é™¤ localStorage ä¸­çš„æ‰€æœ‰ç™»å½•ç›¸å…³æ•°æ®

### å®‰å…¨è¯´æ˜
- å¯†ç å­˜å‚¨åœ¨ SharedPreferences ä¸­ä½¿ç”¨ MODE_PRIVATEï¼ˆä»…æœ¬åº”ç”¨å¯è®¿é—®ï¼‰
- å¯†ç ä½¿ç”¨ Base64 ç¼–ç å­˜å‚¨ï¼ˆé˜²æ­¢æ˜æ–‡ï¼Œä½†ä¸æ˜¯å¼ºåŠ å¯†ï¼‰
- ç™»å‡ºæ—¶è‡ªåŠ¨æ¸…é™¤æ‰€æœ‰å‡­æ®

---

## v7.9.3 (2026-01-26) - ç³»ç»Ÿåˆ†ç±»ç®¡ç†ä¸äº‘ç«¯åŒæ­¥å¢å¼º

### 1. ç¡çœ åˆ†ç±»æ ‡ç­¾åŠŸèƒ½

**æ–°å¢æ•°æ®ç»“æ„**:
```javascript
sleepSettings.earnCategory = null;  // ç¡çœ å¥–åŠ±åˆ†ç±»
sleepSettings.spendCategory = null; // ç¡çœ æƒ©ç½šåˆ†ç±»

// Profile ä¸­æ–°å¢ï¼ˆæ‰€æœ‰è®¾å¤‡å…±äº«ï¼‰
profile.sleepTimeCategories = {
    earnCategory: string | null,
    spendCategory: string | null,
    lastUpdated: ISO string
}
```

**æ–°å¢å‡½æ•°**:
- `showSleepCategorySelectModal(type)` - æ˜¾ç¤ºåˆ†ç±»é€‰æ‹©å¼¹çª—
- `selectSleepCategory(item)` - é€‰æ‹©åˆ†ç±»
- `updateSleepCategories()` - æ›´æ–°åˆ†ç±»è®¾ç½®å¹¶äº‘ç«¯åŒæ­¥
- `initSleepCategoryDisplay()` - åˆå§‹åŒ–åˆ†ç±»æ˜¾ç¤º

### 2. åˆ†ç±»å¼ºåˆ¶åº”ç”¨ï¼ˆæ ¸å¿ƒæ”¹åŠ¨ï¼‰

**ä¿®æ”¹å‡½æ•°**: `getTransactionCategory(t)` (çº¦ L16976)

**åŸé€»è¾‘**: ä¼˜å…ˆä½¿ç”¨è®°å½•ä¸­çš„ `category` å­—æ®µ
**æ–°é€»è¾‘**: å§‹ç»ˆä½¿ç”¨å½“å‰è®¾ç½®çš„åˆ†ç±»ï¼Œå¿½ç•¥è®°å½•ä¸­çš„å€¼

```javascript
function getTransactionCategory(t) {
    if (t.isSystem) {
        // å±å¹•æ—¶é—´ï¼šå§‹ç»ˆä½¿ç”¨å½“å‰è®¾ç½®
        if (t.systemType === 'screen-time' || t.taskName === 'å±å¹•æ—¶é—´ç®¡ç†') {
            if (t.type === 'earn' && screenTimeSettings.earnCategory) {
                return screenTimeSettings.earnCategory;
            }
            // ...
        }
        // ç¡çœ ï¼šå§‹ç»ˆä½¿ç”¨å½“å‰è®¾ç½®
        if (t.sleepData || t.napData || t.taskName === 'ğŸ˜´ ç¡çœ æ—¶é—´ç®¡ç†') {
            // ...
        }
    }
}
```

**ä¼˜åŠ¿**: æ— éœ€ä¿®æ”¹äº‘ç«¯æ•°æ®ï¼Œè®¾ç½®æ›´æ”¹åç«‹å³ç”Ÿæ•ˆã€‚

### 3. Watch è‡ªåŠ¨é‡è¿æœºåˆ¶

**æ–°å¢å˜é‡**:
```javascript
const watchConnected = { task: false, transaction: false, running: false, profile: false, daily: false };
const watchReconnectAttempts = { ... };
const watchReconnectTimers = {};
```

**æ–°å¢å‡½æ•°**:
- `scheduleWatchReconnect(reason)` - è°ƒåº¦é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- `checkAndRebuildWatchers()` - æ£€æŸ¥å¹¶é‡å»ºå¤±æ•ˆçš„ watchers

**å¿ƒè·³æ£€æµ‹**: æ¯30ç§’æ£€æŸ¥ watch è¿æ¥çŠ¶æ€

### 4. åˆç¡é—¹é’Ÿä¿®å¤

**Java ä¿®æ”¹**: `AlarmReceiver.java`
- ä½¿ç”¨ `RingtoneManager` æ’­æ”¾ç³»ç»Ÿé—¹é’Ÿé“ƒå£°
- æ”¯æŒéœ‡åŠ¨

**JS ä¿®æ”¹**: `startNap()` å‡½æ•°è°ƒç”¨ `Android.setNapAlarm(wakeTimeMs, ALARM_ID_NAP)`

### 5. ç™»å½•çŠ¶æ€æ£€æµ‹

**æ–°å¢æ ‡è®°**:
```javascript
localStorage.setItem('timebankExpectedLoggedIn', 'true');
```

**æ£€æµ‹å‡½æ•°**: `checkLoginStateOnResume()` - æ£€æµ‹æ„å¤–ç™»å‡ºå¹¶æç¤ºç”¨æˆ·

### 6. æ•°å­—è¾“å…¥æ¡†ä¼˜åŒ–

éšè— number è¾“å…¥æ¡†çš„ç®­å¤´ï¼ˆç”µè„‘ç«¯ spinnerï¼‰ï¼š
```css
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
}
input[type="number"] { -moz-appearance: textfield; }
```

---

## å†å²ç‰ˆæœ¬è¦ç‚¹

### v7.8.3 - ç™»å½•é‚®ç®±ä¿å­˜
- ç™»å½•æˆåŠŸåä¿å­˜é‚®ç®±åˆ° Android SharedPreferences
- ç™»å½•çŠ¶æ€ä¸¢å¤±æ—¶è‡ªåŠ¨å¡«å……é‚®ç®±

### v7.4.0+ - ç¡çœ æ—¶é—´ç®¡ç†ç³»ç»Ÿ
- å®Œæ•´çš„ç¡çœ å¥–æƒ©è®¡ç®—é€»è¾‘
- ç¡çœ è®°å½•å­˜å‚¨åœ¨ tb_transactionï¼ˆsleepData å­—æ®µï¼‰

### v7.3.0+ - å‡è¡¡æ¨¡å¼
- æ ¹æ®ä½™é¢è°ƒæ•´èµšå–æ•ˆç‡
- `getBalanceMultiplier()` å‡½æ•°

### v6.6.0 - å¤šè¡¨æ¶æ„è¿ç§»
- ä»å•ä¸€ JSON è¿ç§»åˆ° 5 å¼ ç‹¬ç«‹è¡¨
- DAL (Data Access Layer) è®¾è®¡

### v5.10.0+ - å¡ç‰‡å †å ç³»ç»Ÿ
- å„å¡ç‰‡ç‹¬ç«‹å±•å¼€çŠ¶æ€
- ä¸Šä¸‹æ»‘åŠ¨æ‰‹åŠ¿å¤„ç†

---

## å¸¸ç”¨è°ƒè¯•å‘½ä»¤

```powershell
# åŒæ­¥æ–‡ä»¶
Copy-Item "android_project/app/src/main/assets/www/index.html" "index.html" -Force

# Git æäº¤
git add -A; git commit -m "feat: æè¿°"; git push

# æœç´¢ä»£ç 
grep_search "å…³é”®è¯"
```

---

## Android Studio Logcat æ—¥å¿—ç­›é€‰

```
# WebView/JavaScript æ—¥å¿—
package:com.jianglicheng.timebank tag:chromium

# é”™è¯¯æ—¥å¿—
package:com.jianglicheng.timebank level:error
```

---

*æœ€åæ›´æ–°: 2026-02-07 (v7.15.0 æ—¶é—´é‡‘èç³»ç»Ÿ)*

